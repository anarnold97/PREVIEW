<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Migrating your virtual machines to Red Hat OpenShift Virtualization</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.2"/><meta name="description" content="Run your migration plan by using either the Migration Toolkit for Virtualization (MTV) user interface in the Red Hat OpenShift web console or the command-line interface."/><link rel="next" href="#con_performing-migration-intro_mtv" title="Chapter 1. Performing a migration"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm45556789001520"><div class="titlepage"><div><div class="producttitle"><span class="productname">Migration Toolkit for Virtualization</span> <span class="productnumber">2.10</span></div><div><h1 class="title">Migrating your virtual machines to Red Hat OpenShift Virtualization</h1></div><div><h2 class="subtitle">Migrating virtual machines from VMware vSphere, Red Hat Virtualization or OpenStack platforms, or other platforms to Red Hat OpenShift Virtualization by using the Migration Toolkit for Virtualization</h2></div><div><div xml:lang="en-US" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Red Hat Modernization and Migration</span> <span class="surname">Documentation Team</span></h3><code class="email"><a class="email" href="mailto:ccs-mms-docs@redhat.com">ccs-mms-docs@redhat.com</a></code></div></div></div><div><a href="#idm45556782373520">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				Run your migration plan by using either the Migration Toolkit for Virtualization (MTV) user interface in the Red Hat OpenShift web console or the command-line interface.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="chapter"><a href="#con_performing-migration-intro_mtv">1. Performing a migration</a></span></li><li><span class="chapter"><a href="#assembly_migrating-from-vmware_mtv">2. Migrating from VMware vSphere</a></span><ul><li><span class="section"><a href="#prerequisites">2.1. Prerequisites</a></span></li><li><span class="section"><a href="#running-migration-plan_vmware">2.2. Running a migration plan in the MTV UI</a></span><ul><li><span class="section"><a href="#migration-plan-options-ui_vmware">2.2.1. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_vmware">2.2.2. Canceling a migration</a></span></li></ul></li><li><span class="section"><a href="#proc_migrating-virtual-machines-cli_vmware">2.3. Running a VMware vSphere migration from the command-line</a></span><ul><li><span class="section"><a href="#retrieving-vmware-moref_vmware">2.3.1. Retrieving a VMware vSphere moRef</a></span></li><li><span class="section"><a href="#mtv-shared-disks_vmware">2.3.2. Migrating virtual machines with shared disks</a></span></li><li><span class="section"><a href="#mtv-template-utility_vmware">2.3.3. MTV template utility for VMware VM names</a></span></li><li><span class="section"><a href="#canceling-migration-cli_vmware">2.3.4. Canceling a migration from the command-line interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_migrating-from-rhv_mtv">3. Migrating from Red Hat Virtualization</a></span><ul><li><span class="section"><a href="#prerequisites_2">3.1. Prerequisites</a></span></li><li><span class="section"><a href="#running-migration-plan_rhv">3.2. Running a migration plan in the MTV UI</a></span><ul><li><span class="section"><a href="#migration-plan-options-ui_rhv">3.2.1. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_rhv">3.2.2. Canceling a migration</a></span></li></ul></li><li><span class="section"><a href="#proc_migrating-virtual-machines-cli_rhv">3.3. Running a Red Hat Virtualization migration from the command-line</a></span><ul><li><span class="section"><a href="#canceling-migration-cli_rhv">3.3.1. Canceling a migration from the command-line interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_migrating-from-osp_mtv">4. Migrating from OpenStack</a></span><ul><li><span class="section"><a href="#prerequisites_3">4.1. Prerequisites</a></span></li><li><span class="section"><a href="#running-migration-plan_ostack">4.2. Running a migration plan in the MTV UI</a></span><ul><li><span class="section"><a href="#migration-plan-options-ui_ostack">4.2.1. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_ostack">4.2.2. Canceling a migration</a></span></li></ul></li><li><span class="section"><a href="#proc_migrating-virtual-machines-cli_ostack">4.3. Running an OpenStack migration from the command-line</a></span><ul><li><span class="section"><a href="#canceling-migration-cli_ostack">4.3.1. Canceling a migration from the command-line interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_migrating-from-ova_mtv">5. Migrating from OVA</a></span><ul><li><span class="section"><a href="#prerequisites_4">5.1. Prerequisites</a></span></li><li><span class="section"><a href="#running-migration-plan_ova">5.2. Running a migration plan in the MTV UI</a></span><ul><li><span class="section"><a href="#migration-plan-options-ui_ova">5.2.1. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_ova">5.2.2. Canceling a migration</a></span></li></ul></li><li><span class="section"><a href="#proc_migrating-virtual-machines-cli_ova">5.3. Running an Open Virtual Appliance (OVA) migration from the command-line</a></span><ul><li><span class="section"><a href="#canceling-migration-cli_ova">5.3.1. Canceling a migration from the command-line interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_migrating-from-virt_mtv">6. Migrating from OpenShift Virtualization</a></span><ul><li><span class="section"><a href="#prerequisites_5">6.1. Prerequisites</a></span></li><li><span class="section"><a href="#running-migration-plan_cnv">6.2. Running a migration plan in the MTV UI</a></span><ul><li><span class="section"><a href="#migration-plan-options-ui_cnv">6.2.1. Migration plan options</a></span></li><li><span class="section"><a href="#canceling-migration-ui_cnv">6.2.2. Canceling a migration</a></span></li></ul></li><li><span class="section"><a href="#proc_migrating-virtual-machines-cli_cnv">6.3. Running a Red Hat OpenShift Virtualization migration from the command-line</a></span><ul><li><span class="section"><a href="#migrating-live-cnv-cnv-vms-cli_cnv">6.3.1. Running a Red Hat OpenShift Virtualization live migration from the command-line</a></span></li><li><span class="section"><a href="#canceling-migration-cli_cnv">6.3.2. Canceling a migration from the command-line interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_advanced-migration-options_mtv">7. Advanced migration options</a></span><ul><li><span class="section"><a href="#changing-precopy-intervals_mtv">7.1. Changing precopy intervals for warm migration</a></span></li><li><span class="section"><a href="#con_creating-custom-rules-validation_mtv">7.2. Creating custom rules for the Validation service</a></span><ul><li><span class="section"><a href="#about-rego-files_mtv">7.2.1. About Rego files</a></span></li><li><span class="section"><a href="#accessing-default-validation-rules_mtv">7.2.2. Checking the default validation rules</a></span></li><li><span class="section"><a href="#creating-validation-rule_mtv">7.2.3. Creating a validation rule</a></span></li><li><span class="section"><a href="#updating-inventory-rules-version_mtv">7.2.4. Updating the inventory rules version</a></span></li><li><span class="section"><a href="#retrieving-validation-service-json_mtv">7.2.5. Retrieving the Inventory service JSON</a></span></li></ul></li><li><span class="section"><a href="#about-hooks-for-migration-plans_mtv">7.3. About hooks for MTV migration plans</a></span><ul><li><span class="section"><a href="#default-hook-image_mtv">7.3.1. Default hook image</a></span></li><li><span class="section"><a href="#hook-execution_mtv">7.3.2. Hook execution</a></span></li><li><span class="section"><a href="#adding-migration-hook-via-ui_mtv">7.3.3. Adding a migration hook to a migration plan using the Red Hat OpenShift web console</a></span></li><li><span class="section"><a href="#adding-migration-hook-via-cli_mtv">7.3.4. Adding a migration hook to a migration plan using the CLI</a></span></li></ul></li><li><span class="section"><a href="#about-udn_mtv">7.4. About user defined networks</a></span></li><li><span class="section"><a href="#con_scheduling-target-vms-intro_mtv">7.5. Scheduling target VMs</a></span><ul><li><span class="section"><a href="#about-configuring-target-vm-scheduling_mtv">7.5.1. About scheduling target VMs</a></span></li><li><span class="section"><a href="#target-vm-scheduling-prerequisites_mtv">7.5.2. Target VM scheduling prerequisites</a></span></li><li><span class="section"><a href="#target-vm-scheduling-options_mtv">7.5.3. Target VM scheduling options</a></span></li><li><span class="section"><a href="#configuring-target-vm-scheduling-cli_mtv">7.5.4. Scheduling target VMs from the command-line interface</a></span></li><li><span class="section"><a href="#configuring-target-vm-scheduling-ui_mtv">7.5.5. Scheduling target VMs from the user interface</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_upgrading-uninstalling-mtv_mtv">8. Upgrading or uninstalling the Migration Toolkit for Virtualization</a></span><ul><li><span class="section"><a href="#upgrading-mtv-ui_mtv">8.1. Upgrading the Migration Toolkit for Virtualization</a></span></li><li><span class="section"><a href="#uninstalling-mtv-ui_mtv">8.2. Uninstalling MTV by using the Red Hat OpenShift web console</a></span></li><li><span class="section"><a href="#uninstalling-mtv-cli_mtv">8.3. Uninstalling MTV from the command line</a></span></li></ul></li><li><span class="chapter"><a href="#assembly_troubleshooting-migration_mtv">9. Troubleshooting migration</a></span><ul><li><span class="section"><a href="#error-messages_mtv">9.1. Error messages</a></span><ul><li><span class="section"><a href="#warm-import-retry-limit_mtv">9.1.1. warm import retry limit reached</a></span></li><li><span class="section"><a href="#unable-resize-disk-image_mtv">9.1.2. Unable to resize disk image to required size</a></span></li></ul></li><li><span class="section"><a href="#using-must-gather_mtv">9.2. Using the must-gather tool</a></span></li><li><span class="section"><a href="#mtv-resources-and-services_mtv">9.3. MTV custom resources and services</a></span><ul><li><span class="section"><a href="#mtv_custom_resources">9.3.1. MTV custom resources</a></span></li><li><span class="section"><a href="#mtv_services">9.3.2. MTV services</a></span></li></ul></li><li><span class="section"><a href="#mtv-workflow_mtv">9.4. High-level migration workflow</a></span><ul><li><span class="section"><a href="#virt-migration-workflow_mtv">9.4.1. Detailed migration workflow</a></span></li><li><span class="section"><a href="#virt-v2v-mtv_mtv">9.4.2. How MTV uses the virt-v2v tool</a></span></li><li><span class="section"><a href="#raw-copy-mode_mtv">9.4.3. Raw copy mode</a></span></li></ul></li><li><span class="section"><a href="#collected-logs-cr-info_mtv">9.5. Collected logs and custom resource information</a></span><ul><li><span class="section"><a href="#accessing-logs-ui_mtv">9.5.1. Downloading logs and custom resource information from the web console</a></span></li><li><span class="section"><a href="#accessing-logs-cli_mtv">9.5.2. Accessing logs and custom resource information from the command line</a></span></li></ul></li></ul></li><li><span class="chapter"><a href="#assembly_mtv-performance-recommendations_mtv">10. MTV performance recommendations</a></span><ul><li><span class="section"><a href="#ref_fast-storage-network-speeds_mtv">10.1. Ensure fast storage and network speeds</a></span></li><li><span class="section"><a href="#ref_fast-datastore-read-speeds_mtv">10.2. Ensure fast datastore read speeds to ensure efficient and performant migrations</a></span></li><li><span class="section"><a href="#ref_endpoint-types_mtv">10.3. Endpoint types</a></span></li><li><span class="section"><a href="#mtv-esxi-performance_mtv">10.4. ESXi performance</a></span><ul><li><span class="section"><a href="#mtv-single-esxi-host-performance_mtv">10.4.1. Single ESXi host performance</a></span></li><li><span class="section"><a href="#mtv-multiple-esxi-host-performance_mtv">10.4.2. Multiple ESXi hosts and a single data store</a></span></li></ul></li><li><span class="section"><a href="#mtv-different-migration-network-performances_mtv">10.5. Performance using different migration networks</a></span></li><li><span class="section"><a href="#ref_avoid-network-load_mtv">10.6. Avoid additional network load on VMware networks</a></span></li><li><span class="section"><a href="#ref_control-concurrent-disk-migrations_mtv">10.7. Control maximum concurrent disk migrations per ESXi host</a></span></li><li><span class="section"><a href="#ref_concurrent-migrations-faster-migrations_mtv">10.8. Migrations are completed faster when migrating multiple VMs concurrently</a></span></li><li><span class="section"><a href="#ref_multiple-hosts-faster-migrations_mtv">10.9. Migrations complete faster using multiple hosts</a></span></li><li><span class="section"><a href="#ref_multiple-migration-plans-vs-single_mtv">10.10. Multiple migration plans compared to a single large migration plan</a></span></li><li><span class="section"><a href="#ref_maximum-values-cold-migrations_mtv">10.11. Maximum values tested for cold migrations</a></span></li><li><span class="section"><a href="#ref_warm-migration-recommendations_mtv">10.12. Warm migration recommendations</a></span></li><li><span class="section"><a href="#ref_maximum-values-warm-migrations_mtv">10.13. Maximum values tested for warm migrations</a></span></li><li><span class="section"><a href="#ref_migrating-vms-large-disks_mtv">10.14. Recommendations for migrating VMs with large disks</a></span></li><li><span class="section"><a href="#mtv-aio-buffer_mtv">10.15. Increasing AIO sizes and buffer counts for NBD transport mode</a></span><ul><li><span class="section"><a href="#mtv-aio-buffer-key-findings_mtv">10.15.1. Key findings</a></span></li><li><span class="section"><a href="#mtv-aio-buffer-key-requirements_mtv">10.15.2. Key requirements for support for AIO sizes and buffer counts</a></span></li><li><span class="section"><a href="#mtv-enable-aio-buffer_mtv">10.15.3. Enabling and configuring AIO buffering</a></span></li><li><span class="section"><a href="#mtv-disable-aio-buffer_mtv">10.15.4. Disabling AIO buffering</a></span></li></ul></li><li><span class="section"><a href="#mtv-performance-addendum_mtv">10.16. MTV performance addendum</a></span></li></ul></li><li><span class="chapter"><a href="#mtv-telemetry_mtv">11. Telemetry</a></span></li></ul></div><section class="chapter" id="con_performing-migration-intro_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Performing a migration</h1></div></div></div><p class="_abstract _abstract">
			When you have planned your migration by using the Migration Toolkit for Virtualization (MTV), you can migrate virtual machines from the following source providers to OpenShift Virtualization destination providers:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					VMware vSphere
				</li><li class="listitem">
					Red Hat Virtualization (RHV)
				</li><li class="listitem">
					OpenStack
				</li><li class="listitem">
					Open Virtual Appliances (OVAs) that were created by VMware vSphere
				</li><li class="listitem">
					Remote OpenShift Virtualization clusters
				</li></ul></div></section><section class="chapter" id="assembly_migrating-from-vmware_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Migrating from VMware vSphere</h1></div></div></div><p class="_abstract _abstract">
			Run your VMware migration plan from the MTV UI or from the command-line.
		</p><section class="section" id="prerequisites"><div class="titlepage"><div><div><h2 class="title">2.1. Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have planned your migration from VMware vSphere.
					</li></ul></div></section><section class="section" id="running-migration-plan_vmware"><div class="titlepage"><div><div><h2 class="title">2.2. Running a migration plan in the MTV UI</h2></div></div></div><p class="_abstract _abstract">
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, the date that the migration started, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The plan’s <span class="strong strong"><strong>Status</strong></span> changes to <span class="strong strong"><strong>Running</strong></span>, and the migration’s progress is displayed.
					</p><p class="simpara">
						<span class="strong strong"><strong>Warm migration only</strong></span>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								The precopy stage starts.
							</p><p class="simpara">
								A <code class="literal">PreFlightInspection</code> during warm migration enables early detection of issues during guest conversion. If an issue is detected, the warm migration fails before VM shutdown, and you can adjust VM settings or skip guest conversion. Potential errors during the <code class="literal">PreFlightInspection</code> include the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										Missing LUKS passwords
									</li><li class="listitem">
										Unsupported OS
									</li><li class="listitem">
										Unsupported FS
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						To set the cutover of the plan, perform the following steps:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the <span class="strong strong"><strong>Migration type</strong></span> column of the migration plan, click <span class="strong strong"><strong>Schedule cutover</strong></span>.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Schedule cutover</strong></span> window, set the date and time of the cutover, and then click <span class="strong strong"><strong>Set cutover</strong></span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						To edit a cutover, perform the following steps:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the <span class="strong strong"><strong>Migration type</strong></span> column of the migration plan, click <span class="strong strong"><strong>Edit cutover</strong></span>.
							</li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Edit cutover</strong></span> window, set the date and time of the cutover, and then click <span class="strong strong"><strong>Set cutover</strong></span>.
							</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
									Do not take a snapshot of a VM after you start a migration. Taking a snaphot after a migration starts might cause the migration to fail.
								</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Optional: Click the links in the migration’s <span class="strong strong"><strong>Status</strong></span> to see its overall status and the status of each VM:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The link on the left indicates whether the migration failed, succeeded, or is ongoing. It also reports the number of VMs whose migration succeeded, failed, or was canceled.
							</li><li class="listitem"><p class="simpara">
								The link on the right opens the <span class="strong strong"><strong>Virtual machines</strong></span> tab of the <span class="strong strong"><strong>Plan details</strong></span> page. For each VM, the tab displays the following data:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The name of the VM
									</li><li class="listitem">
										The start and end times of the migration
									</li><li class="listitem">
										The amount of data copied
									</li><li class="listitem"><p class="simpara">
										A progress pipeline for the VM’s migration
									</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
											vMotion, including svMotion, and relocation must be disabled for VMs that are being imported to avoid data corruption.
										</p></div></div></li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: To view your migration’s logs, either as it is running or after it is completed, perform the following actions:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click the <span class="strong strong"><strong>Virtual machines</strong></span> tab.
							</li><li class="listitem"><p class="simpara">
								Click the arrow (<span class="strong strong"><strong>&gt;</strong></span>) to the left of the virtual machine whose migration progress you want to check.
							</p><p class="simpara">
								The VM’s details are displayed.
							</p></li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Pods</strong></span> section, in the <span class="strong strong"><strong>Pod links</strong></span> column, click the <span class="strong strong"><strong>Logs</strong></span> link.
							</p><p class="simpara">
								The <span class="strong strong"><strong>Logs</strong></span> tab opens.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Logs are not always available. The following are common reasons for logs not being available:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											The migration is from OpenShift Virtualization to OpenShift Virtualization. In this case, <code class="literal">virt-v2v</code> is not involved, so no pod is required.
										</li><li class="listitem">
											No pod was created.
										</li><li class="listitem">
											The pod was deleted.
										</li><li class="listitem">
											The migration failed before running the pod.
										</li></ul></div></div></div></li><li class="listitem">
								To see the raw logs, click the <span class="strong strong"><strong>Raw</strong></span> link.
							</li><li class="listitem">
								To download the logs, click the <span class="strong strong"><strong>Download</strong></span> link.
							</li></ol></div></li></ol></div><section class="section" id="migration-plan-options-ui_vmware"><div class="titlepage"><div><div><h3 class="title">2.2.1. Migration plan options</h3></div></div></div><p class="_abstract _abstract">
					On the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
					<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
					 beside a migration plan to access the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Edit Plan</strong></span>: Edit the details of a migration plan. If the plan is running or has completed successfully, you cannot edit the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All properties on the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Plan details</strong></span> page. For example, warm or cold migration, target namespace, and preserved static IPs.
								</li><li class="listitem">
									The plan’s mapping on the <span class="strong strong"><strong>Mappings</strong></span> tab.
								</li><li class="listitem">
									The hooks listed on the <span class="strong strong"><strong>Hooks</strong></span> tab.
								</li></ul></div></li><li class="listitem">
							<span class="strong strong"><strong>Start migration</strong></span>: Active only if relevant.
						</li><li class="listitem">
							<span class="strong strong"><strong>Restart migration</strong></span>: Restart a migration that was interrupted. Before choosing this option, make sure there are no error messages. If there are, you need to edit the plan.
						</li><li class="listitem">
							<span class="strong strong"><strong>Set cutover</strong></span>: Warm migrations only. Active only if relevant. Clicking <span class="strong strong"><strong>Set cutover</strong></span> opens the <span class="strong strong"><strong>Set cutover</strong></span> window, which allows you to set the date and time for a cutover.
						</li><li class="listitem">
							<span class="strong strong"><strong>Edit cutover</strong></span>: Change the date or time of a scheduled cutover. Active only if relevant. Clicking <span class="strong strong"><strong>Edit cutover</strong></span> opens the <span class="strong strong"><strong>Edit cutover</strong></span> window, which allows you to set a new date or time for a cutover.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migrate VMs to a different namespace.
								</li><li class="listitem">
									Edit an archived migration plan.
								</li><li class="listitem">
									Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed, duplicated, or deleted.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Archive</strong></span> is irreversible. However, you can duplicate an archived plan.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Delete</strong></span> is irreversible.
							</p><p>
								Deleting a migration plan does not remove temporary resources. To remove temporary resources, archive the plan first before deleting it.
							</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The results of archiving and then deleting a migration plan vary by whether you created the plan and its storage and network mappings using the CLI or the UI.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If you created them using the UI, then the migration plan and its mappings no longer appear in the UI.
									</li><li class="listitem">
										If you created them using the CLI, then the mappings might still appear in the UI. This is because mappings in the CLI can be used by more than one migration plan, but mappings created in the UI can only be used in one migration plan.
									</li></ul></div></div></div></li></ul></div></section><section class="section" id="canceling-migration-ui_vmware"><div class="titlepage"><div><div><h3 class="title">2.2.2. Canceling a migration</h3></div></div></div><p class="_abstract _abstract">
					You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the name of a running migration plan to view the migration details.
						</li><li class="listitem">
							Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
						</p><p class="simpara">
							In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
						</p></li><li class="listitem">
							Restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
						</li></ol></div></section></section><section class="section" id="proc_migrating-virtual-machines-cli_vmware"><div class="titlepage"><div><div><h2 class="title">2.3. Running a VMware vSphere migration from the command-line</h2></div></div></div><p class="_abstract _abstract">
				You can migrate from a VMware vSphere source provider by using the command-line interface (CLI).
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Considerations</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Anti-virus software can cause migrations to fail. It is strongly recommended to remove such software from source VMs before you start a migration.
								</li><li class="listitem">
									MTV does not support migrating VMware Non-Volatile Memory Express (NVMe) disks.
								</li><li class="listitem">
									To migrate virtual machines (VMs) that have shared disks, see <a class="link" href="#mtv-shared-disks_vmware" title="2.3.2. Migrating virtual machines with shared disks">Migrating virtual machines with shared disks</a>.
								</li><li class="listitem">
									In MTV, you must add permissions at the data center level, which includes storage, networks, switches, and so on, which are used by the VM. You must then propagate the permissions to the child elements. When you specify the user permissions only on the VM, the <code class="literal">forklift-controller</code> consistently fails to reconcile a migration plan, and subsequently returns an HTTP 500 error. If you do not want to add this level of permissions, you must manually add the permissions to each object on the VM host required.
								</li></ul></div></dd></dl></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						If you are using a user-defined network (UDN), note the name of its namespace as defined in OpenShift Virtualization.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Secret</code> manifest for the source provider credentials:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: vsphere
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt;
  password: &lt;password&gt;
  insecureSkipVerify: &lt;"true"/"false"&gt;
  cacert: |
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
									Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
								</dd><dt><span class="term"><code class="literal">&lt;user&gt;</code></span></dt><dd>
									Specifies the vCenter user or the ESX/ESXi user.
								</dd><dt><span class="term"><code class="literal">&lt;password&gt;</code></span></dt><dd>
									Specifies the password of the vCenter user or the ESX/ESXi user.
								</dd><dt><span class="term"><code class="literal">&lt;"true"/"false"&gt;</code></span></dt><dd>
									Specifies <code class="literal">"true"</code> to skip certificate verification, and specifies <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</dd><dt><span class="term"><code class="literal">cacert</code></span></dt><dd>
									Specifies the CA cert object. When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the API endpoint URL of the vCenter or the ESX/ESXi, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code>.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Provider</code> manifest for the source provider:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: vsphere
  url: &lt;api_end_point&gt;
  settings:
    vddkInitImage: &lt;VDDK_image&gt;
    sdkEndpoint: vcenter
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the URL of the API endpoint, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code>.
								</dd><dt><span class="term"><code class="literal">&lt;VDDK_image&gt;</code></span></dt><dd>
									Specifies the VDDK image. This is an optional label, but it is strongly recommended to create a VDDK image to accelerate migrations. Follow OpenShift documentation to specify the VDDK image you created.
								</dd><dt><span class="term"><code class="literal">sdkEndpoint</code></span></dt><dd>
									Specifies the URL used by the provider’s SDK. Options: <code class="literal">vcenter</code> or <code class="literal">esxi</code>.
								</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
									Specifies the name of the provider <code class="literal">Secret</code> CR.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Host</code> manifest:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Host
metadata:
  name: &lt;vmware_host&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    namespace: &lt;namespace&gt;
    name: &lt;source_provider&gt;
  id: &lt;source_host_mor&gt;
  ipAddress: &lt;source_network_ip&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;source_provider&gt;</code></span></dt><dd>
									Specifies the name of the VMware vSphere <code class="literal">Provider</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;source_host_mor&gt;</code></span></dt><dd>
									Specifies the Managed Object Reference (moRef) of the VMware vSphere host. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_vmware" title="2.3.1. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</dd><dt><span class="term"><code class="literal">&lt;source_network_ip&gt;</code></span></dt><dd>
									Specifies the IP address of the VMware vSphere migration network.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
									Specifies the network type. Allowed values are <code class="literal">pod</code>, <code class="literal">multus</code>, and <code class="literal">ignored</code>. Use <code class="literal">ignored</code> to avoid attaching VMs to this network for this migration.
								</dd><dt><span class="term"><code class="literal">source</code></span></dt><dd>
									Specifies the source network. You can use either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the VMware vSphere network Managed Object Reference (moRef). To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_vmware" title="2.3.1. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
									Specifies a network attachment definition (NAD) for each additional OpenShift Virtualization network.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
									Specifies the namespace of the OpenShift Virtualization NAD. Required only when <code class="literal">type</code> is <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">namespace</code></span></dt><dd>
									Specifies the namespace. If you are using a user-defined network (UDN), its namespace is defined in OpenShift Virtualization.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="5" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        id: &lt;source_datastore&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
									Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</dd><dt><span class="term"><code class="literal">&lt;source_datastore&gt;</code></span></dt><dd>
									Specifies the VMware vSphere datastore moRef. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_vmware" title="2.3.1. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;service account&gt;</code></span></dt><dd>
									Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
								</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
									Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="7" type="1"><li class="listitem"><p class="simpara">
						Enter the following command to create the network attachment definition (NAD) of the transfer network used for MTV migrations.
					</p><p class="simpara">
						You use this definition to configure an IP address for the interface, either from the Dynamic Host Configuration Protocol (DHCP) or statically.
					</p><p class="simpara">
						Configuring the IP address enables the interface to reach the configured gateway.
					</p><pre class="programlisting language-yaml">$ oc edit NetworkAttachmentDefinitions &lt;name_of_the_NAD_to_edit&gt;
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: &lt;name_of_transfer_network&gt;
  namespace: &lt;namespace&gt;
  annotations:
    forklift.konveyor.io/route: &lt;IP_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Plan</code> manifest for the migration:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
spec:
  warm: false
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  preserveStaticIPs:
  networkNameTemplate: &lt;network_interface_template&gt;
  pvcNameTemplate: &lt;pvc_name_template&gt;
  pvcNameTemplateUseGenerateName: true
  skipGuestConversion: false
  targetAffinity: &lt;affinity rule&gt;
  targetLabels:
    label: &lt;label&gt;
  targetNodeSelector:
    &lt;key&gt;:&lt;value&gt;
  targetNamespace: &lt;target_namespace&gt;
  useCompatibilityMode: true
  volumeNameTemplate: &lt;volume_name_template&gt;
  vms:
    - id: &lt;source_vm1&gt;
    - name: &lt;source_vm2&gt;
      networkNameTemplate: &lt;network_interface_template_for_this_vm&gt;
      pvcNameTemplate: &lt;pvc_name_template_for_this_vm&gt;
      volumeNameTemplate: &lt;volume_name_template_for_this_vm&gt;
      targetName: &lt;target_name&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;

EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Plan</code> CR.
								</dd><dt><span class="term"><code class="literal">warm</code></span></dt><dd>
									Specifies whether the migration is warm - <code class="literal">true</code> - or cold - <code class="literal">false</code>. If you specify a warm migration without specifying a value for the <code class="literal">cutover</code> parameter in the <code class="literal">Migration</code> manifest, only the precopy stage will run.
								</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
									Specifies the network map and the storage map used by the plan.
								</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
									Specifies a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">NetworkMap</code> CR.
								</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
									Specifies a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">StorageMap</code> CR.
								</dd><dt><span class="term"><code class="literal">preserveStaticIPs</code></span></dt><dd>
									Specifies wheteher to prerserve static IP addresses. By default, virtual network interface controllers (vNICs) change during the migration process. As a result, vNICs that are configured with a static IP address linked to the interface name in the guest VM lose their IP address. To avoid this, set <code class="literal">preserveStaticIPs</code> to <code class="literal">true</code>. MTV issues a warning message about any VMs for which vNIC properties are missing. To retrieve any missing vNIC properties, run those VMs in vSphere in order for the vNIC properties to be reported to MTV.
								</dd><dt><span class="term"><code class="literal">networkNameTemplate</code></span></dt><dd><p class="simpara">
									Specifies a template for the network interface name for the VMs in your plan. This is an aoptional label. The template follows the Go template syntax and has access to the following variables:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<code class="literal">.NetworkName:</code> If the target network is <code class="literal">multus</code>, add the name of the Multus Network Attachment Definition. Otherwise, leave this variable empty.
										</li><li class="listitem">
											<code class="literal">.NetworkNamespace</code>: If the target network is <code class="literal">multus</code>, add the namespace where the Multus Network Attachment Definition is located.
										</li><li class="listitem">
											<code class="literal">.NetworkType</code>: Specifies the network type. Options: <code class="literal">multus</code> or <code class="literal">pod</code>.
										</li><li class="listitem"><p class="simpara">
											<code class="literal">.NetworkIndex</code>: Sequential index of the network interface (0-based).
										</p><p class="simpara">
											<span class="strong strong"><strong>Examples</strong></span>
										</p></li><li class="listitem">
											<code class="literal">"net-{{.NetworkIndex}}"</code>
										</li><li class="listitem"><p class="simpara">
											<code class="literal">{{if eq .NetworkType "pod"}}pod{{else}}multus-{{.NetworkIndex}}{{end}}"</code>
										</p><p class="simpara">
											Variable names cannot exceed 63 characters. VM names geneated by templates must not include uppercase letters or violate RFC 1123 rules. These rules apply to a network name network template, a PVC name template, a VM name template, and a volume name template.
										</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
												MTV does not validate VM names generated by the templates described here. Migrations that include VMs whose names include uppercase letters or that violate RFC 1123 rules fail automatically. To avoid failures, you might want to run a Go script that uses the <code class="literal">sprig</code> methods that MTV supports. For tables documenting the methods that MTV supports, see <a class="link" href="#mtv-template-utility_vmware" title="2.3.3. MTV template utility for VMware VM names">MTV template utility for VMware VM names</a>.
											</p></div></div></li></ul></div></dd><dt><span class="term"><code class="literal">pvcNameTemplate</code></span></dt><dd><p class="simpara">
									Specifies a template for the persistent volume claim (PVC) name for a plan. This is an optional label. The template follows the Go template syntax and has access to the following variables:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<code class="literal">.VmName</code>: Name of the VM.
										</li><li class="listitem">
											<code class="literal">.PlanName</code>: Name of the migration plan.
										</li><li class="listitem">
											<code class="literal">.DiskIndex</code>: Initial volume index of the disk.
										</li><li class="listitem">
											<code class="literal">.RootDiskIndex</code>: Index of the root disk.
										</li><li class="listitem"><p class="simpara">
											<code class="literal">.Shared</code>: Options: <code class="literal">true</code>, for a shared volume, <code class="literal">false</code>, for a non-shared volume.
										</p><p class="simpara">
											<span class="strong strong"><strong>Examples</strong></span>
										</p></li><li class="listitem">
											<code class="literal">"{{.VmName}}-disk-{{.DiskIndex}}"</code>
										</li><li class="listitem">
											<code class="literal">"{{if eq .DiskIndex .RootDiskIndex}}root{{else}}data{{end}}-{{.DiskIndex}}"</code>
										</li><li class="listitem">
											<code class="literal">"{{if .Shared}}shared-{{end}}{{.VmName}}-{{.DiskIndex}}"</code>
										</li></ul></div></dd><dt><span class="term"><code class="literal">pvcNameTemplateUseGenerateName</code></span></dt><dd><p class="simpara">
									Specifies whether to add alphanumeric characters to the name of a PVC.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											When set to <code class="literal">true</code>, MTV adds one or more randomly generated alphanumeric characters to the name of the PVC in order to ensure all PVCs have unique names.
										</li><li class="listitem"><p class="simpara">
											When set to <code class="literal">false</code>, if you specify a <code class="literal">pvcNameTemplate</code>, MTV does not add such characters to the name of the PVC.
										</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
												If you set <code class="literal">pvcNameTemplateUseGenerateName</code> to <code class="literal">false</code>, the generated PVC name might not be unique and might cause conflicts.
											</p></div></div></li></ul></div></dd><dt><span class="term"><code class="literal">skipGuestConversion</code></span></dt><dd><p class="simpara">
									Specifies whether VMs are converted before migration using the <code class="literal">virt-v2v</code> tool, which makes the VMs compatible with OpenShift Virtualization.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											When set to <code class="literal">false</code>, the default value, MTV migrates VMs using <code class="literal">virt-v2v</code>.
										</li><li class="listitem"><p class="simpara">
											When set to <code class="literal">true</code>, MTV migrates VMs using raw copy mode, which copies the VMs without converting them first.
										</p><p class="simpara">
											Raw copy mode copies VMs without converting them with <code class="literal">virt-v2v</code>. This allows for faster conversions, migrating VMs running a wider range of operating systems, as well as supporting migrating disks encrypted using Linux Unified Key Setup (LUKS) without needing keys. However, VMs migrated using raw copy mode might not function properly on OpenShift Virtualization. For more information on <code class="literal">virt-v2v</code>, see <a class="link" href="#virt-v2v-mtv_mtv" title="9.4.2. How MTV uses the virt-v2v tool">How MTV uses the virt-v2v tool</a>.
										</p></li></ul></div></dd><dt><span class="term"><code class="literal">targetAffinity</code></span></dt><dd><p class="simpara">
									Specifies a target affinity rule, which may be quite complex, is entered in lines following this label. This is an optional label.
								</p><p class="simpara">
									<code class="literal">targetAffinity</code>, <code class="literal">targetLabels</code>, and <code class="literal">targetNodeSelector</code> are labels that support VM target scheduling, a feature that lets you direct MTV to migrate virtual machines (VMs) to specific nodes or workloads (pods) of OpenShift Virtualization as well as to schedule when the VMs are powered on. For more information on the feature in general, see <a class="link" href="#target-vm-scheduling-options_mtv" title="7.5.3. Target VM scheduling options">Target VM scheduling options</a>. For more details on using the feature with the CLI, including an example YAML snippet, see <a class="link" href="#configuring-target-vm-scheduling-cli_mtv" title="7.5.4. Scheduling target VMs from the command-line interface">Scheduling target VMs from the command-line interface</a>.
								</p></dd><dt><span class="term"><code class="literal">targetLabels</code></span></dt><dd>
									Specifies organizational or operational labels to migrated VMs for identification and management. This is an optional label.
								</dd><dt><span class="term"><code class="literal">targetNodeSelector</code></span></dt><dd>
									Specifies the key-value pairs that must be matched for VMs to be scheduled on nodes. This is an optional label.
								</dd><dt><span class="term"><code class="literal">useCompatibilityMode</code></span></dt><dd><p class="simpara">
									Specifies whether the migration uses VirtIO devices or compatibility devices (SATA bus, E1000E NIC) when <code class="literal">skipGuestConversion</code> is <code class="literal">true</code>, that is, when raw copy mode is used for the migration. The setting of <code class="literal">useCompatibilityMode</code> has no effect when <code class="literal">skipGuestConversion</code> is <code class="literal">false</code>, because <code class="literal">virt-v2v</code> conversion always uses VirtIO devices.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											When set to <code class="literal">true</code>, the default setting, MTV uses compatibility devices (SATA bus, E1000E NIC) in the migration process to ensure that the VMs can be booted after migration.
										</li><li class="listitem">
											When set to <code class="literal">false</code>, MTV uses high-performance VirtIO devices in the migration process, and <code class="literal">virt-v2v</code> ensures that the VMs can be booted after migration. Before using this option, verify that VirtIO drivers are already installed in the source VMs.
										</li></ul></div></dd><dt><span class="term"><code class="literal">volumeNameTemplate</code></span></dt><dd><p class="simpara">
									Specifies a template for the volume interface name for the VMs in your plan. This is an optional label. The template follows the Go template syntax and has access to the following variables:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<code class="literal">.PVCName</code>: Name of the PVC mounted to the VM using this volume.
										</li><li class="listitem"><p class="simpara">
											<code class="literal">.VolumeIndex</code>: Sequential index of the volume interface (0-based).
										</p><p class="simpara">
											<span class="strong strong"><strong>Examples</strong></span>
										</p></li><li class="listitem">
											<code class="literal">"disk-{{.VolumeIndex}}"</code>
										</li><li class="listitem">
											<code class="literal">"pvc-{{.PVCName}}"</code>
										</li></ul></div></dd><dt><span class="term"><code class="literal">vms</code></span></dt><dd>
									Specifies the source VMs. Use either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source VMs. If you are using a UDN, verify that the IP address of the provider is outside the subnet of the UDN. If the IP address is within the subnet of the UDN, the migration fails.
								</dd><dt><span class="term"><code class="literal">&lt;source_vm1&gt;</code></span></dt><dd>
									Specifies the VMware vSphere VM moRef. To retrieve the moRef, see <a class="link" href="#retrieving-vmware-moref_vmware" title="2.3.1. Retrieving a VMware vSphere moRef">Retrieving a VMware vSphere moRef</a>.
								</dd><dt><span class="term"><code class="literal">networkNameTemplate</code></span></dt><dd>
									Specifies a network interface name for the specific VM. Overrides the value set in <code class="literal">spec:networkNameTemplate</code>. Variables and examples as in <code class="literal">spec:networkNameTemplate</code>. This is an optional label.
								</dd><dt><span class="term"><code class="literal">pvcNameTemplate</code></span></dt><dd>
									Specifies a PVC name for the specific VM. Overrides the value set in <code class="literal">spec:pvcNameTemplate</code>. Variables and examples as in <code class="literal">spec:pvcNameTemplate</code>. This is an optional label.
								</dd><dt><span class="term"><code class="literal">volumeNameTemplate</code></span></dt><dd>
									Specifies a volume name for the specific VM. Overrides the value set in <code class="literal">spec:volumeNameTemplate</code>. Variables and examples as in <code class="literal">spec:volumeNameTemplate</code>. This is an optional label.
								</dd><dt><span class="term"><code class="literal">targetName</code></span></dt><dd>
									Specifies the name of the target VM. MTV automatically generates a name for the target VM. You can override this name by using this parameter and entering a new name. The name you enter must be unique, and it must be a valid Kubernetes subdomain. Otherwise, the migration fails automatically. This is an optional label.
								</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
									Specifies up to two hooks for a migration. Each hook must run during a separate migration step. This is an optional label.
								</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Hook</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd><p class="simpara">
									Specifies the type of hook. Allowed values are <code class="literal">PreHook</code> before the migration plan starts or <code class="literal">PostHook</code> after the migration is complete.
								</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
										When you migrate a VMware 7 VM to an OpenShift 4.13+ platform that uses CentOS 7.9, the name of the network interfaces changes and the static IP configuration for the VM no longer works.
									</p></div></div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
						</p></div></div></li></ol></div><section class="section" id="retrieving-vmware-moref_vmware"><div class="titlepage"><div><div><h3 class="title">2.3.1. Retrieving a VMware vSphere moRef</h3></div></div></div><p class="_abstract _abstract">
					When you migrate VMs with a VMware vSphere source provider by using Migration Toolkit for Virtualization (MTV) from the command line, you need to know the managed object reference (moRef) of certain entities in vSphere, such as datastores, networks, and VMs.
				</p><p>
					You can retrieve the moRef of one or more vSphere entities from the Inventory service. You can then use each moRef as a reference for retrieving the moRef of another entity.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Retrieve the routes for the project:
						</p><pre class="programlisting language-terminal">oc get route -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Retrieve the <code class="literal">Inventory</code> service route:
						</p><pre class="programlisting language-terminal">$ oc get route &lt;inventory_service&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Retrieve the access token:
						</p><pre class="programlisting language-terminal">$ TOKEN=$(oc whoami -t)</pre></li><li class="listitem"><p class="simpara">
							Retrieve the moRef of a VMware vSphere provider:
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/vsphere -k</pre></li><li class="listitem"><p class="simpara">
							Retrieve the datastores of a VMware vSphere source provider:
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/vsphere/&lt;provider id&gt;/datastores/ -k</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									Example output: In this example, the moRef of the datastore <code class="literal">v2v_general_porpuse_ISCSI_DC</code> is <code class="literal">datastore-11</code> and the moRef of the datastore <code class="literal">f01-h27-640-SSD_2</code> is <code class="literal">datastore-730</code>.
								</p><pre class="programlisting language-terminal">[
  {
    "id": "datastore-11",
    "parent": {
      "kind": "Folder",
      "id": "group-s5"
    },
    "path": "/Datacenter/datastore/v2v_general_porpuse_ISCSI_DC",
    "revision": 46,
    "name": "v2v_general_porpuse_ISCSI_DC",
    "selfLink": "providers/vsphere/01278af6-e1e4-4799-b01b-d5ccc8dd0201/datastores/datastore-11"
  },
  {
    "id": "datastore-730",
    "parent": {
      "kind": "Folder",
      "id": "group-s5"
    },
    "path": "/Datacenter/datastore/f01-h27-640-SSD_2",
    "revision": 46,
    "name": "f01-h27-640-SSD_2",
    "selfLink": "providers/vsphere/01278af6-e1e4-4799-b01b-d5ccc8dd0201/datastores/datastore-730"
  },
 ...</pre></li></ul></div></li></ol></div></section><section class="section" id="mtv-shared-disks_vmware"><div class="titlepage"><div><div><h3 class="title">2.3.2. Migrating virtual machines with shared disks</h3></div></div></div><p class="_abstract _abstract">
					You can migrate VMware virtual machines (VMs) with shared disks by using the Migration Toolkit for Virtualization (MTV). This functionality is available only for cold migrations and is not available for shared boot disks.
				</p><p>
					Shared disks are disks that are attached to more than one VM and that use the multi-writer option. As a result of these characteristics, shared disks are difficult to migrate.
				</p><p>
					In certain situations, applications in VMs require shared disks. Databases and clustered file systems are the primary use cases for shared disks.
				</p><p>
					MTV version 2.7.11 or later includes a parameter named <code class="literal">migrateSharedDisks</code> in <code class="literal">Plan</code> custom resources (CRs) that instructs MTV to either migrate shared disks or to skip them during migration, as follows:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							If set to <code class="literal">true</code>, MTV migrates the shared disks. MTV uses the regular cold migration flow using <code class="literal">virt-v2v</code> and labeling the shared persistent volume claims (PVCs).
						</li><li class="listitem">
							If set to <code class="literal">false</code>, MTV skips the shared disks. MTV uses the KubeVirt Containerized-Data-Importer (CDI) for disk transfer.
						</li></ul></div><p>
					After the disk transfer, MTV automatically attempts to locate the already shared PVCs and the already migrated shared disks and attach them to the VMs.
				</p><p>
					By default, <code class="literal">migrateSharedDisks</code> is set to <code class="literal">true</code>.
				</p><p>
					To successfully migrate VMs with shared disks, create two <code class="literal">Plan</code> CRs as follows:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							In the first, set <code class="literal">migrateSharedDisks</code> to <code class="literal">true</code>.
						</p><p class="simpara">
							MTV migrates the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All shared disks.
								</li><li class="listitem">
									For each shared disk, one of the VMs that is attached to it. If possible, choose VMs so that the plan does not contain any shared disks that are connected to more than one VM. See the following figures for further guidance.
								</li><li class="listitem">
									All unshared disks attached to the VMs you choose for this plan.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							In the second, set <code class="literal">migrateSharedDisks</code> to <code class="literal">false</code>.
						</p><p class="simpara">
							MTV migrates the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All other VMs.
								</li><li class="listitem">
									The unshared disks of the VMs in the second <code class="literal">Plan</code> CR.
								</li></ul></div></li></ul></div><p>
					When MTV migrates a VM that has a shared disk to it, it does not check if it has already migrated that shared disk. Therefore, it is important to allocate the VMs in each of the two so that each shared disk is migrated once and only once.
				</p><p>
					To understand how to assign VMs and shared disks to each of the <code class="literal">Plan</code> CRs, consider the two figures that follow. In both, <code class="literal">migrateSharedDisks</code> is set to <code class="literal">true</code> for <code class="literal">plan1</code> and set to <code class="literal">false</code> for <code class="literal">plan2</code>.
				</p><p>
					In the first figure, the VMs and shared disks are assigned correctly:
				</p><div class="figure" id="idm45556787878720"><p class="title"><strong>Figure 2.1. Example of correctly assigned VMs and shared disks</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/OK_shared_disks.png" alt="Example successful migration"/></div></div></div><p>
					<code class="literal">plan1</code> migrates VMs 2 and 4, shared disks 1, 2, and 3, and the non-shared disks of VMs 2 and 4. VMs 2 and 4 are included in this plan, because they connect to all the shared disks once each.
				</p><p>
					<code class="literal">plan2</code> migrates VMs 1 and 3 and their non-shared disks. <code class="literal">plan2</code> does not migrate the shared disks connected to VMs 1 and 3 because <code class="literal">migrateSharedDisks</code> is set to <code class="literal">false</code>.
				</p><p>
					MTV migrates each VMs and its disks as follows:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							From <code class="literal">plan1</code>:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									VM 3, shared disks 1 and 2, and the non-shared disks attached to VM 3.
								</li><li class="listitem">
									VM 4, shared disk 3, and the non-shared disks attached to VM 4.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							From <code class="literal">plan2</code>:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									VM 1 and the non-shared disks attached to it.
								</li><li class="listitem">
									VM 2 and the non-shared disks attached to it.
								</li></ol></div></li></ol></div><p>
					The result is that VMs 2 and 4, all the shared disks, and all the non-shared disks are migrated, but only once. MTV is able to reattach all VMs to their disks, including the shared disks.
				</p><p>
					In the second figure, the VMs and shared disks are not assigned correctly:
				</p><div class="figure" id="idm45556786475968"><p class="title"><strong>Figure 2.2. Example of incorrectly assigned VMs and shared disks</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/not_OK_shared_disks.png" alt="Complex cyclic shared disk dependencies"/></div></div></div><p>
					In this case, MTV migrates each VMs and its disks as follows:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							From <code class="literal">plan1</code>:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									VM 2, shared disks 1 and 2, and the non-shared disks attached to VM 2.
								</li><li class="listitem">
									VM 3, shared disks 2 and 3, and the non-shared disks attached to VM 3.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							From <code class="literal">plan2</code>:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									VM 1 and the non-shared disks attached to it.
								</li><li class="listitem">
									VM 4 and the non-shared disks attached to it.
								</li></ol></div></li></ol></div><p>
					This migration "succeeds", but it results in a problem: Shared disk 2 is migrated twice by the first <code class="literal">Plan</code> CR. You can resolve this problem by using one of the two workarounds that are discussed in the Known issues section, which follows the procedure.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In MTV, create a migration plan for the shared disks, the minimum number of VMs connected to them, and the unshared disk of those VMs.
						</li><li class="listitem">
							On the VMware cluster, power off all VMs attached to the shared disks.
						</li><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Select the desired plan to open the <span class="strong strong"><strong>Plan details</strong></span> page.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>YAML</strong></span> tab of the plan.
						</li><li class="listitem"><p class="simpara">
							Verify that <code class="literal">migrateSharedDisks</code> is set to <code class="literal">true</code> as in the example that follows:
						</p><pre class="programlisting language-yaml">apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
 name: transfer-shared-disks
 namespace: openshift-mtv
spec:
 map:
   network:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: NetworkMap
     name: vsphere-7gxbs
     namespace: openshift-mtv
     uid: a3c83db3-1cf7-446a-b996-84c618946362
   storage:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: StorageMap
     name: vsphere-mqp7b
     namespace: openshift-mtv
     uid: 20b43d4f-ded4-4798-b836-7c0330d552a0
 migrateSharedDisks: true
 provider:
   destination:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: Provider
     name: host
     namespace: openshift-mtv
     uid: abf4509f-1d5f-4ff6-b1f2-18206136922a
   source:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: Provider
     name: vsphere
     namespace: openshift-mtv
     uid: be4dc7ab-fedd-460a-acae-a850f6b9543f
 targetNamespace: openshift-mtv
 vms:
   - id: vm-69
     name: vm-1-with-shared-disks</pre></li><li class="listitem">
							Start the migration of the first plan and wait for it to finish.
						</li><li class="listitem">
							Create a second <code class="literal">Plan</code> CR to migrate all the other VMs and their unshared disks to the same target namespace as the first.
						</li><li class="listitem">
							In the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, select the new plan to open the <span class="strong strong"><strong>Plan details</strong></span> page.
						</li><li class="listitem">
							Click the <span class="strong strong"><strong>YAML</strong></span> tab of the plan.
						</li><li class="listitem"><p class="simpara">
							Set <code class="literal">migrateSharedDisks</code> to <code class="literal">false</code> as in the example that follows:
						</p><pre class="programlisting language-yaml">apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
 name: skip-shared-disks
 namespace: openshift-mtv
spec:
 map:
   network:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: NetworkMap
     name: vsphere-7gxbs
     namespace: openshift-mtv
     uid: a3c83db3-1cf7-446a-b996-84c618946362
   storage:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: StorageMap
     name: vsphere-mqp7b
     namespace: openshift-mtv
     uid: 20b43d4f-ded4-4798-b836-7c0330d552a0
 migrateSharedDisks: false
 provider:
   destination:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: Provider
     name: host
     namespace: openshift-mtv
     uid: abf4509f-1d5f-4ff6-b1f2-18206136922a
   source:
     apiVersion: forklift.konveyor.io/v1beta1
     kind: Provider
     name: vsphere
     namespace: openshift-mtv
     uid: be4dc7ab-fedd-460a-acae-a850f6b9543f
 targetNamespace: openshift-mtv
 vms:
   - id: vm-71
     name: vm-2-with-shared-disks</pre></li><li class="listitem">
							Start the migration of the second plan and wait for it to finish.
						</li><li class="listitem">
							Verify that all shared disks are attached to the same VMs as they were before migration and that none are duplicated. In case of problems, see the discussion of known issues that follows.
						</li></ol></div><section class="section" id="known-issues-shared-disks_vmware"><div class="titlepage"><div><div><h4 class="title">2.3.2.1. Known issue: Cyclic shared disk dependencies</h4></div></div></div><p class="_abstract _abstract">
						When you migrate shared disks, virtual machines (VMs) with cyclic shared disk dependencies cannot be migrated successfully.
					</p><p>
						Explanation: When <code class="literal">migrateSharedDisks</code> is set to <code class="literal">true</code>, MTV migrates each VM in the plan, one by one, and any shared disks attached to it, without determining if a shared disk was already migrated.
					</p><p>
						In the case of 2 VMs sharing one disk, there is no problem. MTV transfers the shared disk and attaches the 2 VMs to the shared disk after the migration.
					</p><p>
						However, if there is a cyclic dependency of shared disks between 3 or more VMs, MTV either duplicates or omits one of the shared disks. The figure that follows illustrates the simplest version of this problem.
					</p><div class="figure" id="idm45556786791872"><p class="title"><strong>Figure 2.3. Simple example of cyclic shared disks</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/simple-cyclic-shared-disks.png" alt="Simple cyclic shared disk dependencies"/></div></div></div><p>
						In this case, the VMs and shared disks cannot be migrated in the same <code class="literal">Plan</code> CR. Although this problem could be solved using <code class="literal">migrateSharedDisks</code> and 2 <code class="literal">Plan</code> CRs, it illustrates the basic issue that must be avoided in migrating VMs with shared disks.
					</p></section><section class="section" id="cyclic-shared-disk-workarounds_vmware"><div class="titlepage"><div><div><h4 class="title">2.3.2.2. Workarounds for VMs with shared disk dependencies</h4></div></div></div><p class="_abstract _abstract">
						As discussed previously, it is important to try to create 2 <code class="literal">Plan</code> CRs in which each shared disk is migrated once. However, if your migration does result in a shared disk either being duplicated or not being transferred, you can use one of the following workarounds:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Duplicate one of the shared disks
							</li><li class="listitem">
								"Remove" one of the shared disks
							</li></ul></div><section class="section" id="duplicate-shared-disk_vmware"><div class="titlepage"><div><div><h5 class="title">2.3.2.2.1. Duplicate a shared disk</h5></div></div></div><p>
							In the figure that follows, VMs 2 and 3 are migrated with the shared disks in the first plan, and VM 1 is migrated in the second plan. This eliminates the cyclic dependencies, but there is a disadvantage to this workaround: it duplicates shared disk 3. The solution is to remove the duplicated PV and migrate VM 1 again.
						</p><div class="figure" id="idm45556786264368"><p class="title"><strong>Figure 2.4. Duplicated shared disk</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/cyclic_workaround1.png" alt="Duplicate a shared disk"/></div></div></div><p>
							Advantage: The source VMs are not affected.
						</p><p>
							Disadvantage: One shared disk gets transferred twice, so you need to manually delete the duplicate disk and reconnect VM 3 to shared disk 3 in Red Hat OpenShift after the migration.
						</p></section><section class="section" id="remove-shared-link_vmware"><div class="titlepage"><div><div><h5 class="title">2.3.2.2.2. "Remove" a shared disk</h5></div></div></div><p>
							The figure that follows shows an alternative solution: Remove the link to one of the shared disks from one source VM. Doing this breaks the cyclic dependencies. Note that in the current VMware UI, removing the link is referred to as "removing" the disk.
						</p><div class="figure" id="idm45556786985392"><p class="title"><strong>Figure 2.5. "Removed" shared disk</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/draft_workaround2.png" alt="Remove a shared disk"/></div></div></div><p>
							In this case, VM 2 and 3 are migrated with the shared disks in the first plan, but the link between VM 3 and shared disk 3 is removed. As before, VM 1 is migrated in the second plan.
						</p><p>
							Doing this breaks the cyclic dependencies, but this workaround has a drawback: VM 3 is disconnected from shared disk 3 and remains disconnected after the migration. The solution is to manually reattach shared disk 3 to VM 3 after the migration finishes.
						</p><p>
							Advantage: No disks are duplicated.
						</p><p>
							Disadvantage: You need to modify VM 3 by removing its link to shared disk 3 before the migration, and you need to manually reconnect VM 3 to shared disk 3 in Red Hat OpenShift after the migration.
						</p></section></section></section><section class="section" id="mtv-template-utility_vmware"><div class="titlepage"><div><div><h3 class="title">2.3.3. MTV template utility for VMware VM names</h3></div></div></div><p class="_abstract _abstract">
					You can use the template utility of Migration Toolkit for Virtualization (MTV) to generate names for your virtual machines (VMs). Using names generated by these methods reduces the possibilities of problems with your VMs after their migration to OpenShift Virtualization.
				</p><p>
					The tables that follow describe string and mathematical functions that you can use in templates that rename VMs for use with MTV.
				</p><div class="table" id="idm45556779103168"><p class="title"><strong>Table 2.1. String functions</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45556779097408" scope="col">Function</th><th align="left" valign="top" id="idm45556779051696" scope="col">Description</th><th align="left" valign="top" id="idm45556779050608" scope="col">Example</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">lower</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Converts a string to lowercase.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ lower "TEXT" }}</code> → <code class="literal">text</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">upper</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Converts a string to uppercase.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ upper "text" }}</code> → <code class="literal">TEXT</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">contains</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Checks if a string contains a specific substring.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ contains "hello" "lo" }}</code> → <code class="literal">true</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">replace</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Replaces occurrences in a string.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{"I Am Henry VIII" | replace "{nbsp}" "-"}}</code>→ <code class="literal">I-Am-Henry-VIII</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">trim</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Removes whitespace from both ends of a string.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ trim " text " }}</code> → <code class="literal">text</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">trimAll</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Removes specified characters from both ends of a string.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ trimAll "$" "$5.00$" }}</code> → <code class="literal">5.00</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">trimSuffix</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Removes the specified suffix from a string, if it is present.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ trimSuffix ".go" "file.go" }}</code> → <code class="literal">file</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">trimPrefix</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Removes the specified prefix from a string, if it is present.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ trimPrefix "go." "go.file" }}</code> → <code class="literal">file</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">title</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Converts a string to title case.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ title "hello world" }}</code> → <code class="literal">Hello World</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">untitle</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Converts a string in title case to lowercase.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ untitle "Hello World" }}</code>→ <code class="literal">hello world</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">repeat</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Repeats a string <span class="emphasis"><em>n</em></span> times.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ repeat 3 "abc" }}</code> → <code class="literal">abcabcabc</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">substr</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Extracts substring from <span class="emphasis"><em>index&gt;=a</em></span> to <span class="emphasis"><em>b&lt;index</em></span>.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ substr 1 4 "abcdef" }}</code> → <code class="literal">bcd</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">nospace</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Removes all whitespace from a string.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ nospace "a b c" }}</code> → <code class="literal">abc</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">trunc</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Truncates a string to specified length.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ trunc 3 "abcdef" }}</code> → <code class="literal">abc</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">initials</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Extracts the first letter of each word in a string.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ initials "John Doe" }} → `JD</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">hasPrefix</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Checks if a string starts with the specified prefix.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ hasPrefix "go" "golang" }}</code> → <code class="literal">true</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">hasSuffix</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Checks if a string ends with the specified suffix.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ hasSuffix "ing" "coding" }}</code> → <code class="literal">true</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779097408">
								<p>
									<code class="literal">mustRegexReplaceAll</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556779051696">
								<p>
									Replaces matches using regular expressions with submatch expansion.
								</p>
								</td><td align="left" valign="top" headers="idm45556779050608">
								<p>
									<code class="literal">{{ mustRegexReplaceAll "a(x*)b" "-ab-axxb-" "${1}W" }}</code> → <code class="literal">-W-xxW-</code>
								</p>
								</td></tr></tbody></table></div></div><div class="table" id="idm45556786925888"><p class="title"><strong>Table 2.2. Mathematical functions</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm45556788064944" scope="col">Function</th><th align="left" valign="top" id="idm45556788063856" scope="col">Description</th><th align="left" valign="top" id="idm45556788062768" scope="col">Example</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">add</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Sum of the numbers that follow.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ add 1 2 3 }}</code> → <code class="literal">6</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">add1</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Increment by 1.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ add1 5 }}</code> → <code class="literal">6</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">sub</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Subtract the second number from the first.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ sub 5 3 }}</code> → <code class="literal">2</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">div</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Integer division (remainder discarded).
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ div 10 3 }}</code>→<code class="literal">3</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">mod</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Modulo operation.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ mod 10 3 }}</code> → <code class="literal">1</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">multiply</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Multiply the numbers that follow.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ mul 2 3 4 }}</code> → <code class="literal">24</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">max</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Return the largest of the following integers.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ max 1 5 3 }}</code> → <code class="literal">5</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">min</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Return the smallest of the following integers.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ min 1 5 3 }}</code> → <code class="literal">1</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">floor</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Round the following number down to the nearest integer.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ floor 3.75 }}</code> → <code class="literal">3.0</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">ceil</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Round the following number up to the nearest integer.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ ceil 3.25 }}</code> → <code class="literal">4.0</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556788064944">
								<p>
									<code class="literal">round</code>
								</p>
								</td><td align="left" valign="top" headers="idm45556788063856">
								<p>
									Round the following number to the specified number of decimal places.
								</p>
								</td><td align="left" valign="top" headers="idm45556788062768">
								<p>
									<code class="literal">{{ round 3.75159 2 }}</code> → <code class="literal">3.75</code>
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="canceling-migration-cli_vmware"><div class="titlepage"><div><div><h3 class="title">2.3.4. Canceling a migration from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to cancel either an entire migration or the migration of specific virtual machines (VMs) while a migration is in progress.
				</p><section class="section" id="canceling-migration-cli-entire_vmware"><div class="titlepage"><div><div><h4 class="title">2.3.4.1. Canceling an entire migration from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel an entire migration while a migration is in progress.
					</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Delete the <code class="literal">Migration</code> CR:
							</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt;</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;migration&gt;</code></span></dt><dd>
											Specifies the name of the <code class="literal">Migration</code> CR.
										</dd></dl></div></li></ul></div></section><section class="section" id="canceling-migration-cli-specific_vmware"><div class="titlepage"><div><div><h4 class="title">2.3.4.2. Canceling the migration of specific VMs from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel the migration of specific virtual machines (VMs) while a migration is in progress.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Add the specific VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest, following this example:
							</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102
  - id: vm-203
    name: rhel8-vm
EOF</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code> or <code class="literal">name</code></span></dt><dd><p class="simpara">
											Specifies a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
										</p><p class="simpara">
											The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a Red Hat Virtualization VM.
										</p></dd></dl></div></li><li class="listitem"><p class="simpara">
								Retrieve the <code class="literal">Migration</code> custom resource (CR) to monitor the progress of the remaining VMs, following this example:
							</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section></section></section><section class="chapter" id="assembly_migrating-from-rhv_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Migrating from Red Hat Virtualization</h1></div></div></div><p class="_abstract _abstract">
			Run your Red Hat Virtualization migration plan from the MTV UI or from the command-line.
		</p><section class="section" id="prerequisites_2"><div class="titlepage"><div><div><h2 class="title">3.1. Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have planned your migration from Red Hat Virtualization.
					</li></ul></div></section><section class="section" id="running-migration-plan_rhv"><div class="titlepage"><div><div><h2 class="title">3.2. Running a migration plan in the MTV UI</h2></div></div></div><p class="_abstract _abstract">
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, the date that the migration started, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The plan’s <span class="strong strong"><strong>Status</strong></span> changes to <span class="strong strong"><strong>Running</strong></span>, and the migration’s progress is displayed.
					</p><p class="simpara">
						<span class="strong strong"><strong>Warm migration only</strong></span>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								The precopy stage starts.
							</p><p class="simpara">
								A <code class="literal">PreFlightInspection</code> during warm migration enables early detection of issues during guest conversion. If an issue is detected, the warm migration fails before VM shutdown, and you can adjust VM settings or skip guest conversion. Potential errors during the <code class="literal">PreFlightInspection</code> include the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										Missing LUKS passwords
									</li><li class="listitem">
										Unsupported OS
									</li><li class="listitem">
										Unsupported FS
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						To set the cutover of the plan, perform the following steps:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the <span class="strong strong"><strong>Migration type</strong></span> column of the migration plan, click <span class="strong strong"><strong>Schedule cutover</strong></span>.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Schedule cutover</strong></span> window, set the date and time of the cutover, and then click <span class="strong strong"><strong>Set cutover</strong></span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						To edit a cutover, perform the following steps:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the <span class="strong strong"><strong>Migration type</strong></span> column of the migration plan, click <span class="strong strong"><strong>Edit cutover</strong></span>.
							</li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Edit cutover</strong></span> window, set the date and time of the cutover, and then click <span class="strong strong"><strong>Set cutover</strong></span>.
							</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
									Do not take a snapshot of a VM after you start a migration. Taking a snaphot after a migration starts might cause the migration to fail.
								</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Optional: Click the links in the migration’s <span class="strong strong"><strong>Status</strong></span> to see its overall status and the status of each VM:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The link on the left indicates whether the migration failed, succeeded, or is ongoing. It also reports the number of VMs whose migration succeeded, failed, or was canceled.
							</li><li class="listitem"><p class="simpara">
								The link on the right opens the <span class="strong strong"><strong>Virtual machines</strong></span> tab of the <span class="strong strong"><strong>Plan details</strong></span> page. For each VM, the tab displays the following data:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The name of the VM
									</li><li class="listitem">
										The start and end times of the migration
									</li><li class="listitem">
										The amount of data copied
									</li><li class="listitem">
										A progress pipeline for the VM’s migration
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: To view your migration’s logs, either as it is running or after it is completed, perform the following actions:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click the <span class="strong strong"><strong>Virtual machines</strong></span> tab.
							</li><li class="listitem"><p class="simpara">
								Click the arrow (<span class="strong strong"><strong>&gt;</strong></span>) to the left of the virtual machine whose migration progress you want to check.
							</p><p class="simpara">
								The VM’s details are displayed.
							</p></li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Pods</strong></span> section, in the <span class="strong strong"><strong>Pod links</strong></span> column, click the <span class="strong strong"><strong>Logs</strong></span> link.
							</p><p class="simpara">
								The <span class="strong strong"><strong>Logs</strong></span> tab opens.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Logs are not always available. The following are common reasons for logs not being available:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											The migration is from OpenShift Virtualization to OpenShift Virtualization. In this case, <code class="literal">virt-v2v</code> is not involved, so no pod is required.
										</li><li class="listitem">
											No pod was created.
										</li><li class="listitem">
											The pod was deleted.
										</li><li class="listitem">
											The migration failed before running the pod.
										</li></ul></div></div></div></li><li class="listitem">
								To see the raw logs, click the <span class="strong strong"><strong>Raw</strong></span> link.
							</li><li class="listitem">
								To download the logs, click the <span class="strong strong"><strong>Download</strong></span> link.
							</li></ol></div></li></ol></div><section class="section" id="migration-plan-options-ui_rhv"><div class="titlepage"><div><div><h3 class="title">3.2.1. Migration plan options</h3></div></div></div><p class="_abstract _abstract">
					On the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
					<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
					 beside a migration plan to access the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Edit Plan</strong></span>: Edit the details of a migration plan. If the plan is running or has completed successfully, you cannot edit the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All properties on the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Plan details</strong></span> page. For example, warm or cold migration, target namespace, and preserved static IPs.
								</li><li class="listitem">
									The plan’s mapping on the <span class="strong strong"><strong>Mappings</strong></span> tab.
								</li><li class="listitem">
									The hooks listed on the <span class="strong strong"><strong>Hooks</strong></span> tab.
								</li></ul></div></li><li class="listitem">
							<span class="strong strong"><strong>Start migration</strong></span>: Active only if relevant.
						</li><li class="listitem">
							<span class="strong strong"><strong>Restart migration</strong></span>: Restart a migration that was interrupted. Before choosing this option, make sure there are no error messages. If there are, you need to edit the plan.
						</li><li class="listitem">
							<span class="strong strong"><strong>Set cutover</strong></span>: Warm migrations only. Active only if relevant. Clicking <span class="strong strong"><strong>Set cutover</strong></span> opens the <span class="strong strong"><strong>Set cutover</strong></span> window, which allows you to set the date and time for a cutover.
						</li><li class="listitem">
							<span class="strong strong"><strong>Edit cutover</strong></span>: Change the date or time of a scheduled cutover. Active only if relevant. Clicking <span class="strong strong"><strong>Edit cutover</strong></span> opens the <span class="strong strong"><strong>Edit cutover</strong></span> window, which allows you to set a new date or time for a cutover.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migrate VMs to a different namespace.
								</li><li class="listitem">
									Edit an archived migration plan.
								</li><li class="listitem">
									Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed, duplicated, or deleted.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Archive</strong></span> is irreversible. However, you can duplicate an archived plan.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Delete</strong></span> is irreversible.
							</p><p>
								Deleting a migration plan does not remove temporary resources. To remove temporary resources, archive the plan first before deleting it.
							</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The results of archiving and then deleting a migration plan vary by whether you created the plan and its storage and network mappings using the CLI or the UI.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If you created them using the UI, then the migration plan and its mappings no longer appear in the UI.
									</li><li class="listitem">
										If you created them using the CLI, then the mappings might still appear in the UI. This is because mappings in the CLI can be used by more than one migration plan, but mappings created in the UI can only be used in one migration plan.
									</li></ul></div></div></div></li></ul></div></section><section class="section" id="canceling-migration-ui_rhv"><div class="titlepage"><div><div><h3 class="title">3.2.2. Canceling a migration</h3></div></div></div><p class="_abstract _abstract">
					You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the name of a running migration plan to view the migration details.
						</li><li class="listitem">
							Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
						</p><p class="simpara">
							In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
						</p></li><li class="listitem">
							Restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
						</li></ol></div></section></section><section class="section" id="proc_migrating-virtual-machines-cli_rhv"><div class="titlepage"><div><div><h2 class="title">3.3. Running a Red Hat Virtualization migration from the command-line</h2></div></div></div><p class="_abstract _abstract">
				You can migrate from a Red Hat Virtualization source provider by using the command-line interface (CLI).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						If you are using a user-defined network (UDN), note the name of its namespace as defined in OpenShift Virtualization.
					</li><li class="listitem">
						If you are migrating a virtual machine with a direct LUN disk, ensure that the nodes in the OpenShift Virtualization destination cluster can access the backend storage.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Unlike disk images that <span class="emphasis"><em>are copied</em></span> from a source provider to a target provider, LUNs are <span class="emphasis"><em>detached</em></span>, <span class="emphasis"><em>but not removed</em></span>, from virtual machines in the source provider and then attached to the virtual machines (VMs) that are created in the target provider.
						</li><li class="listitem">
							LUNs are not removed from the source provider during the migration in case fallback to the source provider is required. However, before re-attaching the LUNs to VMs in the source provider, ensure that the LUNs are not used by VMs on the target environment at the same time, which might lead to data corruption.
						</li></ul></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Secret</code> manifest for the source provider credentials:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ovirt
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt;
  password: &lt;password&gt;
  insecureSkipVerify: &lt;"true"/"false"&gt;
  cacert: |
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
									Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
								</dd><dt><span class="term"><code class="literal">&lt;user&gt;</code></span></dt><dd>
									Specifies the Red Hat Virtualization Manager user.
								</dd><dt><span class="term"><code class="literal">&lt;password&gt;</code></span></dt><dd>
									Specifies the user’s password.
								</dd><dt><span class="term"><code class="literal">&lt;"true"/"false"&gt;</code></span></dt><dd>
									Specifies <code class="literal">"true"</code> to skip certificate verification, and specifies <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</dd><dt><span class="term"><code class="literal">cacert</code></span></dt><dd>
									Specifies the CA cert object. Enter the Manager CA certificate, unless it was replaced by a third-party certificate, in which case, enter the Manager Apache CA certificate. You can retrieve the Manager CA certificate at <a class="link" href="https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA">https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a>.
								</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the API endpoint URL, for example, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code>.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Provider</code> manifest for the source provider:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ovirt
  url: &lt;api_end_point&gt;
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the URL of the API endpoint, for example, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code>.
								</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
									Specifies the name of the provider <code class="literal">Secret</code> CR.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
									Specifies the network type. Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">source</code></span></dt><dd>
									Specifies the source network. You can use either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the Red Hat Virtualization network Universal Unique ID (UUID).
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
									Specifies a network attachment definition (NAD) for each additional OpenShift Virtualization network.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
									Specifies the namespace of the OpenShift Virtualization NAD. Required only when <code class="literal">type</code> is <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">namespace</code></span></dt><dd>
									Specifies the namespace. If you are using a user-defined network (UDN), its namespace is defined in OpenShift Virtualization.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        id: &lt;source_storage_domain&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
									Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</dd><dt><span class="term"><code class="literal">&lt;source_storage_domain&gt;</code></span></dt><dd>
									Specifies the Red Hat Virtualization storage domain UUID. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;service account&gt;</code></span></dt><dd>
									Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
								</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
									Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
						Enter the following command to create the network attachment definition (NAD) of the transfer network used for MTV migrations.
					</p><p class="simpara">
						You use this definition to configure an IP address for the interface, either from the Dynamic Host Configuration Protocol (DHCP) or statically.
					</p><p class="simpara">
						Configuring the IP address enables the interface to reach the configured gateway.
					</p><pre class="programlisting language-yaml">$ oc edit NetworkAttachmentDefinitions &lt;name_of_the_NAD_to_edit&gt;
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: &lt;name_of_transfer_network&gt;
  namespace: &lt;namespace&gt;
  annotations:
    forklift.konveyor.io/route: &lt;IP_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Plan</code> manifest for the migration:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
  preserveClusterCpuModel: true
spec:
  warm: false
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - id: &lt;source_vm1&gt;
    - name: &lt;source_vm2&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Plan</code> CR.
								</dd><dt><span class="term"><code class="literal">preserveClusterCpuModel</code></span></dt><dd>
									Specifies whether a custom CPU model is used, as detailed in the note that follows.
								</dd><dt><span class="term"><code class="literal">warm</code></span></dt><dd>
									Specifies whether the migration is warm or cold. If you specify a warm migration without specifying a value for the <code class="literal">cutover</code> parameter in the <code class="literal">Migration</code> manifest, only the precopy stage will run.
								</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
									Specifies the network map and the storage map used by the plan.
								</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
									Specifies a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">NetworkMap</code> CR.
								</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
									Specifies a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">StorageMap</code> CR.
								</dd><dt><span class="term"><code class="literal">vms</code></span></dt><dd>
									Specifies the source VM. Use either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source VMs. If you are using a UDN, verify that the IP address of the provider is outside the subnet of the UDN. If the IP address is within the subnet of the UDN, the migration fails.
								</dd><dt><span class="term"><code class="literal">&lt;source_vm1&gt;</code></span></dt><dd>
									Specifies the Red Hat Virtualization VM UUID.
								</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
									Specifies up to two hooks for a migration. Each hook must run during a separate migration step. This is an optional label.
								</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Hook</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd><p class="simpara">
									Specifies the type of hook. Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
												If the migrated machine is set with a custom CPU model, it will be set with that CPU model in the destination cluster, regardless of the setting of <code class="literal">preserveClusterCpuModel</code>.
											</li><li class="listitem"><p class="simpara">
												If the migrated machine is <span class="emphasis"><em>not</em></span> set with a custom CPU model:
											</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
														If <code class="literal">preserveClusterCpuModel</code> is set to <code class="literal">true</code>, MTV checks the CPU model of the VM when it runs in Red Hat Virtualization, based on the cluster’s configuration, and then sets the migrated VM with that CPU model.
													</li><li class="listitem">
														If <code class="literal">preserveClusterCpuModel</code> is set to <code class="literal">false</code>, MTV does not set a CPU type and the VM is set with the default CPU model of the destination cluster.
													</li></ul></div></li></ul></div></div></div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
						</p></div></div></li></ol></div><section class="section" id="canceling-migration-cli_rhv"><div class="titlepage"><div><div><h3 class="title">3.3.1. Canceling a migration from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to cancel either an entire migration or the migration of specific virtual machines (VMs) while a migration is in progress.
				</p><section class="section" id="canceling-migration-cli-entire_rhv"><div class="titlepage"><div><div><h4 class="title">3.3.1.1. Canceling an entire migration from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel an entire migration while a migration is in progress.
					</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Delete the <code class="literal">Migration</code> CR:
							</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt;</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;migration&gt;</code></span></dt><dd>
											Specifies the name of the <code class="literal">Migration</code> CR.
										</dd></dl></div></li></ul></div></section><section class="section" id="canceling-migration-cli-specific_rhv"><div class="titlepage"><div><div><h4 class="title">3.3.1.2. Canceling the migration of specific VMs from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel the migration of specific virtual machines (VMs) while a migration is in progress.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Add the specific VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest, following this example:
							</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102
  - id: vm-203
    name: rhel8-vm
EOF</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code> or <code class="literal">name</code></span></dt><dd><p class="simpara">
											Specifies a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
										</p><p class="simpara">
											The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a Red Hat Virtualization VM.
										</p></dd></dl></div></li><li class="listitem"><p class="simpara">
								Retrieve the <code class="literal">Migration</code> custom resource (CR) to monitor the progress of the remaining VMs, following this example:
							</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section></section></section><section class="chapter" id="assembly_migrating-from-osp_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Migrating from OpenStack</h1></div></div></div><p class="_abstract _abstract">
			Run your OpenStack migration plan from the MTV UI or from the command-line.
		</p><section class="section" id="prerequisites_3"><div class="titlepage"><div><div><h2 class="title">4.1. Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have planned your migration from OpenStack.
					</li></ul></div></section><section class="section" id="running-migration-plan_ostack"><div class="titlepage"><div><div><h2 class="title">4.2. Running a migration plan in the MTV UI</h2></div></div></div><p class="_abstract _abstract">
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, the date that the migration started, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The plan’s <span class="strong strong"><strong>Status</strong></span> changes to <span class="strong strong"><strong>Running</strong></span>, and the migration’s progress is displayed.
					</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
							Do not take a snapshot of a VM after you start a migration. Taking a snaphot after a migration starts might cause the migration to fail.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Optional: Click the links in the migration’s <span class="strong strong"><strong>Status</strong></span> to see its overall status and the status of each VM:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The link on the left indicates whether the migration failed, succeeded, or is ongoing. It also reports the number of VMs whose migration succeeded, failed, or was canceled.
							</li><li class="listitem"><p class="simpara">
								The link on the right opens the <span class="strong strong"><strong>Virtual machines</strong></span> tab of the <span class="strong strong"><strong>Plan details</strong></span> page. For each VM, the tab displays the following data:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The name of the VM
									</li><li class="listitem">
										The start and end times of the migration
									</li><li class="listitem">
										The amount of data copied
									</li><li class="listitem">
										A progress pipeline for the VM’s migration
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: To view your migration’s logs, either as it is running or after it is completed, perform the following actions:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click the <span class="strong strong"><strong>Virtual machines</strong></span> tab.
							</li><li class="listitem"><p class="simpara">
								Click the arrow (<span class="strong strong"><strong>&gt;</strong></span>) to the left of the virtual machine whose migration progress you want to check.
							</p><p class="simpara">
								The VM’s details are displayed.
							</p></li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Pods</strong></span> section, in the <span class="strong strong"><strong>Pod links</strong></span> column, click the <span class="strong strong"><strong>Logs</strong></span> link.
							</p><p class="simpara">
								The <span class="strong strong"><strong>Logs</strong></span> tab opens.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Logs are not always available. The following are common reasons for logs not being available:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											The migration is from OpenShift Virtualization to OpenShift Virtualization. In this case, <code class="literal">virt-v2v</code> is not involved, so no pod is required.
										</li><li class="listitem">
											No pod was created.
										</li><li class="listitem">
											The pod was deleted.
										</li><li class="listitem">
											The migration failed before running the pod.
										</li></ul></div></div></div></li><li class="listitem">
								To see the raw logs, click the <span class="strong strong"><strong>Raw</strong></span> link.
							</li><li class="listitem">
								To download the logs, click the <span class="strong strong"><strong>Download</strong></span> link.
							</li></ol></div></li></ol></div><section class="section" id="migration-plan-options-ui_ostack"><div class="titlepage"><div><div><h3 class="title">4.2.1. Migration plan options</h3></div></div></div><p class="_abstract _abstract">
					On the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
					<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
					 beside a migration plan to access the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Edit Plan</strong></span>: Edit the details of a migration plan. If the plan is running or has completed successfully, you cannot edit the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All properties on the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Plan details</strong></span> page. For example, warm or cold migration, target namespace, and preserved static IPs.
								</li><li class="listitem">
									The plan’s mapping on the <span class="strong strong"><strong>Mappings</strong></span> tab.
								</li><li class="listitem">
									The hooks listed on the <span class="strong strong"><strong>Hooks</strong></span> tab.
								</li></ul></div></li><li class="listitem">
							<span class="strong strong"><strong>Start migration</strong></span>: Active only if relevant.
						</li><li class="listitem">
							<span class="strong strong"><strong>Restart migration</strong></span>: Restart a migration that was interrupted. Before choosing this option, make sure there are no error messages. If there are, you need to edit the plan.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migrate VMs to a different namespace.
								</li><li class="listitem">
									Edit an archived migration plan.
								</li><li class="listitem">
									Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed, duplicated, or deleted.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Archive</strong></span> is irreversible. However, you can duplicate an archived plan.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Delete</strong></span> is irreversible.
							</p><p>
								Deleting a migration plan does not remove temporary resources. To remove temporary resources, archive the plan first before deleting it.
							</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The results of archiving and then deleting a migration plan vary by whether you created the plan and its storage and network mappings using the CLI or the UI.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If you created them using the UI, then the migration plan and its mappings no longer appear in the UI.
									</li><li class="listitem">
										If you created them using the CLI, then the mappings might still appear in the UI. This is because mappings in the CLI can be used by more than one migration plan, but mappings created in the UI can only be used in one migration plan.
									</li></ul></div></div></div></li></ul></div></section><section class="section" id="canceling-migration-ui_ostack"><div class="titlepage"><div><div><h3 class="title">4.2.2. Canceling a migration</h3></div></div></div><p class="_abstract _abstract">
					You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the name of a running migration plan to view the migration details.
						</li><li class="listitem">
							Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
						</p><p class="simpara">
							In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
						</p></li><li class="listitem">
							Restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
						</li></ol></div></section></section><section class="section" id="proc_migrating-virtual-machines-cli_ostack"><div class="titlepage"><div><div><h2 class="title">4.3. Running an OpenStack migration from the command-line</h2></div></div></div><p class="_abstract _abstract">
				You can migrate from an OpenStack source provider by using the command-line interface (CLI).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						If you are using a user-defined network (UDN), note the name of its namespace as defined in OpenShift Virtualization.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Secret</code> manifest for the source provider credentials:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openstack
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt;
  password: &lt;password&gt;
  insecureSkipVerify: &lt;"true"/"false"&gt;
  domainName: &lt;domain_name&gt;
  projectName: &lt;project_name&gt;
  regionName: &lt;region_name&gt;
  cacert: |
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
									Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
								</dd><dt><span class="term"><code class="literal">&lt;user&gt;</code></span></dt><dd>
									Specifies the OpenStack user.
								</dd><dt><span class="term"><code class="literal">&lt;password&gt;</code></span></dt><dd>
									Specifies the user OpenStack password.
								</dd><dt><span class="term"><code class="literal">&lt;"true"/"false"&gt;</code></span></dt><dd>
									Specifies <code class="literal">"true"</code> to skip certificate verification, and specifies <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</dd><dt><span class="term"><code class="literal">cacert</code></span></dt><dd>
									Specifies the CA cert object. When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the API endpoint URL, for example, <code class="literal">https://&lt;identity_service&gt;/v3</code>.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Provider</code> manifest for the source provider:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openstack
  url: &lt;api_end_point&gt;
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the URL of the API endpoint.
								</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
									Specifies the name of the provider <code class="literal">Secret</code> CR.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
									Specifies the network type. Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">source</code></span></dt><dd>
									Specifies the source network. You can use either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source network. For <code class="literal">id</code>, specify the OpenStack network UUID.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
									Specifies a network attachment definition (NAD) for each additional OpenShift Virtualization network.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
									Specifies the namespace of the OpenShift Virtualization NAD. Required only when <code class="literal">type</code> is <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">namespace</code></span></dt><dd>
									Specifies the namespace.If you are using a user-defined network (UDN), its namespace is defined in OpenShift Virtualization.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        id: &lt;source_volume_type&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
									Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</dd><dt><span class="term"><code class="literal">&lt;source_volume_type&gt;</code></span></dt><dd>
									Specifies the OpenStack <code class="literal">volume_type</code> UUID. For example, <code class="literal">f2737930-b567-451a-9ceb-2887f6207009</code>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;service account&gt;</code></span></dt><dd>
									Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
								</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
									Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
						Enter the following command to create the network attachment definition (NAD) of the transfer network used for MTV migrations.
					</p><p class="simpara">
						You use this definition to configure an IP address for the interface, either from the Dynamic Host Configuration Protocol (DHCP) or statically.
					</p><p class="simpara">
						Configuring the IP address enables the interface to reach the configured gateway.
					</p><pre class="programlisting language-yaml">$ oc edit NetworkAttachmentDefinitions &lt;name_of_the_NAD_to_edit&gt;
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: &lt;name_of_transfer_network&gt;
  namespace: &lt;namespace&gt;
  annotations:
    forklift.konveyor.io/route: &lt;IP_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Plan</code> manifest for the migration:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - id: &lt;source_vm1&gt;
    - name: &lt;source_vm2&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Plan</code> CR.
								</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
									Specifies only one network map and one storage map per plan.
								</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
									Specifies a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">NetworkMap</code> CR.
								</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
									Specifies a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">StorageMap</code> CR.
								</dd><dt><span class="term"><code class="literal">vms</code></span></dt><dd>
									Specifies the source VMs. Accepts either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source VMs. If you are using a UDN, verify that the IP address of the provider is outside the subnet of the UDN. If the IP address is within the subnet of the UDN, the migration fails.
								</dd><dt><span class="term"><code class="literal">&lt;source_vm1&gt;</code></span></dt><dd>
									Specifies the OpenStack VM UUID.
								</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
									Specifies up to two hooks for a VM. Each hook must run during a separate migration step. This is an optional label.
								</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Hook</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd>
									Specifies the type of hook. Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
						</p></div></div></li></ol></div><section class="section" id="canceling-migration-cli_ostack"><div class="titlepage"><div><div><h3 class="title">4.3.1. Canceling a migration from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to cancel either an entire migration or the migration of specific virtual machines (VMs) while a migration is in progress.
				</p><section class="section" id="canceling-migration-cli-entire_ostack"><div class="titlepage"><div><div><h4 class="title">4.3.1.1. Canceling an entire migration from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel an entire migration while a migration is in progress.
					</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Delete the <code class="literal">Migration</code> CR:
							</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt;</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;migration&gt;</code></span></dt><dd>
											Specifies the name of the <code class="literal">Migration</code> CR.
										</dd></dl></div></li></ul></div></section><section class="section" id="canceling-migration-cli-specific_ostack"><div class="titlepage"><div><div><h4 class="title">4.3.1.2. Canceling the migration of specific VMs from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel the migration of specific virtual machines (VMs) while a migration is in progress.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Add the specific VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest, following this example:
							</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102
  - id: vm-203
    name: rhel8-vm
EOF</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code> or <code class="literal">name</code></span></dt><dd><p class="simpara">
											Specifies a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
										</p><p class="simpara">
											The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a Red Hat Virtualization VM.
										</p></dd></dl></div></li><li class="listitem"><p class="simpara">
								Retrieve the <code class="literal">Migration</code> custom resource (CR) to monitor the progress of the remaining VMs, following this example:
							</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section></section></section><section class="chapter" id="assembly_migrating-from-ova_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Migrating from OVA</h1></div></div></div><p class="_abstract _abstract">
			Run your OVA migration plan from the MTV UI or from the command-line.
		</p><section class="section" id="prerequisites_4"><div class="titlepage"><div><div><h2 class="title">5.1. Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have planned your migration from OVA.
					</li></ul></div></section><section class="section" id="running-migration-plan_ova"><div class="titlepage"><div><div><h2 class="title">5.2. Running a migration plan in the MTV UI</h2></div></div></div><p class="_abstract _abstract">
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, the date that the migration started, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The plan’s <span class="strong strong"><strong>Status</strong></span> changes to <span class="strong strong"><strong>Running</strong></span>, and the migration’s progress is displayed.
					</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
							Do not take a snapshot of a VM after you start a migration. Taking a snaphot after a migration starts might cause the migration to fail.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Optional: Click the links in the migration’s <span class="strong strong"><strong>Status</strong></span> to see its overall status and the status of each VM:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The link on the left indicates whether the migration failed, succeeded, or is ongoing. It also reports the number of VMs whose migration succeeded, failed, or was canceled.
							</li><li class="listitem"><p class="simpara">
								The link on the right opens the <span class="strong strong"><strong>Virtual machines</strong></span> tab of the <span class="strong strong"><strong>Plan details</strong></span> page. For each VM, the tab displays the following data:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The name of the VM
									</li><li class="listitem">
										The start and end times of the migration
									</li><li class="listitem">
										The amount of data copied
									</li><li class="listitem">
										A progress pipeline for the VM’s migration
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: To view your migration’s logs, either as it is running or after it is completed, perform the following actions:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click the <span class="strong strong"><strong>Virtual machines</strong></span> tab.
							</li><li class="listitem"><p class="simpara">
								Click the arrow (<span class="strong strong"><strong>&gt;</strong></span>) to the left of the virtual machine whose migration progress you want to check.
							</p><p class="simpara">
								The VM’s details are displayed.
							</p></li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Pods</strong></span> section, in the <span class="strong strong"><strong>Pod links</strong></span> column, click the <span class="strong strong"><strong>Logs</strong></span> link.
							</p><p class="simpara">
								The <span class="strong strong"><strong>Logs</strong></span> tab opens.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Logs are not always available. The following are common reasons for logs not being available:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											The migration is from OpenShift Virtualization to OpenShift Virtualization. In this case, <code class="literal">virt-v2v</code> is not involved, so no pod is required.
										</li><li class="listitem">
											No pod was created.
										</li><li class="listitem">
											The pod was deleted.
										</li><li class="listitem">
											The migration failed before running the pod.
										</li></ul></div></div></div></li><li class="listitem">
								To see the raw logs, click the <span class="strong strong"><strong>Raw</strong></span> link.
							</li><li class="listitem">
								To download the logs, click the <span class="strong strong"><strong>Download</strong></span> link.
							</li></ol></div></li></ol></div><section class="section" id="migration-plan-options-ui_ova"><div class="titlepage"><div><div><h3 class="title">5.2.1. Migration plan options</h3></div></div></div><p class="_abstract _abstract">
					On the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
					<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
					 beside a migration plan to access the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Edit Plan</strong></span>: Edit the details of a migration plan. If the plan is running or has completed successfully, you cannot edit the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All properties on the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Plan details</strong></span> page. For example, warm or cold migration, target namespace, and preserved static IPs.
								</li><li class="listitem">
									The plan’s mapping on the <span class="strong strong"><strong>Mappings</strong></span> tab.
								</li><li class="listitem">
									The hooks listed on the <span class="strong strong"><strong>Hooks</strong></span> tab.
								</li></ul></div></li><li class="listitem">
							<span class="strong strong"><strong>Start migration</strong></span>: Active only if relevant.
						</li><li class="listitem">
							<span class="strong strong"><strong>Restart migration</strong></span>: Restart a migration that was interrupted. Before choosing this option, make sure there are no error messages. If there are, you need to edit the plan.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migrate VMs to a different namespace.
								</li><li class="listitem">
									Edit an archived migration plan.
								</li><li class="listitem">
									Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed, duplicated, or deleted.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Archive</strong></span> is irreversible. However, you can duplicate an archived plan.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Delete</strong></span> is irreversible.
							</p><p>
								Deleting a migration plan does not remove temporary resources. To remove temporary resources, archive the plan first before deleting it.
							</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The results of archiving and then deleting a migration plan vary by whether you created the plan and its storage and network mappings using the CLI or the UI.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If you created them using the UI, then the migration plan and its mappings no longer appear in the UI.
									</li><li class="listitem">
										If you created them using the CLI, then the mappings might still appear in the UI. This is because mappings in the CLI can be used by more than one migration plan, but mappings created in the UI can only be used in one migration plan.
									</li></ul></div></div></div></li></ul></div></section><section class="section" id="canceling-migration-ui_ova"><div class="titlepage"><div><div><h3 class="title">5.2.2. Canceling a migration</h3></div></div></div><p class="_abstract _abstract">
					You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the name of a running migration plan to view the migration details.
						</li><li class="listitem">
							Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
						</p><p class="simpara">
							In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
						</p></li><li class="listitem">
							Restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
						</li></ol></div></section></section><section class="section" id="proc_migrating-virtual-machines-cli_ova"><div class="titlepage"><div><div><h2 class="title">5.3. Running an Open Virtual Appliance (OVA) migration from the command-line</h2></div></div></div><p class="_abstract _abstract">
				You can migrate from Open Virtual Appliance (OVA) files that were created by VMware vSphere as a source provider by using the command-line interface (CLI).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						If you are using a user-defined network (UDN), note the name of its namespace as defined in OpenShift Virtualization.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Secret</code> manifest for the source provider credentials:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ova
    createdForResourceType: providers
type: Opaque
stringData:
  url: &lt;nfs_server:/nfs_path&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
									Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
								</dd><dt><span class="term"><code class="literal">&lt;nfs_server:/nfs_path&gt;</code></span></dt><dd>
									Specifies the <code class="literal">nfs_server</code>, which is an IP or hostname of the server where the share was created and <code class="literal">nfs_path</code>, which is the path on the server where the OVA files are stored.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Provider</code> manifest for the source provider:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ova
  url:  &lt;nfs_server:/nfs_path&gt;
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;nfs_server:/nfs_path&gt;</code></span></dt><dd>
									Specifies the <code class="literal">nfs_server</code>, which is an IP or hostname of the server where the share was created and <code class="literal">nfs_path</code>, which is the path on the server where the OVA files are stored.
								</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
									Specifies the name of the provider <code class="literal">Secret</code> CR.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        id: &lt;source_network_id&gt;
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        id: &lt;source_network_id&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
									Specifies the network type. Allowed values are <code class="literal">pod</code> and <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">&lt;source_network_id&gt;</code></span></dt><dd>
									Specifies the OVA network Universal Unique ID (UUID).
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
									Specifies a network attachment definition (NAD) for each additional OpenShift Virtualization network.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
									Specifies the namespace of the OpenShift Virtualization NAD. Required only when <code class="literal">type</code> is <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">namespace</code></span></dt><dd>
									Specifies the namespace. If you are using a user-defined network (UDN), its namespace is defined in OpenShift Virtualization.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        name:  Dummy storage for source provider &lt;provider_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
									Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</dd><dt><span class="term"><code class="literal">name</code></span></dt><dd>
									Specifies the source provider. For OVA, the <code class="literal">StorageMap</code> can map only a single storage, which all the disks from the OVA are associated with, to a storage class at the destination. For this reason, the storage is referred to in the UI as <span class="strong strong"><strong>Dummy storage for source provider &lt;provider_name&gt;</strong></span>. In the <code class="literal">StorageMap</code> CR, write the phrase as it appears above, without the quotation marks and replacing &lt;provider_name&gt; with the actual name of the provider.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;service account&gt;</code></span></dt><dd>
									Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
								</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
									Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
						Enter the following command to create the network attachment definition (NAD) of the transfer network used for MTV migrations.
					</p><p class="simpara">
						You use this definition to configure an IP address for the interface, either from the Dynamic Host Configuration Protocol (DHCP) or statically.
					</p><p class="simpara">
						Configuring the IP address enables the interface to reach the configured gateway.
					</p><pre class="programlisting language-yaml">$ oc edit NetworkAttachmentDefinitions &lt;name_of_the_NAD_to_edit&gt;
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: &lt;name_of_transfer_network&gt;
  namespace: &lt;namespace&gt;
  annotations:
    forklift.konveyor.io/route: &lt;IP_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Plan</code> manifest for the migration:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - id: &lt;source_vm1&gt;
    - name: &lt;source_vm2&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Plan</code> CR.
								</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
									Specifies only one network map and one storage map per plan.
								</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
									Specifies a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">NetworkMap</code> CR.
								</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
									Specifies a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">StorageMap</code> CR.
								</dd><dt><span class="term"><code class="literal">vms</code></span></dt><dd>
									Specifies the source VMs and their hooks.Accepts either the <code class="literal">id</code> or the <code class="literal">name</code> parameter to specify the source VMs. If you are using a UDN, verify that the IP address of the provider is outside the subnet of the UDN. If the IP address is within the subnet of the UDN, the migration fails.
								</dd><dt><span class="term"><code class="literal">&lt;source_vm1&gt;</code></span></dt><dd>
									Specifies the OVA VM UUID.
								</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
									Specifies up to two hooks for a migration. Each hook must run during a separate migration step. This is an optional label.
								</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Hook</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd>
									Specifies the type of hook. Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
						</p></div></div></li></ol></div><section class="section" id="canceling-migration-cli_ova"><div class="titlepage"><div><div><h3 class="title">5.3.1. Canceling a migration from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to cancel either an entire migration or the migration of specific virtual machines (VMs) while a migration is in progress.
				</p><section class="section" id="canceling-migration-cli-entire_ova"><div class="titlepage"><div><div><h4 class="title">5.3.1.1. Canceling an entire migration from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel an entire migration while a migration is in progress.
					</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Delete the <code class="literal">Migration</code> CR:
							</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt;</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;migration&gt;</code></span></dt><dd>
											Specifies the name of the <code class="literal">Migration</code> CR.
										</dd></dl></div></li></ul></div></section><section class="section" id="canceling-migration-cli-specific_ova"><div class="titlepage"><div><div><h4 class="title">5.3.1.2. Canceling the migration of specific VMs from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel the migration of specific virtual machines (VMs) while a migration is in progress.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Add the specific VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest, following this example:
							</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102
  - id: vm-203
    name: rhel8-vm
EOF</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code> or <code class="literal">name</code></span></dt><dd><p class="simpara">
											Specifies a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
										</p><p class="simpara">
											The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a Red Hat Virtualization VM.
										</p></dd></dl></div></li><li class="listitem"><p class="simpara">
								Retrieve the <code class="literal">Migration</code> custom resource (CR) to monitor the progress of the remaining VMs, following this example:
							</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section></section></section><section class="chapter" id="assembly_migrating-from-virt_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Migrating from OpenShift Virtualization</h1></div></div></div><p class="_abstract _abstract">
			Run your OpenShift Virtualization migration plan from the MTV UI or from the command-line.
		</p><section class="section" id="prerequisites_5"><div class="titlepage"><div><div><h2 class="title">6.1. Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have planned your migration from OpenShift Virtualization.
					</li></ul></div></section><section class="section" id="running-migration-plan_cnv"><div class="titlepage"><div><div><h2 class="title">6.2. Running a migration plan in the MTV UI</h2></div></div></div><p class="_abstract _abstract">
				You can run a migration plan and view its progress in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Valid migration plan.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Plans</strong></span> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, the date that the migration started, and the description of each plan.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Start</strong></span> beside a migration plan to start the migration.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Start</strong></span> in the confirmation window that opens.
					</p><p class="simpara">
						The plan’s <span class="strong strong"><strong>Status</strong></span> changes to <span class="strong strong"><strong>Running</strong></span>, and the migration’s progress is displayed.
					</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
							Do not take a snapshot of a VM after you start a migration. Taking a snaphot after a migration starts might cause the migration to fail.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Optional: Click the links in the migration’s <span class="strong strong"><strong>Status</strong></span> to see its overall status and the status of each VM:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The link on the left indicates whether the migration failed, succeeded, or is ongoing. It also reports the number of VMs whose migration succeeded, failed, or was canceled.
							</li><li class="listitem"><p class="simpara">
								The link on the right opens the <span class="strong strong"><strong>Virtual machines</strong></span> tab of the <span class="strong strong"><strong>Plan details</strong></span> page. For each VM, the tab displays the following data:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The name of the VM
									</li><li class="listitem">
										The start and end times of the migration
									</li><li class="listitem">
										The amount of data copied
									</li><li class="listitem">
										A progress pipeline for the VM’s migration
									</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: To view your migration’s logs, either as it is running or after it is completed, perform the following actions:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click the <span class="strong strong"><strong>Virtual machines</strong></span> tab.
							</li><li class="listitem"><p class="simpara">
								Click the arrow (<span class="strong strong"><strong>&gt;</strong></span>) to the left of the virtual machine whose migration progress you want to check.
							</p><p class="simpara">
								The VM’s details are displayed.
							</p></li><li class="listitem"><p class="simpara">
								In the <span class="strong strong"><strong>Pods</strong></span> section, in the <span class="strong strong"><strong>Pod links</strong></span> column, click the <span class="strong strong"><strong>Logs</strong></span> link.
							</p><p class="simpara">
								The <span class="strong strong"><strong>Logs</strong></span> tab opens.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Logs are not always available. The following are common reasons for logs not being available:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											The migration is from OpenShift Virtualization to OpenShift Virtualization. In this case, <code class="literal">virt-v2v</code> is not involved, so no pod is required.
										</li><li class="listitem">
											No pod was created.
										</li><li class="listitem">
											The pod was deleted.
										</li><li class="listitem">
											The migration failed before running the pod.
										</li></ul></div></div></div></li><li class="listitem">
								To see the raw logs, click the <span class="strong strong"><strong>Raw</strong></span> link.
							</li><li class="listitem">
								To download the logs, click the <span class="strong strong"><strong>Download</strong></span> link.
							</li></ol></div></li></ol></div><section class="section" id="migration-plan-options-ui_cnv"><div class="titlepage"><div><div><h3 class="title">6.2.1. Migration plan options</h3></div></div></div><p class="_abstract _abstract">
					On the <span class="strong strong"><strong>Migration plans</strong></span> page of the Red Hat OpenShift web console, you can click the Options menu 
					<span class="inlinemediaobject"><img src="images/modules/images/kebab.png" height="20" alt="kebab"/></span>
					 beside a migration plan to access the following options:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Edit Plan</strong></span>: Edit the details of a migration plan. If the plan is running or has completed successfully, you cannot edit the following options:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									All properties on the <span class="strong strong"><strong>Settings</strong></span> section of the <span class="strong strong"><strong>Plan details</strong></span> page. For example, warm or cold migration, target namespace, and preserved static IPs.
								</li><li class="listitem">
									The plan’s mapping on the <span class="strong strong"><strong>Mappings</strong></span> tab.
								</li><li class="listitem">
									The hooks listed on the <span class="strong strong"><strong>Hooks</strong></span> tab.
								</li></ul></div></li><li class="listitem">
							<span class="strong strong"><strong>Start migration</strong></span>: Active only if relevant.
						</li><li class="listitem">
							<span class="strong strong"><strong>Restart migration</strong></span>: Restart a migration that was interrupted. Before choosing this option, make sure there are no error messages. If there are, you need to edit the plan.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Duplicate</strong></span>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migrate VMs to a different namespace.
								</li><li class="listitem">
									Edit an archived migration plan.
								</li><li class="listitem">
									Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Archive</strong></span>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed, duplicated, or deleted.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Archive</strong></span> is irreversible. However, you can duplicate an archived plan.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Delete</strong></span>: Permanently remove a migration plan. You cannot delete a running migration plan.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<span class="strong strong"><strong>Delete</strong></span> is irreversible.
							</p><p>
								Deleting a migration plan does not remove temporary resources. To remove temporary resources, archive the plan first before deleting it.
							</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The results of archiving and then deleting a migration plan vary by whether you created the plan and its storage and network mappings using the CLI or the UI.
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If you created them using the UI, then the migration plan and its mappings no longer appear in the UI.
									</li><li class="listitem">
										If you created them using the CLI, then the mappings might still appear in the UI. This is because mappings in the CLI can be used by more than one migration plan, but mappings created in the UI can only be used in one migration plan.
									</li></ul></div></div></div></li></ul></div></section><section class="section" id="canceling-migration-ui_cnv"><div class="titlepage"><div><div><h3 class="title">6.2.2. Canceling a migration</h3></div></div></div><p class="_abstract _abstract">
					You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click the name of a running migration plan to view the migration details.
						</li><li class="listitem">
							Select one or more VMs and click <span class="strong strong"><strong>Cancel</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong strong"><strong>Yes, cancel</strong></span> to confirm the cancellation.
						</p><p class="simpara">
							In the <span class="strong strong"><strong>Migration details by VM</strong></span> list, the status of the canceled VMs is <span class="strong strong"><strong>Canceled</strong></span>. The unmigrated and the migrated virtual machines are not affected.
						</p></li><li class="listitem">
							Restart a canceled migration by clicking <span class="strong strong"><strong>Restart</strong></span> beside the migration plan on the <span class="strong strong"><strong>Migration plans</strong></span> page.
						</li></ol></div></section></section><section class="section" id="proc_migrating-virtual-machines-cli_cnv"><div class="titlepage"><div><div><h2 class="title">6.3. Running a Red Hat OpenShift Virtualization migration from the command-line</h2></div></div></div><p class="_abstract _abstract">
				You can use a Red Hat OpenShift Virtualization provider as either a source provider or as a destination provider. You can migrate from an OpenShift Virtualization source provider by using the command-line interface (CLI).
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The Red Hat OpenShift cluster version of the source provider must be 4.16 or later.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Secret</code> manifest for the source provider credentials:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openshift
    createdForResourceType: providers
type: Opaque
stringData:
  token: &lt;token&gt;
  password: &lt;password&gt;
  insecureSkipVerify: &lt;"true"/"false"&gt;
  cacert: |
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
									Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
								</dd><dt><span class="term"><code class="literal">&lt;token&gt;</code></span></dt><dd>
									Specifies a token for a service account with <code class="literal">cluster-admin</code> privileges. If both <code class="literal">token</code> and <code class="literal">url</code> are left blank, the local OpenShift cluster is used.
								</dd><dt><span class="term"><code class="literal">&lt;password&gt;</code></span></dt><dd>
									Specifies the user password.
								</dd><dt><span class="term"><code class="literal">&lt;"true"/"false"&gt;</code></span></dt><dd>
									Specifies <code class="literal">"true"</code> to skip certificate verification, and specifies <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
								</dd><dt><span class="term"><code class="literal">cacert</code></span></dt><dd>
									Specifies the CA cert object. When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
								</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the URL of the endpoint of the API server.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">Provider</code> manifest for the source provider:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openshift
  url: &lt;api_end_point&gt;
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
									Specifies the URL of the endpoint of the API server.
								</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
									Specifies the name of the provider <code class="literal">Secret</code> CR.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        name: &lt;network_name&gt;
        type: pod
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
									Specifies the network type. Allowed values are <code class="literal">pod</code>, <code class="literal">ignored</code>, and <code class="literal">multus</code>.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
									Specifies the network name. When the <code class="literal">type</code> is <code class="literal">multus</code>, use the OpenShift Virtualization (NAD) name.
								</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
									Specifies the namespace of the OpenShift Virtualization NAD. Required only when the <code class="literal">type</code> is <code class="literal">multus</code>.
								</dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="4" type="1"><li class="listitem"><p class="simpara">
						Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        name: &lt;storage_class&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
									Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;service account&gt;</code></span></dt><dd>
									Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
								</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
									Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" start="6" type="1"><li class="listitem"><p class="simpara">
						Enter the following command to create the network attachment definition (NAD) of the transfer network used for MTV migrations.
					</p><p class="simpara">
						You use this definition to configure an IP address for the interface, either from the Dynamic Host Configuration Protocol (DHCP) or statically.
					</p><p class="simpara">
						Configuring the IP address enables the interface to reach the configured gateway.
					</p><pre class="programlisting language-yaml">$ oc edit NetworkAttachmentDefinitions &lt;name_of_the_NAD_to_edit&gt;
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: &lt;name_of_transfer_network&gt;
  namespace: &lt;namespace&gt;
  annotations:
    forklift.konveyor.io/route: &lt;IP_address&gt;</pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Plan</code> manifest for the migration:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - name: &lt;source_vm&gt;
      namespace: &lt;namespace&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;
EOF</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Plan</code> CR.
								</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
									Specifies only one network map and one storage map per plan.
								</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
									Specifies a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">NetworkMap</code> CR.
								</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
									Specifies a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
								</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">StorageMap</code> CR.
								</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
									Specifies up to two hooks for a VM. Each hook must run during a separate migration step. This is an optional label.
								</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
									Specifies the name of the <code class="literal">Hook</code> CR.
								</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd>
									Specifies the type of hook. Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
					</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code class="literal">2024-04-04T01:23:45.678+09:00</code>.
						</p></div></div></li></ol></div><section class="section" id="migrating-live-cnv-cnv-vms-cli_cnv"><div class="titlepage"><div><div><h3 class="title">6.3.1. Running a Red Hat OpenShift Virtualization live migration from the command-line</h3></div></div></div><p class="_abstract _abstract">
					You can perform a live migration by using the command-line interface (CLI). The procedure for live migration is identical to the procedure for other migrations between OpenShift Virtualization clusters except for the addition of the <code class="literal">type</code> label in the <code class="literal">Plan</code> CR. For a live migration, the <code class="literal">type</code> label must be set to <code class="literal">live</code>.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Live migration is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information about the support scope of Red Hat Technology Preview features, see <a class="link" href="https://access.redhat.com/support/offerings/techpreview/">https://access.redhat.com/support/offerings/techpreview/</a>.
					</p></div></div><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
						As described in the prerequisites for live migration. For more information, see <a class="link" href="https://docs.redhat.com/en/documentation/migration_toolkit_for_virtualization/2.10/html/planning_your_migration_to_red_hat_openshift_virtualization/assembly_provider-specific-requirements-for-migration_mtv#cnv-cnv-live-prerequisites_mtv">OpenShift Virtualization live migration prerequisites</a>.
					</p></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a <code class="literal">Secret</code> manifest for the source provider credentials:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences:
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openshift
    createdForResourceType: providers
type: Opaque
stringData:
  token: &lt;token&gt;
  password: &lt;password&gt;
  insecureSkipVerify: &lt;"true"/"false"&gt;
  cacert: |
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ownerReferences</code></span></dt><dd>
										Is an optional section in which you can specify a provider’s <code class="literal">name</code> and <code class="literal">uid</code>.
									</dd><dt><span class="term"><code class="literal">&lt;token&gt;</code></span></dt><dd>
										Specifies a token for a service account with <code class="literal">cluster-admin</code> privileges. If both <code class="literal">token</code> and <code class="literal">url</code> are left blank, the local OpenShift cluster is used.
									</dd><dt><span class="term"><code class="literal">&lt;password&gt;</code></span></dt><dd>
										Specifies the user password.
									</dd><dt><span class="term"><code class="literal">&lt;"true"/"false"&gt;</code></span></dt><dd>
										Specifies <code class="literal">"true"</code> to skip certificate verification, and specifies <code class="literal">"false"</code> to verify the certificate. Defaults to <code class="literal">"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.
									</dd><dt><span class="term"><code class="literal">cacert</code></span></dt><dd>
										Specifies the CA cert object. When this field is not set and <span class="emphasis"><em>skip certificate verification</em></span> is disabled, MTV attempts to use the system CA.
									</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
										Specifies the URL of the endpoint of the API server.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Provider</code> manifest for the source provider:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openshift
  url: &lt;api_end_point&gt;
  secret:
    name: &lt;secret&gt;
    namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
										Specifies the URL of the endpoint of the API server.
									</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
										Specifies the name of the provider <code class="literal">Secret</code> CR.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">NetworkMap</code> manifest to map the source and destination networks:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod
      source:
        name: &lt;network_name&gt;
        type: pod
    - destination:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
      source:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">type</code></span></dt><dd>
										Specifies the network type. Allowed values are <code class="literal">pod</code>, <code class="literal">ignored</code>, and <code class="literal">multus</code>.
									</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition&gt;</code></span></dt><dd>
										Specifies the network name. When the <code class="literal">type</code> is <code class="literal">multus</code>, use the name of the OpenShift Virtualization network attachment (NAD) definition.
									</dd><dt><span class="term"><code class="literal">&lt;network_attachment_definition_namespace&gt;</code></span></dt><dd>
										Specifies the namespace of the OpenShift Virtualization NAD. Required only when the <code class="literal">type</code> is <code class="literal">multus</code>.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">StorageMap</code> manifest to map source and destination storage:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        name: &lt;storage_class&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;access_mode&gt;</code></span></dt><dd>
										Specifies the access mode. Allowed values are <code class="literal">ReadWriteOnce</code> and <code class="literal">ReadWriteMany</code>.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Optional: Create a <code class="literal">Hook</code> manifest to run custom code on a VM during the phase specified in the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount: &lt;service_account&gt;
  playbook: |
    LS0tCi0gbm...
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">serviceAccount</code></span></dt><dd>
										Specifies the Red Hat OpenShift service account. This is an optional label. Use the <code class="literal">serviceAccount</code> parameter to modify any cluster resources.
									</dd><dt><span class="term"><code class="literal">playbook</code></span></dt><dd><p class="simpara">
										Specifies the Base64-encoded Ansible Playbook. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
									</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
										</p></div></div></dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Plan</code> manifest for the migration:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map:
    network:
      name: &lt;network_map&gt;
      namespace: &lt;namespace&gt;
    storage:
      name: &lt;storage_map&gt;
      namespace: &lt;namespace&gt;
  type: live
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - name: &lt;source_vm&gt;
      namespace: &lt;namespace&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt;
          step: &lt;step&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;plan&gt;</code></span></dt><dd>
										Specifies the name of the <code class="literal">Plan</code> CR.
									</dd><dt><span class="term"><code class="literal">map</code></span></dt><dd>
										Specifies only one network map and one storage map per plan.
									</dd><dt><span class="term"><code class="literal">network</code></span></dt><dd>
										Specifies a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.
									</dd><dt><span class="term"><code class="literal">&lt;network_map&gt;</code></span></dt><dd>
										Specifies the name of the <code class="literal">NetworkMap</code> CR.
									</dd><dt><span class="term"><code class="literal">storage</code></span></dt><dd>
										Specifies a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.
									</dd><dt><span class="term"><code class="literal">&lt;storage_map&gt;</code></span></dt><dd>
										Specifies the name of the <code class="literal">StorageMap</code> CR.
									</dd><dt><span class="term"><code class="literal">type</code></span></dt><dd>
										Specifies the type of migration. Must be set to <code class="literal">live</code>.
									</dd><dt><span class="term"><code class="literal">hooks</code></span></dt><dd>
										Specifies up to two hooks for a VM. Each hook must run during a separate migration step. This is an optional label.
									</dd><dt><span class="term"><code class="literal">&lt;hook&gt;</code></span></dt><dd>
										Specifies the name of the <code class="literal">Hook</code> CR.
									</dd><dt><span class="term"><code class="literal">&lt;step&gt;</code></span></dt><dd>
										Specifies the hook step. Allowed values are <code class="literal">PreHook</code>, before the migration plan starts, or <code class="literal">PostHook</code>, after the migration is complete.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">Migration</code> manifest to run the <code class="literal">Plan</code> CR:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
EOF</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The <code class="literal">cutover</code> field is irrelevant for live migrations, so it is not included in the <code class="literal">Migration</code> CR of this procedure.
							</p></div></div></li></ol></div></section><section class="section" id="canceling-migration-cli_cnv"><div class="titlepage"><div><div><h3 class="title">6.3.2. Canceling a migration from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to cancel either an entire migration or the migration of specific virtual machines (VMs) while a migration is in progress.
				</p><section class="section" id="canceling-migration-cli-entire_cnv"><div class="titlepage"><div><div><h4 class="title">6.3.2.1. Canceling an entire migration from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel an entire migration while a migration is in progress.
					</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Delete the <code class="literal">Migration</code> CR:
							</p><pre class="programlisting language-terminal">$ oc delete migration &lt;migration&gt; -n &lt;namespace&gt;</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;migration&gt;</code></span></dt><dd>
											Specifies the name of the <code class="literal">Migration</code> CR.
										</dd></dl></div></li></ul></div></section><section class="section" id="canceling-migration-cli-specific_cnv"><div class="titlepage"><div><div><h4 class="title">6.3.2.2. Canceling the migration of specific VMs from the command-line interface</h4></div></div></div><p class="_abstract _abstract">
						You can use the command-line interface (CLI) to cancel the migration of specific virtual machines (VMs) while a migration is in progress.
					</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Add the specific VMs to the <code class="literal">spec.cancel</code> block of the <code class="literal">Migration</code> manifest, following this example:
							</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102
  - id: vm-203
    name: rhel8-vm
EOF</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code> or <code class="literal">name</code></span></dt><dd><p class="simpara">
											Specifies a VM by using the <code class="literal">id</code> key or the <code class="literal">name</code> key.
										</p><p class="simpara">
											The value of the <code class="literal">id</code> key is the <span class="emphasis"><em>managed object reference</em></span>, for a VMware VM, or the <span class="emphasis"><em>VM UUID</em></span>, for a Red Hat Virtualization VM.
										</p></dd></dl></div></li><li class="listitem"><p class="simpara">
								Retrieve the <code class="literal">Migration</code> custom resource (CR) to monitor the progress of the remaining VMs, following this example:
							</p><pre class="programlisting language-terminal">$ oc get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</pre></li></ol></div></section></section></section></section><section class="chapter" id="assembly_advanced-migration-options_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Advanced migration options</h1></div></div></div><p class="_abstract _abstract">
			Perform advanced migration operations, such as changing precopy snapshot intervals for warm migration, creating custom rules for validation, or adding hooks to your migration plan.
		</p><section class="section" id="changing-precopy-intervals_mtv"><div class="titlepage"><div><div><h2 class="title">7.1. Changing precopy intervals for warm migration</h2></div></div></div><p class="_abstract _abstract">
				You can change the snapshot interval by patching the <code class="literal">ForkliftController</code> custom resource (CR).
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Patch the <code class="literal">ForkliftController</code> CR:
					</p><pre class="programlisting language-terminal">$ oc patch forkliftcontroller/&lt;forklift-controller&gt; -n openshift-mtv -p '{"spec": {"controller_precopy_interval": &lt;interval_in_minutes&gt;}}' --type=merge</pre><p class="simpara">
						where:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;interval_in_minutes&gt;`</span></dt><dd><p class="simpara">
									Specifies the precopy interval in minutes. The default value is <code class="literal">60</code>.
								</p><p class="simpara">
									You do not need to restart the <code class="literal">forklift-controller</code> pod.
								</p></dd></dl></div></li></ul></div></section><section class="section" id="con_creating-custom-rules-validation_mtv"><div class="titlepage"><div><div><h2 class="title">7.2. Creating custom rules for the Validation service</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">Validation</code> service uses Open Policy Agent (OPA) policy rules to check the suitability of each virtual machine (VM) for migration. The <code class="literal">Validation</code> service generates a list of <span class="emphasis"><em>concerns</em></span> for each VM, which are stored in the <code class="literal">Provider Inventory</code> service as VM attributes. The web console displays the concerns for each VM in the provider inventory.
			</p><p>
				You can create custom rules to extend the default ruleset of the <code class="literal">Validation</code> service. For example, you can create a rule that checks whether a VM has multiple disks.
			</p><section class="section" id="about-rego-files_mtv"><div class="titlepage"><div><div><h3 class="title">7.2.1. About Rego files</h3></div></div></div><p class="_abstract _abstract">
					Validation rules are written in <a class="link" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a>, the Open Policy Agent (OPA) native query language. The rules are stored as <code class="literal">.rego</code> files in the <code class="literal">/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;</code> directory of the <code class="literal">Validation</code> pod.
				</p><p>
					Each validation rule is defined in a separate <code class="literal">.rego</code> file and tests for a specific condition. If the condition evaluates as <code class="literal">true</code>, the rule adds a <code class="literal">{“category”, “label”, “assessment”}</code> hash to the <code class="literal">concerns</code>. The <code class="literal">concerns</code> content is added to the <code class="literal">concerns</code> key in the inventory record of the VM. The web console displays the content of the <code class="literal">concerns</code> key for each VM in the provider inventory.
				</p><p>
					The following <code class="literal">.rego</code> file example checks for distributed resource scheduling enabled (<code class="literal">has_drs_enabled</code>) in the cluster of a VMware VM:
				</p><pre class="programlisting language-terminal">package io.konveyor.forklift.vmware

has_drs_enabled {
    input.host.cluster.drsEnabled
}

concerns[flag] {
    has_drs_enabled
    flag := {
        "category": "Information",
        "label": "VM running in a DRS-enabled cluster",
        "assessment": "Distributed resource scheduling is not currently supported by OpenShift Virtualization. The VM can be migrated but it will not have this feature in the target environment."
    }
}</pre><p>
					where:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">package io.konveyor.forklift.vmware</code></span></dt><dd>
								Is the package namespace in this example, The package namespaces are <code class="literal">io.konveyor.forklift.vmware</code> for VMware and <code class="literal">io.konveyor.forklift.ovirt</code> for Red Hat Virtualization.
							</dd><dt><span class="term"><code class="literal">input.host.cluster.drsEnabled</code></span></dt><dd>
								Is the query parameter in this example. Query parameters are based on the <code class="literal">input</code> key of the <code class="literal">Validation</code> service JSON.
							</dd></dl></div></section><section class="section" id="accessing-default-validation-rules_mtv"><div class="titlepage"><div><div><h3 class="title">7.2.2. Checking the default validation rules</h3></div></div></div><p class="_abstract _abstract">
					Before you create a custom rule, you must check the default rules of the <code class="literal">Validation</code> service to ensure that you do not create a rule that redefines an existing default value.
				</p><p>
					Example: If a default rule contains the line <code class="literal">default valid_input = false</code> and you create a custom rule that contains the line <code class="literal">default valid_input = true</code>, the <code class="literal">Validation</code> service will not start.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Connect to the terminal of the <code class="literal">Validation</code> pod:
						</p><pre class="programlisting language-terminal">$ oc rsh &lt;validation_pod&gt;</pre></li><li class="listitem"><p class="simpara">
							Go to the OPA policies directory for your provider:
						</p><pre class="programlisting language-terminal">$ cd /usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">provider</span></dt><dd>
										Specifies the provider. Valid options: <code class="literal">vmware</code> or <code class="literal">ovirt</code>.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Search for the default policies:
						</p><pre class="programlisting language-terminal">$ grep -R "default" *</pre></li></ol></div></section><section class="section" id="creating-validation-rule_mtv"><div class="titlepage"><div><div><h3 class="title">7.2.3. Creating a validation rule</h3></div></div></div><p class="_abstract _abstract">
					You create a validation rule by applying a config map custom resource (CR) containing the rule to the <code class="literal">Validation</code> service.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								If you create a rule with the same <span class="emphasis"><em>name</em></span> as an existing rule, the <code class="literal">Validation</code> service performs an <code class="literal">OR</code> operation with the rules.
							</li><li class="listitem">
								If you create a rule that contradicts a default rule, the <code class="literal">Validation</code> service will not start.
							</li></ul></div></div></div><p>
					Validation rules are based on virtual machine (VM) attributes collected by the <code class="literal">Provider Inventory</code> service.
				</p><p>
					For example, the VMware API uses the following path to check whether a VMware VM has NUMA node affinity configured: <code class="literal">MOR:VirtualMachine.config.extraConfig["numa.nodeAffinity"]</code>.
				</p><p>
					The <code class="literal">Provider Inventory</code> service simplifies this configuration and returns a testable attribute with a list value:
				</p><pre class="programlisting language-terminal">"numaNodeAffinity": [
    "0",
    "1"
],</pre><p>
					You create a <a class="link" href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a> query, based on this attribute, and add it to the <code class="literal">forklift-validation-config</code> config map:
				</p><pre class="programlisting language-terminal">count(input.numaNodeAffinity) != 0</pre><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a config map CR according to the following example:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: &lt;forklift-validation-config&gt;
  namespace: openshift-mtv
data:
  vmware_multiple_disks.rego: |-
    package &lt;provider_package&gt;

    has_multiple_disks {
      count(input.disks) &gt; 1
    }

    concerns[flag] {
      has_multiple_disks
        flag := {
          "category": "&lt;Information&gt;",
          "label": "Multiple disks detected",
          "assessment": "Multiple disks detected on this VM."
        }
    }
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;provider_package&gt;</code></span></dt><dd>
										Specifies the provider package name. Allowed values are <code class="literal">io.konveyor.forklift.vmware</code> for VMware and <code class="literal">io.konveyor.forklift.ovirt</code> for Red Hat Virtualization.
									</dd><dt><span class="term"><code class="literal">has_multiple_disks</code></span></dt><dd>
										Specifies the <code class="literal">concerns</code> name and Rego query.
									</dd><dt><span class="term"><code class="literal">has_multiple_disks</code></span></dt><dd>
										Specifies the <code class="literal">concerns</code> name and <code class="literal">flag</code> parameter values.
									</dd><dt><span class="term"><code class="literal">&lt;Information&gt;</code></span></dt><dd>
										Allowed values are <code class="literal">Critical</code>, <code class="literal">Warning</code>, and <code class="literal">Information</code>.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Stop the <code class="literal">Validation</code> pod by scaling the <code class="literal">forklift-controller</code> deployment to <code class="literal">0</code>:
						</p><pre class="programlisting language-terminal">$ oc scale -n openshift-mtv --replicas=0 deployment/forklift-controller</pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">Validation</code> pod by scaling the <code class="literal">forklift-controller</code> deployment to <code class="literal">1</code>:
						</p><pre class="programlisting language-terminal">$ oc scale -n openshift-mtv --replicas=1 deployment/forklift-controller</pre></li><li class="listitem"><p class="simpara">
							Check the <code class="literal">Validation</code> pod log to verify that the pod started:
						</p><pre class="programlisting language-terminal">$ oc logs -f &lt;validation_pod&gt;</pre><p class="simpara">
							If the custom rule conflicts with a default rule, the <code class="literal">Validation</code> pod will not start.
						</p></li><li class="listitem"><p class="simpara">
							Remove the source provider:
						</p><pre class="programlisting language-terminal">$ oc delete provider &lt;provider&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Add the source provider to apply the new rule:
						</p><pre class="programlisting language-yaml">$ cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;provider&gt;
  namespace: openshift-mtv
spec:
  type: &lt;provider_type&gt;
  url: &lt;api_end_point&gt;
  secret:
    name: &lt;secret&gt;
    namespace: openshift-mtv
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;provider_type&gt;</code></span></dt><dd>
										Allowed values are <code class="literal">ovirt</code>, <code class="literal">vsphere</code>, and <code class="literal">openstack</code>.
									</dd><dt><span class="term"><code class="literal">&lt;api_end_point&gt;</code></span></dt><dd>
										Specifies the API end point URL, for example, <code class="literal">https://&lt;vCenter_host&gt;/sdk</code> for vSphere, <code class="literal">https://&lt;engine_host&gt;/ovirt-engine/api</code> for Red Hat Virtualization, or <code class="literal">https://&lt;identity_service&gt;/v3</code> for OpenStack.
									</dd><dt><span class="term"><code class="literal">&lt;secret&gt;</code></span></dt><dd>
										Specifies the name of the provider <code class="literal">Secret</code> CR.
									</dd></dl></div></li><li class="listitem">
							Update the rules version after creating a custom rule so that the <code class="literal">Inventory</code> service detects the changes and validates the VMs.
						</li></ol></div></section><section class="section" id="updating-inventory-rules-version_mtv"><div class="titlepage"><div><div><h3 class="title">7.2.4. Updating the inventory rules version</h3></div></div></div><p class="_abstract _abstract">
					You must update the inventory rules version each time you update the rules so that the <code class="literal">Provider Inventory</code> service detects the changes and triggers the <code class="literal">Validation</code> service.
				</p><p>
					The rules version is recorded in a <code class="literal">rules_version.rego</code> file for each provider.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Retrieve the current rules version:
						</p><pre class="programlisting language-terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version</pre><p class="simpara">
							The output looks like the following example:
						</p><pre class="programlisting language-json">{
   "result": {
       "rules_version": 5
   }
}</pre></li><li class="listitem"><p class="simpara">
							Connect to the terminal of the <code class="literal">Validation</code> pod:
						</p><pre class="programlisting language-terminal">$ oc rsh &lt;validation_pod&gt;</pre></li><li class="listitem">
							Update the rules version in the <code class="literal">/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;/rules_version.rego</code> file.
						</li><li class="listitem">
							Log out of the <code class="literal">Validation</code> pod terminal.
						</li><li class="listitem"><p class="simpara">
							Verify the updated rules version:
						</p><pre class="programlisting language-terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version</pre><p class="simpara">
							The output looks like the following example:
						</p><pre class="programlisting language-json">{
   "result": {
       "rules_version": 6
   }
}</pre></li></ol></div></section><section class="section" id="retrieving-validation-service-json_mtv"><div class="titlepage"><div><div><h3 class="title">7.2.5. Retrieving the Inventory service JSON</h3></div></div></div><p class="_abstract _abstract">
					You retrieve the <code class="literal">Inventory</code> service JSON by sending an <code class="literal">Inventory</code> service query to a virtual machine (VM). The output contains an <code class="literal">"input"</code> key, which contains the inventory attributes that are queried by the <code class="literal">Validation</code> service rules.
				</p><p>
					You can create a validation rule based on any attribute in the <code class="literal">"input"</code> key, for example, <code class="literal">input.snapshot.kind</code>.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Retrieve the routes for the project:
						</p><pre class="programlisting language-terminal">oc get route -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Retrieve the <code class="literal">Inventory</code> service route:
						</p><pre class="programlisting language-terminal">$ oc get route &lt;inventory_service&gt; -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
							Retrieve the access token:
						</p><pre class="programlisting language-terminal">$ TOKEN=$(oc whoami -t)</pre></li><li class="listitem"><p class="simpara">
							Trigger an HTTP GET request (for example, using Curl):
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN" https://&lt;inventory_service_route&gt;/providers -k</pre></li><li class="listitem"><p class="simpara">
							Retrieve the <code class="literal">UUID</code> of a provider:
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt; -k</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;provider&gt;</span></dt><dd>
										Specifies the type of provider. Allowed values are <code class="literal">vsphere</code>, <code class="literal">ovirt</code>, and <code class="literal">openstack</code>.
									</dd></dl></div></li><li class="listitem"><p class="simpara">
							Retrieve the VMs of a provider:
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/vms -k</pre></li><li class="listitem"><p class="simpara">
							Retrieve the details of a VM:
						</p><pre class="programlisting language-terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/workloads/&lt;vm&gt; -k</pre><div class="formalpara"><p class="title"><strong>Example output</strong></p><p>
								
<pre class="programlisting language-yaml">{
    "input": {
        "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/workloads/vm-431",
        "id": "vm-431",
        "parent": {
            "kind": "Folder",
            "id": "group-v22"
        },
        "revision": 1,
        "name": "iscsi-target",
        "revisionValidated": 1,
        "isTemplate": false,
        "networks": [
            {
                "kind": "Network",
                "id": "network-31"
            },
            {
                "kind": "Network",
                "id": "network-33"
            }
        ],
        "disks": [
            {
                "key": 2000,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 17179869184,
                "shared": false,
                "rdm": false
            },
            {
                "key": 2001,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target_1-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 10737418240,
                "shared": false,
                "rdm": false
            }
        ],
        "concerns": [],
        "policyVersion": 5,
        "uuid": "42256329-8c3a-2a82-54fd-01d845a8bf49",
        "firmware": "bios",
        "powerState": "poweredOn",
        "connectionState": "connected",
        "snapshot": {
            "kind": "VirtualMachineSnapshot",
            "id": "snapshot-3034"
        },
        "changeTrackingEnabled": false,
        "cpuAffinity": [
            0,
            2
        ],
        "cpuHotAddEnabled": true,
        "cpuHotRemoveEnabled": false,
        "memoryHotAddEnabled": false,
        "faultToleranceEnabled": false,
        "cpuCount": 2,
        "coresPerSocket": 1,
        "memoryMB": 2048,
        "guestName": "Red Hat Enterprise Linux 7 (64-bit)",
        "balloonedMemory": 0,
        "ipAddress": "10.19.2.96",
        "storageUsed": 30436770129,
        "numaNodeAffinity": [
            "0",
            "1"
        ],
        "devices": [
            {
                "kind": "RealUSBController"
            }
        ],
        "host": {
            "id": "host-29",
            "parent": {
                "kind": "Cluster",
                "id": "domain-c26"
            },
            "revision": 1,
            "name": "IP address or host name of the vCenter host or RHV Engine host",
            "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/hosts/host-29",
            "status": "green",
            "inMaintenance": false,
            "managementServerIp": "10.19.2.96",
            "thumbprint": &lt;thumbprint&gt;,
            "timezone": "UTC",
            "cpuSockets": 2,
            "cpuCores": 16,
            "productName": "VMware ESXi",
            "productVersion": "6.5.0",
            "networking": {
                "pNICs": [
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic0",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic1",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic2",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic3",
                        "linkSpeed": 10000
                    }
                ],
                "vNICs": [
                    {
                        "key": "key-vim.host.VirtualNic-vmk2",
                        "portGroup": "VM_Migration",
                        "dPortGroup": "",
                        "ipAddress": "192.168.79.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 9000
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk0",
                        "portGroup": "Management Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.13",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk1",
                        "portGroup": "Storage Network",
                        "dPortGroup": "",
                        "ipAddress": "172.31.2.13",
                        "subnetMask": "255.255.0.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk3",
                        "portGroup": "",
                        "dPortGroup": "dvportgroup-48",
                        "ipAddress": "192.168.61.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk4",
                        "portGroup": "VM_DHCP_Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.231",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    }
                ],
                "portGroups": [
                    {
                        "key": "key-vim.host.PortGroup-VM Network",
                        "name": "VM Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Management Network",
                        "name": "Management Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_10G_Network",
                        "name": "VM_10G_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Storage",
                        "name": "VM_Storage",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_DHCP_Network",
                        "name": "VM_DHCP_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Storage Network",
                        "name": "Storage Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Isolated_67",
                        "name": "VM_Isolated_67",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Migration",
                        "name": "VM_Migration",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    }
                ],
                "switches": [
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch0",
                        "name": "vSwitch0",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM Network",
                            "key-vim.host.PortGroup-Management Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic4"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch1",
                        "name": "vSwitch1",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_10G_Network",
                            "key-vim.host.PortGroup-VM_Storage",
                            "key-vim.host.PortGroup-VM_DHCP_Network",
                            "key-vim.host.PortGroup-Storage Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic2",
                            "key-vim.host.PhysicalNic-vmnic0"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch2",
                        "name": "vSwitch2",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_Isolated_67",
                            "key-vim.host.PortGroup-VM_Migration"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic3",
                            "key-vim.host.PhysicalNic-vmnic1"
                        ]
                    }
                ]
            },
            "networks": [
                {
                    "kind": "Network",
                    "id": "network-31"
                },
                {
                    "kind": "Network",
                    "id": "network-34"
                },
                {
                    "kind": "Network",
                    "id": "network-57"
                },
                {
                    "kind": "Network",
                    "id": "network-33"
                },
                {
                    "kind": "Network",
                    "id": "dvportgroup-47"
                }
            ],
            "datastores": [
                {
                    "kind": "Datastore",
                    "id": "datastore-35"
                },
                {
                    "kind": "Datastore",
                    "id": "datastore-63"
                }
            ],
            "vms": null,
            "networkAdapters": [],
            "cluster": {
                "id": "domain-c26",
                "parent": {
                    "kind": "Folder",
                    "id": "group-h23"
                },
                "revision": 1,
                "name": "mycluster",
                "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/clusters/domain-c26",
                "folder": "group-h23",
                "networks": [
                    {
                        "kind": "Network",
                        "id": "network-31"
                    },
                    {
                        "kind": "Network",
                        "id": "network-34"
                    },
                    {
                        "kind": "Network",
                        "id": "network-57"
                    },
                    {
                        "kind": "Network",
                        "id": "network-33"
                    },
                    {
                        "kind": "Network",
                        "id": "dvportgroup-47"
                    }
                ],
                "datastores": [
                    {
                        "kind": "Datastore",
                        "id": "datastore-35"
                    },
                    {
                        "kind": "Datastore",
                        "id": "datastore-63"
                    }
                ],
                "hosts": [
                    {
                        "kind": "Host",
                        "id": "host-44"
                    },
                    {
                        "kind": "Host",
                        "id": "host-29"
                    }
                ],
                "dasEnabled": false,
                "dasVms": [],
                "drsEnabled": true,
                "drsBehavior": "fullyAutomated",
                "drsVms": [],
                "datacenter": null
            }
        }
    }
}</pre>
							</p></div></li></ol></div></section></section><section class="section" id="about-hooks-for-migration-plans_mtv"><div class="titlepage"><div><div><h2 class="title">7.3. About hooks for MTV migration plans</h2></div></div></div><p class="_abstract _abstract">
				You can add hooks to an Migration Toolkit for Virtualization (MTV) migration plan to perform automated operations on a VM, either before or after you migrate it.
			</p><p>
				You can add hooks to Migration Toolkit for Virtualization (MTV) migration plans using either the MTV CLI or the MTV user interface, which is located in the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="emphasis"><em>Pre-migration</em></span> hooks are hooks that perform operations on a VM that is located on a provider. This prepares the VM for migration.
					</li><li class="listitem">
						<span class="emphasis"><em>Post-migration</em></span> hooks are hooks that perform operations on a VM that has migrated to OpenShift Virtualization.
					</li></ul></div><section class="section" id="default-hook-image_mtv"><div class="titlepage"><div><div><h3 class="title">7.3.1. Default hook image</h3></div></div></div><p>
					The default hook image for an MTV hook is <code class="literal">quay.io/kubev2v/hook-runner</code>. The image is based on the Ansible Runner image with the addition of <code class="literal">python-openshift</code> to provide Ansible Kubernetes resources and a recent <code class="literal">oc</code> binary.
				</p></section><section class="section" id="hook-execution_mtv"><div class="titlepage"><div><div><h3 class="title">7.3.2. Hook execution</h3></div></div></div><p>
					An Ansible Playbook that is provided as part of a migration hook is mounted into the hook container as a <code class="literal">ConfigMap</code>. The hook container is run as a job on the desired cluster in the <code class="literal">openshift-mtv</code> namespace using the <code class="literal">ServiceAccount</code> you choose.
				</p><p>
					When you add a hook, you must specify the namespace where the <code class="literal">Hook</code> CR is located, the name of the hook, and whether the hook is a pre-migration hook or a post-migration hook.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						In order for a hook to run on a VM, the VM must be started and available using SSH.
					</p></div></div><p>
					The illustration that follows shows the general process of using a migration hook. For specific procedures, see <a class="link" href="#adding-migration-hook-via-ui_mtv" title="7.3.3. Adding a migration hook to a migration plan using the Red Hat OpenShift web console">Adding a migration hook to a migration plan using the Red Hat OpenShift web console</a> and <a class="link" href="#adding-migration-hook-via-cli_mtv" title="7.3.4. Adding a migration hook to a migration plan using the CLI">Adding a migration hook to a migration plan using the CLI</a>.
				</p><div class="figure" id="idm45556782998400"><p class="title"><strong>Figure 7.1. Adding a hook to a migration plan</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/modules/images/migration_hook_process.png" alt="Adding a hook to a migration plan"/></div></div></div><p>
					<span class="strong strong"><strong>Process:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Input your Ansible hook and credentials.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Input an Ansible hook image to the MTV controller using either the UI or the CLI.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											In the UI, specify the <code class="literal">ansible-runner</code> and enter the <code class="literal">playbook.yml</code> that contains the hook.
										</li><li class="listitem">
											In the CLI, input the hook image, which specifies the playbook that runs the hook.
										</li></ul></div></li><li class="listitem"><p class="simpara">
									If you need additional data to run the playbook inside the pod, such as SSH data, create a Secret that contains credentials for the VM. The Secret is not mounted to the pod, but is called by the playbook.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										This Secret is not the same as the <code class="literal">Secret</code> CR that contains the credentials of your source provider.
									</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
							The MTV controller creates the <code class="literal">ConfigMap</code>, which contains:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">workload.yml</code>, which contains information about the VMs.
								</li><li class="listitem">
									<code class="literal">playbook.yml</code>, the raw string playbook you want to run.
								</li><li class="listitem"><p class="simpara">
									<code class="literal">plan.yml</code>, which is the <code class="literal">Plan</code> CR.
								</p><p class="simpara">
									The <code class="literal">ConfigMap</code> contains the name of the VM and instructs the playbook what to do.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							The MTV controller creates a job that starts the user specified image.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Mounts the <code class="literal">ConfigMap</code> to the container.
								</p><p class="simpara">
									The Ansible hook imports the Secret that the user previously entered.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							The job runs a pre-migration hook or a post-migration hook as follows:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									For a pre-migration hook, the job logs into the VMs on the source provider using SSH and runs the hook.
								</li><li class="listitem">
									For a post-migration hook, the job logs into the VMs on OpenShift Virtualization using SSH and runs the hook.
								</li></ol></div></li></ol></div></section><section class="section" id="adding-migration-hook-via-ui_mtv"><div class="titlepage"><div><div><h3 class="title">7.3.3. Adding a migration hook to a migration plan using the Red Hat OpenShift web console</h3></div></div></div><p class="_abstract _abstract">
					You can add a migration hook to an existing migration plan by using the Red Hat OpenShift web console.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You need to run one command in the Migration Toolkit for Virtualization (MTV) CLI.
					</p></div></div><p>
					For example, you can create a hook to install the <code class="literal">cloud-init</code> service on a VM and write a file before migration.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can run one pre-migration hook, one post-migration hook, or one of each per migration plan.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Migration plan.
						</li><li class="listitem">
							Migration hook file, whose contents you copy and paste into the web console.
						</li><li class="listitem">
							File containing the <code class="literal">Secret</code> for the source provider.
						</li><li class="listitem">
							Red Hat OpenShift service account called by the hook and that has at least write access for the namespace you are working in. For instructions for creating a service account, see <a class="link" href="https://docs.openshift.com/container-platform/4.20/authentication/understanding-and-creating-service-accounts.html">Understanding and creating service accounts</a>.
						</li><li class="listitem">
							SSH access for VMs you want to migrate with the public key installed on the VMs.
						</li><li class="listitem">
							VMs running on Microsoft Server only: Remote Execution enabled.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span> and then click the migration plan you want to add the hook to.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Hooks</strong></span>.
						</li><li class="listitem"><p class="simpara">
							For a pre-migration hook, perform the following steps:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									In the <span class="strong strong"><strong>Pre migration hook</strong></span> section, toggle the <span class="strong strong"><strong>Enable hook</strong></span> switch to <span class="strong strong"><strong>Enable pre migration hook</strong></span>.
								</li><li class="listitem">
									Enter the <span class="strong strong"><strong>Hook runner image</strong></span>. If you are specifying the <code class="literal">spec.playbook</code>, you need to use an image that has an <code class="literal">ansible-runner</code>.
								</li><li class="listitem">
									Paste your hook as a YAML file in the <span class="strong strong"><strong>Ansible playbook</strong></span> text box.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							For a post-migration hook, perform the following steps:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									In the <span class="strong strong"><strong>Post migration hook</strong></span>, toggle the <span class="strong strong"><strong>Enable hook</strong></span> switch <span class="strong strong"><strong>Enable post migration hook</strong></span>.
								</li><li class="listitem">
									Enter the <span class="strong strong"><strong>Hook runner image</strong></span>. If you are specifying the <code class="literal">spec.playbook</code>, you need to use an image that has an <code class="literal">ansible-runner</code>.
								</li><li class="listitem">
									Paste your hook as a YAML file in the <span class="strong strong"><strong>Ansible playbook</strong></span> text box.
								</li></ol></div></li><li class="listitem">
							At the top of the tab, click <span class="strong strong"><strong>Update hooks</strong></span>.
						</li><li class="listitem"><p class="simpara">
							In a terminal, enter the following command to associate each hook with your Red Hat OpenShift service account:
						</p><pre class="programlisting language-terminal">$ oc -n openshift-mtv patch hook &lt;name_of_hook&gt; \
  -p '{"spec":{"serviceAccount":"&lt;service_account&gt;"}}' --type merge</pre><p class="simpara">
							The example migration hook that follows ensures that the VM can be accessed using SSH, creates an SSH key, and runs two tasks: stopping the Maria database and generating a text file.
						</p><pre class="programlisting language-yaml">- name: Main
  hosts: localhost
  vars_files:
    - plan.yml
    - workload.yml
  tasks:
  - k8s_info:
      api_version: v1
      kind: Secret
      name: privkey
      namespace: openshift-mtv
    register: ssh_credentials

  - name: Ensure SSH directory exists
    file:
      path: ~/.ssh
      state: directory
      mode: 0750

  - name: Create SSH key
    copy:
      dest: ~/.ssh/id_rsa
      content: "{{ ssh_credentials.resources[0].data.key | b64decode }}"
      mode: 0600

  - add_host:
      name: "{{ vm.ipaddress }}"  # ALT "{{ vm.guestnetworks[2].ip }}"
      ansible_user: root
      groups: vms

- hosts: vms
  vars_files:
    - plan.yml
    - workload.yml
  tasks:
  - name: Stop MariaDB
    service:
      name: mariadb
      state: stopped

  - name: Create Test File
    copy:
      dest: /premigration.txt
      content: "Migration from {{ provider.source.name }}
                of {{ vm.vm1.vm0.id }} has finished\n"
      mode: 0644</pre></li></ol></div></section><section class="section" id="adding-migration-hook-via-cli_mtv"><div class="titlepage"><div><div><h3 class="title">7.3.4. Adding a migration hook to a migration plan using the CLI</h3></div></div></div><p class="_abstract _abstract">
					You can use a <code class="literal">Hook</code> CR to add a pre-migration hook or a post-migration hook to an existing migration plan by using the Migration Toolkit for Virtualization (MTV) CLI.
				</p><p>
					For example, you can create a <code class="literal">Hook</code> custom resource (CR) to install the <code class="literal">cloud-init</code> service on a VM and write a file before migration.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can run one pre-migration hook, one post-migration hook, or one of each per migration plan. Each hook needs its own <code class="literal">Hook</code> CR, but a <code class="literal">Plan</code> CR contains data for all the hooks it uses.
					</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can retrieve additional information stored in a secret or in a <code class="literal">ConfigMap</code> by using a <code class="literal">k8s</code> module.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Migration plan.
						</li><li class="listitem">
							Migration hook image or the playbook containing the hook image.
						</li><li class="listitem">
							File containing the Secret for the source provider.
						</li><li class="listitem">
							Red Hat OpenShift service account called by the hook and that has at least write access for the namespace you are working in. For information about creating a service account, see <a class="link" href="https://docs.openshift.com/container-platform/4.20/authentication/understanding-and-creating-service-accounts.html">Understanding and creating service accounts</a>.
						</li><li class="listitem">
							SSH access for VMs you want to migrate with the public key installed on the VMs.
						</li><li class="listitem">
							VMs running on Microsoft Server only: Remote Execution enabled.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							If needed, create a Secret with an SSH private key for the VM.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Choose an existing key or generate a key pair.
								</li><li class="listitem">
									Install the public key on the VM.
								</li><li class="listitem"><p class="simpara">
									Encode the private key in the Secret to base64.
								</p><pre class="programlisting language-yaml">apiVersion: v1
data:
  key: VGhpcyB3YXMgZ2Vu...
kind: Secret
metadata:
  name: ssh-credentials
  namespace: openshift-mtv
type: Opaque</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Encode your playbook by concatenating a file and piping it for Base64 encoding, for example:
						</p><pre class="programlisting language-shell">$ cat playbook.yml | base64 -w0</pre></li><li class="listitem"><p class="simpara">
							Create a Hook CR:
						</p><pre class="programlisting language-yaml">$  cat &lt;&lt; EOF | oc apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/kubev2v/hook-runner
  serviceAccount:&lt;service_account&gt;
  playbook: |
    &lt;playbook&gt;
EOF</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;service_account&gt;</span></dt><dd>
										Specifies the Red Hat OpenShift service account. This is an optional label. The <code class="literal">serviceAccount</code> must be provided if you want to manipulate any resources of the cluster.
									</dd><dt><span class="term">&lt;playbook&gt;</span></dt><dd><p class="simpara">
										Specifies the Base64-encoded Ansible Playbook to use. For example, <code class="literal">LS0tCi0gbm...</code>. If you specify a playbook, the <code class="literal">image</code> must include an <code class="literal">ansible-runner</code>.
									</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											You can use the default <code class="literal">hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.
										</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											To decode an attached playbook, retrieve the resource with custom output and pipe it to base64. For example:
										</p><pre class="programlisting language-shell">$ oc get -n konveyor-forklift hook playbook -o \
    go-template='{{ .spec.playbook }}' | base64 -d</pre></div></div></dd></dl></div></li><li class="listitem"><p class="simpara">
							In the <code class="literal">Plan</code> CR of the migration, for each VM, add the following section to the end of the CR:
						</p><pre class="programlisting language-yaml">  vms:
    - id: &lt;vm_id&gt;
      hooks:
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;name_of_hook&gt;
          step: &lt;type_of_hook&gt;</pre><p class="simpara">
							where:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;type_of_hook&gt;</span></dt><dd>
										Specifies the type of hook. Options are <code class="literal">PreHook</code>, to run the hook before the migration, and <code class="literal">PostHook</code>, to run the hook after the migration.
									</dd></dl></div></li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						In order for a PreHook to run on a VM, the VM must be started and available via SSH.
					</p></div></div><p>
					The example migration hook that follows ensures that the VM can be accessed using SSH, creates an SSH key, and runs two tasks: stopping the Maria database and generating a text file.
				</p><pre class="programlisting language-yaml">- name: Main
  hosts: localhost
  vars_files:
    - plan.yml
    - workload.yml
  tasks:
  - k8s_info:
      api_version: v1
      kind: Secret
      name: privkey
      namespace: openshift-mtv
    register: ssh_credentials

  - name: Ensure SSH directory exists
    file:
      path: ~/.ssh
      state: directory
      mode: 0750

  - name: Create SSH key
    copy:
      dest: ~/.ssh/id_rsa
      content: "{{ ssh_credentials.resources[0].data.key | b64decode }}"
      mode: 0600

  - add_host:
      name: "{{ vm.ipaddress }}"  # ALT "{{ vm.guestnetworks[2].ip }}"
      ansible_user: root
      groups: vms

- hosts: vms
  vars_files:
    - plan.yml
    - workload.yml
  tasks:
  - name: Stop MariaDB
    service:
      name: mariadb
      state: stopped

  - name: Create Test File
    copy:
      dest: /premigration.txt
      content: "Migration from {{ provider.source.name }}
                of {{ vm.vm1.vm0.id }} has finished\n"
      mode: 0644</pre></section></section><section class="section" id="about-udn_mtv"><div class="titlepage"><div><div><h2 class="title">7.4. About user defined networks</h2></div></div></div><p class="_abstract _abstract">
				Beginning with Migration Toolkit for Virtualization 2.10, you can use a user-defined network (UDN) as your default network for migrations from all providers, except for OpenShift Virtualization. This flexibility allows you to migrate virtual machines (VMs) to OpenShift Virtualization more consistently.
			</p><p>
				MTV has been redesigned to make it easy for you to migrate VMs to UDN namespaces. Once you configure your UDN in OpenShift Virtualization, you can specify it as your default network in the migration plan mapping. MTV is now able to distinguish a UDN from a conventional pod network.
			</p><p>
				You can use this feature for creating migration plans by using the Red Hat OpenShift web console or by using the MTV command-line interface. The procedures for creating migration plans have been updated to include the new feature.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						link:<a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/virtualization/networking#virt-connecting-vm-to-primary-udn">Connecting a virtual machine to a primary user-defined network</a>
					</li></ul></div></section><section class="section" id="con_scheduling-target-vms-intro_mtv"><div class="titlepage"><div><div><h2 class="title">7.5. Scheduling target VMs</h2></div></div></div><p class="_abstract _abstract">
				By default, OpenShift Virtualization assigns the destination nodes of virtual machines (VMs) during migration. However, you can use the scheduling target VMs feature to define the destination nodes and apply specific conditions to schedule when the VMs are switched from <code class="literal">pending</code> to <code class="literal">on</code>.
			</p><section class="section" id="about-configuring-target-vm-scheduling_mtv"><div class="titlepage"><div><div><h3 class="title">7.5.1. About scheduling target VMs</h3></div></div></div><p class="_abstract _abstract">
					Starting with Migration Toolkit for Virtualization (MTV) 2.10, you can use the <span class="emphasis"><em>target VM scheduling</em></span> feature to direct MTV to migrate virtual machines (VMs) to specific nodes of OpenShift Virtualization as well as to schedule when to power on the VMs. Using the feature, you can design and enforce rules that you set using either the UI or command-line interface.
				</p><p>
					Previously, when you migrated VMs to OpenShift Virtualization, OpenShift Virtualization automatically determined the node the VMs would be migrated to. Although this served many customers' needs, there are certain situations in which it is useful to be able to specify the target node of a VM or the conditions under which the VM is powered on, regardless of the type of migration involved.
				</p><section class="section" id="use_cases"><div class="titlepage"><div><div><h4 class="title">7.5.1.1. Use cases</h4></div></div></div><p>
						Target VM scheduling is designed to help you with the following use cases, among others:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Business continuity and disaster recovery</strong></span>: You can use scheduling rules to migrate and power up critical VMs to several sites, in different time zones or otherwise geographically separated by significant distances. This allows you to deploy these VMs as strategic assets for business continuity, such as disaster recovery.
							</li><li class="listitem">
								<span class="strong strong"><strong>Working with fluctuating demands</strong></span>: In situations where demand for a service might vary significantly, rules for scheduling when to spin up VMs based upon demand allows you to use your resources more efficiently.
							</li></ul></div></section></section><section class="section" id="target-vm-scheduling-prerequisites_mtv"><div class="titlepage"><div><div><h3 class="title">7.5.2. Target VM scheduling prerequisites</h3></div></div></div><p class="_abstract _abstract">
					Migrations that use target VM scheduling require the following prerequisites, in addition to the prerequisites for your source provider:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Migration Toolkit for Virtualization (MTV) 2.10 or later.
						</li><li class="listitem">
							Version of OpenShift Virtualization that is compatible with your version of MTV. For MTV 2.10, the compatible versions of OpenShift Virtualization are 4.18, 4.19, and 4.20 only.
						</li><li class="listitem">
							<code class="literal">cluster-admin</code> or equivalent security privileges that allow managing <code class="literal">VirtualMachineInstance</code> objects and associated Kubernetes scheduling primitives.
						</li></ul></div></section><section class="section" id="target-vm-scheduling-options_mtv"><div class="titlepage"><div><div><h3 class="title">7.5.3. Target VM scheduling options</h3></div></div></div><p class="_abstract _abstract">
					You can use the following options to schedule when your target VMs are powered on:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>Node Selector</strong></span> rule: This is both the simplest rule. You define a set of mandatory exact match key-value label pairs that the target node must possess. If no node on the cluster has all the labels specified, the VM is not scheduled and it remains in a <code class="literal">Pending</code> state until there is space on a node that fits the key-value label pairs.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Affinity and Anti-Affinity</strong></span> rules: <span class="emphasis"><em>Node Affinity</em></span> rules let you schedule VMs to run on selected nodes or workloads (pods). <span class="emphasis"><em>Node Anti-affinity</em></span> rules let you prevent VMs from being scheduled to run on selected workloads (pods).
						</p><p class="simpara">
							Node Affinity and Node Anti-Affinity rules offer more flexible placement control than rigid Node Selector rules, because they support conditionals such as <code class="literal">In</code>, <code class="literal">NotIn</code>.
						</p><p class="simpara">
							Additionally, Affinity rules and Anti-Affinity rules allow you to include both <span class="emphasis"><em>hard</em></span> and <span class="emphasis"><em>soft</em></span> conditions in the same rule. A hard condition is a requirement, and a soft condition is a preference.
						</p></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Affinity rules are supported by MTV at both the node and the workload (pod) levels, but Anti-Affinity rules are supported at the workload (pod) level only.
					</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>Custom Scheduler Name</strong></span>: If your OpenShift Virtualization environment uses a secondary or specialized scheduler, in addition to the default <code class="literal">kube-scheduler</code>, to handle specific workload types, you can instruct MTV to apply this custom scheduler name to the target VM’s manifest. This directs the VM to use the specialized logic designed for that workload. This feature is implemented by using the <span class="strong strong"><strong>VM target label</strong></span> feature.
						</li></ul></div><p>
					By integrating any of these three types of controls into your migration plan, you ensure that the complex scheduling logic required for modern applications is defined upfront, preventing post-migration performance degradation or unexpected scheduling errors.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Any scheduling rule applied in a migration plan applies to all VMs in it.
					</p></div></div><p>
					Target VM scheduling in MTV derives from Kubernetes’s support for <a class="link" href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">Assigning Pods to Nodes</a>.
				</p></section><section class="section" id="configuring-target-vm-scheduling-cli_mtv"><div class="titlepage"><div><div><h3 class="title">7.5.4. Scheduling target VMs from the command-line interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the command-line interface (CLI) to tell Migration Toolkit for Virtualization (MTV) to migrate virtual machines (VMs) to specific nodes or workloads (pods) of OpenShift Virtualization as well as to schedule when the VMs are powered on.
				</p><p>
					The MTV CLI supports the following scheduling-related labels, all of which are added to the <code class="literal">Plan</code> CR:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">targetAffinity</code>: Implements placement policies such as co-locating related workloads or, for disaster recovery, ensuring that specific VMs are migrated to different nodes. This type of label uses hard (requirements) and soft (preferences) conditions combined with logical operators, such as <code class="literal">and</code>, <code class="literal">or,</code> and <code class="literal">not</code>, to provide greater flexibility than the <code class="literal">targetLabelSelector</code> label discussed following.
						</li><li class="listitem">
							<code class="literal">targetLabels</code>: Applies organizational or operational labels to migrated VMs for identification and management.
						</li><li class="listitem">
							<code class="literal">targetNodeSelector</code>: Ensures VMs are scheduled on nodes that are an exact match for key-value pairs you create. This type of label is often used for nodes with special capabilities, such as GPU nodes or storage nodes.
						</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						System-managed labels, such as migration, plan, VM ID, or application labels, override any user-defined labels.
					</p></div></div><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
						Migrations that use target VM scheduling require the following prerequisites, in addition to the prerequisites for your source provider:
					</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Migration Toolkit for Virtualization (MTV) 2.10 or later.
						</li><li class="listitem">
							Version of OpenShift Virtualization that is compatible with your version of MTV. For MTV 2.10, the compatible versions of OpenShift Virtualization are 4.18, 4.19, and 4.20 only.
						</li><li class="listitem">
							<code class="literal">cluster-admin</code> or equivalent security privileges that allow managing <code class="literal">VirtualMachineInstance</code> objects and associated Kubernetes scheduling primitives.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Create custom resources (CR)s for the migration according to the procedure for the provider.
						</li><li class="listitem"><p class="simpara">
							In the <code class="literal">Plan</code> CR, add the following labels before <code class="literal">spec:targetNamespace</code>. All are optional.
						</p><pre class="programlisting language-yaml">...
  targetAffinity: &lt;affinity rule, which can be quite complex, is entered in lines following this label. See example that follows&gt;
  targetLabels:
    label: &lt;label&gt;
  targetNodeSelector:
    &lt;key&gt;:&lt;value&gt;
  targetNamespace:&lt;target_namespace&gt;
...</pre><p class="simpara">
							Example:
						</p><p class="simpara">
							The following scheduling rule migrates the VMs in the plan to different nodes for disaster recovery:
						</p></li></ol></div><pre class="screen">  targetLabels:
    label: test1
  targetAffinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: label
                operator: In
                values:
                  - test1
          topologyKey: kubernetes.io/hostname</pre><div class="formalpara"><p class="title"><strong>Result</strong></p><p>
						As a result of the preceding rule, the VMs are migrated accordingly to the resulting <code class="literal">spec</code>:
					</p></div><pre class="programlisting language-yaml">spec:
  runStrategy: Always
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: mtv-rhel8-sanity-ceph-rbd
        label: test1
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: label
                    operator: In
                    values:
                      - test1
              topologyKey: kubernetes.io/hostname</pre></section><section class="section" id="configuring-target-vm-scheduling-ui_mtv"><div class="titlepage"><div><div><h3 class="title">7.5.5. Scheduling target VMs from the user interface</h3></div></div></div><p class="_abstract _abstract">
					You can use the Migration Toolkit for Virtualization (MTV) user interface, which is located in the Red Hat OpenShift web console, to tell Migration Toolkit for Virtualization (MTV) to migrate virtual machines (VMs) to specific nodes or workloads (pods) of OpenShift Virtualization as well as to schedule when the VMs are powered on.
				</p><p>
					The <span class="strong strong"><strong>Virtualization</strong></span> section of the Red Hat OpenShift web console supports the following options for scheduling target VMs:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<span class="strong strong"><strong>VM target node selector</strong></span>: Ensures VMs are scheduled on nodes that are an exact match for key-value pairs you create. This type of label is often used for nodes with special capabilities, such as GPU nodes or storage nodes.
						</li><li class="listitem">
							<span class="strong strong"><strong>VM target labels</strong></span>: Applies organizational or operational labels to migrated VMs for identification and management.
						</li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>VM target affinity rules</strong></span>: Implements placement policies such as co-locating related workloads or, for disaster recovery, ensuring that specific VMs are migrated to different nodes. This type of rule uses hard (requirements) and soft (preferences) conditions combined with logical operators, such as <code class="literal">Exists</code> or <code class="literal">DoesNotExist</code> instead of using the rigid key-value pairs used by a VM target node selector. As a result, target affinity rules are more flexible than target node selector rules.
						</p><p class="simpara">
							The MTV UI supports the following affinity rules:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Node affinity rules
								</li><li class="listitem">
									Workload (pod) affinity and anti-affinity rules
								</li></ul></div></li></ul></div><p>
					You configure target VM scheduling options on the <span class="strong strong"><strong>Plan details</strong></span> page of the relevant migration plan. The options apply to all VMs that are included in that migration.
				</p></section></section></section><section class="chapter" id="assembly_upgrading-uninstalling-mtv_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Upgrading or uninstalling the Migration Toolkit for Virtualization</h1></div></div></div><p class="_abstract _abstract">
			You can upgrade or uninstall the Migration Toolkit for Virtualization (MTV) by using the Red Hat OpenShift web console or the command-line interface (CLI).
		</p><section class="section" id="upgrading-mtv-ui_mtv"><div class="titlepage"><div><div><h2 class="title">8.1. Upgrading the Migration Toolkit for Virtualization</h2></div></div></div><p class="_abstract _abstract">
				You can upgrade the MTV Operator by using the Red Hat OpenShift web console to install the new version.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Operators</strong></span> → <span class="strong strong"><strong>Installed Operators</strong></span> → <span class="strong strong"><strong>Migration Toolkit for Virtualization Operator</strong></span> → <span class="strong strong"><strong>Subscription</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Change the update channel to the correct release.
					</p><p class="simpara">
						See <a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/operators/administrator-tasks#olm-changing-update-channel_olm-upgrading-operators">Changing the update channel for an Operator</a> in the Red Hat OpenShift documentation.
					</p></li><li class="listitem"><p class="simpara">
						Confirm that <span class="strong strong"><strong>Upgrade status</strong></span> changes from <span class="strong strong"><strong>Up to date</strong></span> to <span class="strong strong"><strong>Upgrade available</strong></span>. If it does not, restart the <code class="literal">CatalogSource</code> pod:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Note the catalog source, for example, <code class="literal">redhat-operators</code>.
							</li><li class="listitem"><p class="simpara">
								From the command line, retrieve the catalog source pod:
							</p><pre class="programlisting language-terminal">$ oc get pod -n openshift-marketplace | grep &lt;catalog_source&gt;</pre></li><li class="listitem"><p class="simpara">
								Delete the pod:
							</p><pre class="programlisting language-terminal">$ oc delete pod -n openshift-marketplace &lt;catalog_source_pod&gt;</pre><p class="simpara">
								<span class="strong strong"><strong>Upgrade status</strong></span> changes from <span class="strong strong"><strong>Up to date</strong></span> to <span class="strong strong"><strong>Upgrade available</strong></span>.
							</p><p class="simpara">
								If you set <span class="strong strong"><strong>Update approval</strong></span> on the <span class="strong strong"><strong>Subscriptions</strong></span> tab to <span class="strong strong"><strong>Automatic</strong></span>, the upgrade starts automatically.
							</p></li></ol></div></li><li class="listitem"><p class="simpara">
						If you set <span class="strong strong"><strong>Update approval</strong></span> on the <span class="strong strong"><strong>Subscriptions</strong></span> tab to <span class="strong strong"><strong>Manual</strong></span>, approve the upgrade.
					</p><p class="simpara">
						See <a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/operators/administrator-tasks#olm-approving-pending-upgrade_olm-upgrading-operators">Manually approving a pending Operator upgrade</a> in the Red Hat OpenShift documentation.
					</p></li><li class="listitem">
						If you are upgrading from MTV 2.2 and have defined VMware source providers, edit the VMware provider by adding a VDDK <code class="literal">init</code> image. Otherwise, the update will change the state of any VMware providers to <code class="literal">Critical</code>. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.4/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#adding-source-provider_vmware">Adding a VMware source provider</a>.
					</li><li class="listitem">
						If you mapped to NFS on the Red Hat OpenShift destination provider in MTV 2.2, edit the <code class="literal">AccessModes</code> and <code class="literal">VolumeMode</code> parameters in the NFS storage profile. Otherwise, the upgrade will invalidate the NFS mapping. For more information, see <a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/virtualization/index#virt-configuring-storage-profile">Customizing storage profiles</a>.
					</li></ol></div></section><section class="section" id="uninstalling-mtv-ui_mtv"><div class="titlepage"><div><div><h2 class="title">8.2. Uninstalling MTV by using the Red Hat OpenShift web console</h2></div></div></div><p class="_abstract _abstract">
				You can uninstall Migration Toolkit for Virtualization (MTV) by using the Red Hat OpenShift web console.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Operators &gt; Installed Operators</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Migration Toolkit for Virtualization Operator</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Operator Details</strong></span> page opens in the <span class="strong strong"><strong>Details</strong></span> tab.
					</p></li><li class="listitem">
						Click the <span class="strong strong"><strong>ForkliftController</strong></span> tab.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Actions</strong></span> and select <span class="strong strong"><strong>Delete ForkLiftController</strong></span>.
					</p><p class="simpara">
						A confirmation window opens.
					</p></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Delete</strong></span>.
					</p><p class="simpara">
						The controller is removed.
					</p></li><li class="listitem"><p class="simpara">
						Open the <span class="strong strong"><strong>Details</strong></span> tab.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Create ForkliftController</strong></span> button appears instead of the controller you deleted. There is no need to click it.
					</p></li><li class="listitem"><p class="simpara">
						On the upper-right side of the page, click <span class="strong strong"><strong>Actions</strong></span> and select <span class="strong strong"><strong>Uninstall Operator</strong></span>.
					</p><p class="simpara">
						A confirmation window opens, displaying any operand instances.
					</p></li><li class="listitem"><p class="simpara">
						To delete all instances, select the <span class="strong strong"><strong>Delete all operand instances for this operator</strong></span> checkbox. By default, the checkbox is cleared.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							If your Operator configured off-cluster resources, these will continue to run and will require manual cleanup.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Uninstall</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Installed Operators</strong></span> page opens, and the Migration Toolkit for Virtualization Operator is removed from the list of installed Operators.
					</p></li><li class="listitem">
						Click <span class="strong strong"><strong>Home &gt; Overview</strong></span>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>Status</strong></span> section of the page, click <span class="strong strong"><strong>Dynamic Plugins</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>Dynamic Plugins</strong></span> pop-up opens, listing <span class="strong strong"><strong>forklift-console-plugin</strong></span> as a failed plugin. If the <span class="strong strong"><strong>forklift-console-plugin</strong></span> does not appear as a failed plugin, refresh the web console.
					</p></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>forklift-console-plugin</strong></span>.
					</p><p class="simpara">
						The <span class="strong strong"><strong>ConsolePlugin details</strong></span> page opens in the <span class="strong strong"><strong>Details</strong></span> tab.
					</p></li><li class="listitem"><p class="simpara">
						On the upper right side of the page, click <span class="strong strong"><strong>Actions</strong></span> and select <span class="strong strong"><strong>Delete ConsolePlugin</strong></span> from the list.
					</p><p class="simpara">
						A confirmation window opens.
					</p></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Delete</strong></span>.
					</p><p class="simpara">
						The plugin is removed from the list of <span class="strong strong"><strong>Dynamic plugins</strong></span> on the <span class="strong strong"><strong>Overview</strong></span> page. If the plugin still appears, restart the <span class="strong strong"><strong>Overview</strong></span> page.
					</p></li></ol></div></section><section class="section" id="uninstalling-mtv-cli_mtv"><div class="titlepage"><div><div><h2 class="title">8.3. Uninstalling MTV from the command line</h2></div></div></div><p class="_abstract _abstract">
				You can uninstall Migration Toolkit for Virtualization (MTV) from the command line.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					This action does not remove resources managed by the MTV Operator, including custom resource definitions (CRDs) and custom resources (CRs). To remove these after uninstalling the MTV Operator, you might need to manually delete the MTV Operator CRDs.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in as a user with <code class="literal">cluster-admin</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Delete the <code class="literal">forklift</code> controller by running the following command:
					</p><pre class="programlisting language-terminal">$ oc delete ForkliftController --all -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
						Delete the subscription to the MTV Operator by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get subscription -o name|grep 'mtv-operator'| xargs oc delete</pre></li><li class="listitem"><p class="simpara">
						Delete the <code class="literal">clusterserviceversion</code> for the MTV Operator by running the following command:
					</p><pre class="programlisting language-terminal">$ oc get clusterserviceversion -o name|grep 'mtv-operator'| xargs oc delete</pre></li><li class="listitem"><p class="simpara">
						Delete the plugin console CR by running the following command:
					</p><pre class="programlisting language-terminal">$ oc delete ConsolePlugin forklift-console-plugin</pre></li><li class="listitem"><p class="simpara">
						Optional: Delete the custom resource definitions (CRDs) by running the following command:
					</p><pre class="programlisting language-terminal">oc get crd -o name | grep 'forklift.konveyor.io' | xargs oc delete</pre></li><li class="listitem"><p class="simpara">
						Optional: Perform cleanup by deleting the MTV project by running the following command:
					</p><pre class="programlisting language-terminal">oc delete project openshift-mtv</pre></li></ol></div></section></section><section class="chapter" id="assembly_troubleshooting-migration_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Troubleshooting migration</h1></div></div></div><p class="_abstract _abstract">
			Troubleshoot migration issues, navigate custom resources (CRs), services, and workflows, and download logs and CRs for troubleshooting information.
		</p><section class="section" id="error-messages_mtv"><div class="titlepage"><div><div><h2 class="title">9.1. Error messages</h2></div></div></div><p class="_abstract _abstract">
				This section describes error messages and how to resolve them.
			</p><section class="section" id="warm-import-retry-limit_mtv"><div class="titlepage"><div><div><h3 class="title">9.1.1. warm import retry limit reached</h3></div></div></div><p>
					The <code class="literal">warm import retry limit reached</code> error message is displayed during a warm migration if a VMware virtual machine (VM) has reached the maximum number (28) of changed block tracking (CBT) snapshots during the precopy stage.
				</p><p>
					To resolve this problem, delete some of the CBT snapshots from the VM and restart the migration plan.
				</p></section><section class="section" id="unable-resize-disk-image_mtv"><div class="titlepage"><div><div><h3 class="title">9.1.2. Unable to resize disk image to required size</h3></div></div></div><p>
					The <code class="literal">Unable to resize disk image to required size</code> error message is displayed when migration fails because a virtual machine on the target provider uses persistent volumes with an EXT4 file system on block storage. The problem occurs because the default overhead that is assumed by CDI does not completely include the reserved place for the root partition.
				</p><p>
					To resolve this problem, increase the file system overhead in CDI to more than 10%.
				</p></section></section><section class="section" id="using-must-gather_mtv"><div class="titlepage"><div><div><h2 class="title">9.2. Using the must-gather tool</h2></div></div></div><p class="_abstract _abstract">
				You can collect logs and information about MTV custom resources (CRs) by using the <code class="literal">must-gather</code> tool. You must attach a <code class="literal">must-gather</code> data file to all customer cases.
			</p><p>
				You can gather data for a specific namespace, migration plan, or virtual machine (VM) by using the filtering options.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If you specify a non-existent resource in the filtered <code class="literal">must-gather</code> command, no archive file is created.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You must be logged in to the OpenShift Virtualization cluster as a user with the <code class="literal">cluster-admin</code> role.
					</li><li class="listitem">
						You must have the <a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/cli_tools/openshift-cli-oc#openshift-cli-oc">Red Hat OpenShift CLI (oc)</a> installed.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Navigate to the directory where you want to store the <code class="literal">must-gather</code> data.
					</li><li class="listitem"><p class="simpara">
						Run the <code class="literal">oc adm must-gather</code> command:
					</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2</pre><p class="simpara">
						The data is saved as <code class="literal">/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
					</p></li><li class="listitem"><p class="simpara">
						Optional: Run the <code class="literal">oc adm must-gather</code> command with the following options to gather filtered data:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Namespace:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
								Migration plan:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
								Virtual machine:
							</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- VM=&lt;vm_id&gt; NS=&lt;namespace&gt; /usr/bin/targeted</pre><p class="simpara">
								where:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;vm_id&gt;</span></dt><dd>
											Specifies the VM <span class="emphasis"><em>ID</em></span> as it appears in the <code class="literal">Plan</code> CR.
										</dd></dl></div></li></ul></div></li></ol></div></section><section class="section" id="mtv-resources-and-services_mtv"><div class="titlepage"><div><div><h2 class="title">9.3. MTV custom resources and services</h2></div></div></div><p class="_abstract _abstract">
				The MTV Operator is provided as an Red Hat OpenShift Operator. It creates and manages the following custom resources (CRs) and services.
			</p><section class="section" id="mtv_custom_resources"><div class="titlepage"><div><div><h3 class="title">9.3.1. MTV custom resources</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Provider</code> CR stores attributes that enable MTV to connect to and interact with the source and target providers.
						</li><li class="listitem">
							<code class="literal">NetworkMapping</code> CR maps the networks of the source and target providers.
						</li><li class="listitem">
							<code class="literal">StorageMapping</code> CR maps the storage of the source and target providers.
						</li><li class="listitem">
							<code class="literal">Plan</code> CR contains a list of VMs with the same migration parameters and associated network and storage mappings.
						</li><li class="listitem"><p class="simpara">
							<code class="literal">Migration</code> CR runs a migration plan.
						</p><p class="simpara">
							Only one <code class="literal">Migration</code> CR per migration plan can run at a given time. You can create multiple <code class="literal">Migration</code> CRs for a single <code class="literal">Plan</code> CR.
						</p></li></ul></div></section><section class="section" id="mtv_services"><div class="titlepage"><div><div><h3 class="title">9.3.2. MTV services</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The <code class="literal">Inventory</code> service performs the following actions:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Connects to the source and target providers.
								</li><li class="listitem">
									Maintains a local inventory for mappings and plans.
								</li><li class="listitem">
									Stores VM configurations.
								</li><li class="listitem">
									Runs the <code class="literal">Validation</code> service if a VM configuration change is detected.
								</li></ul></div></li><li class="listitem">
							The <code class="literal">Validation</code> service checks the suitability of a VM for migration by applying rules.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">Migration Controller</code> service orchestrates migrations.
						</p><p class="simpara">
							When you create a migration plan, the <code class="literal">Migration Controller</code> service validates the plan and adds a status label. If the plan fails validation, the plan status is <code class="literal">Not ready</code> and the plan cannot be used to perform a migration. If the plan passes validation, the plan status is <code class="literal">Ready</code> and it can be used to perform a migration. After a successful migration, the <code class="literal">Migration Controller</code> service changes the plan status to <code class="literal">Completed</code>.
						</p></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service orchestrates disk transfers using Volume Populators.
						</li><li class="listitem">
							The <code class="literal">Kubevirt Controller</code> and <code class="literal">Containerized Data Import (CDI) Controller</code> services handle most technical operations.
						</li></ul></div></section></section><section class="section" id="mtv-workflow_mtv"><div class="titlepage"><div><div><h2 class="title">9.4. High-level migration workflow</h2></div></div></div><p class="_abstract _abstract">
				The high-level workflow shows the migration process from the point of view of the user:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						You create a source provider, a target provider, a network mapping, and a storage mapping.
					</li><li class="listitem"><p class="simpara">
						You create a <code class="literal">Plan</code> custom resource (CR) that includes the following resources:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Source provider
							</li><li class="listitem">
								Target provider, if MTV is not installed on the target cluster
							</li><li class="listitem">
								Network mapping
							</li><li class="listitem">
								Storage mapping
							</li><li class="listitem">
								One or more virtual machines (VMs)
							</li></ul></div></li><li class="listitem"><p class="simpara">
						You run a migration plan by creating a <code class="literal">Migration</code> CR that references the <code class="literal">Plan</code> CR.
					</p><p class="simpara">
						If you cannot migrate all the VMs for any reason, you can create multiple <code class="literal">Migration</code> CRs for the same <code class="literal">Plan</code> CR until all VMs are migrated.
					</p></li><li class="listitem">
						For each VM in the <code class="literal">Plan</code> CR, the <code class="literal">Migration Controller</code> service records the VM migration progress in the <code class="literal">Migration</code> CR.
					</li><li class="listitem"><p class="simpara">
						Once the data transfer for each VM in the <code class="literal">Plan</code> CR completes, the <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR.
					</p><p class="simpara">
						When all VMs have been migrated, the <code class="literal">Migration Controller</code> service updates the status of the <code class="literal">Plan</code> CR to <code class="literal">Completed</code>. The power state of each source VM is maintained after migration.
					</p></li></ol></div><section class="section" id="virt-migration-workflow_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.1. Detailed migration workflow</h3></div></div></div><p class="_abstract _abstract">
					You can use the detailed migration workflow to troubleshoot a failed migration.
				</p><p>
					The workflow describes the following steps:
				</p><p>
					<span class="strong strong"><strong>Warm Migration or migration to a remote OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create the <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates a <code class="literal">DataVolume</code> CR for each source VM disk.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Containerized Data Importer (CDI) Controller</code> service creates a persistent volume claim (PVC) based on the parameters specified in the <code class="literal">DataVolume</code> CR.
						</li><li class="listitem">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</li><li class="listitem">
							The <code class="literal">CDI Controller</code> service creates an <code class="literal">importer</code> pod.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">importer</code> pod streams the VM disk to the PV.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem"><p class="simpara">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">conversion</code> pod with the PVCs attached to it when importing from VMware.
						</p><p class="simpara">
							The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which installs and configures device drivers on the PVCs of the target VM.
						</p></li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div><p>
					<span class="strong strong"><strong>Cold migration from Red Hat Virtualization or OpenStack to the local OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create a <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates for each source VM disk a <code class="literal">PersistentVolumeClaim</code> CR, and an <code class="literal">OvirtVolumePopulator</code> when the source is RHV, or an <code class="literal">OpenstackVolumePopulator</code> CR when the source is OpenStack.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service creates a temporarily persistent volume claim (PVC).
						</li><li class="listitem"><p class="simpara">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">Migration Controller</code> service creates a dummy pod to bind <span class="strong strong"><strong>all PVCs</strong></span>. The name of the pod contains <code class="literal">pvcinit</code>.
								</li></ul></div></li><li class="listitem">
							The <code class="literal">Populator Controller</code> service creates a <code class="literal">populator</code> pod.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">populator</code> pod transfers the disk data to the PV.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem">
							The temporary PVC is deleted, and the initial PVC points to the PV with the data.
						</li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div><p>
					<span class="strong strong"><strong>Cold migration from VMware to the local OpenShift cluster:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							When you create a <code class="literal">Migration</code> custom resource (CR) to run a migration plan, the <code class="literal">Migration Controller</code> service creates a <code class="literal">DataVolume</code> CR for each source VM disk.
						</p><p class="simpara">
							<span class="strong strong"><strong>For each VM disk:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Containerized Data Importer (CDI) Controller</code> service creates a blank persistent volume claim (PVC) based on the parameters specified in the <code class="literal">DataVolume</code> CR.
						</li><li class="listitem">
							If the <code class="literal">StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code class="literal">StorageClass</code> provisioner.
						</li></ol></div><p>
					<span class="strong strong"><strong>For all VM disks:</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a dummy pod to bind <span class="strong strong"><strong>all PVCs</strong></span>. The name of the pod contains <code class="literal">pvcinit</code>.
						</li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">conversion</code> pod for all PVCs.
						</li><li class="listitem"><p class="simpara">
							The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which converts the VM to the KVM hypervisor and transfers the disks' data to their corresponding PVs.
						</p><p class="simpara">
							<span class="strong strong"><strong>After the VM disks are transferred:</strong></span>
						</p></li><li class="listitem">
							The <code class="literal">Migration Controller</code> service creates a <code class="literal">VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.
						</li><li class="listitem"><p class="simpara">
							If the VM ran on the source environment, the <code class="literal">Migration Controller</code> powers on the VM, the <code class="literal">KubeVirt Controller</code> service creates a <code class="literal">virt-launcher</code> pod and a <code class="literal">VirtualMachineInstance</code> CR.
						</p><p class="simpara">
							The <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
						</p></li></ol></div></section><section class="section" id="virt-v2v-mtv_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.2. How MTV uses the virt-v2v tool</h3></div></div></div><p class="_abstract _abstract">
					The Migration Toolkit for Virtualization (MTV) uses the <code class="literal">virt-v2v</code> tool to convert the disk image of a virtual machine (VM) into a format compatible with OpenShift Virtualization. The tool makes migrations easier because it automatically performs the tasks needed to make your VMs work with OpenShift Virtualization. For example, enabling paravirtualized VirtIO drivers in the converted VM, if possible, and installing the QEMU guest agent.
				</p><p>
					<code class="literal">virt-v2v</code> is included in Red Hat Enterprise Linux (RHEL) versions 7 and later.
				</p><section class="section" id="main-functions-virt-v2v-mtv_mtv"><div class="titlepage"><div><div><h4 class="title">9.4.2.1. Main functions of virt-v2v in MTV migrations</h4></div></div></div><p>
						During migration, MTV uses <code class="literal">virt-v2v</code> to collect metadata about VMs, make necessary changes to VM disks, and copy the disks containing the VMs to OpenShift Virtualization.
					</p><p>
						<code class="literal">virt-v2v</code> makes the following changes to VM disks to prepare them for migration:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Additions:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										Injection of VirtIO drivers, for example, network or disk drivers.
									</li><li class="listitem">
										Preparation of hypervisor-specific tools or agents, for example, a QEMU guest agent installation.
									</li><li class="listitem">
										Modification of boot configuration, for example, updated boot loader or boot entries.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								Removals:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										Unnecessary or former hypervisor-specific files, for example, VMware tools or VirtualBox additions.
									</li><li class="listitem">
										Old network driver configurations, for example, removing VMware-specific NIC drivers.
									</li><li class="listitem">
										Configuration settings that are incompatible with the target system, for example, old boot settings.
									</li></ul></div></li></ul></div><p>
						If you are migrating from VMware or from Open Virtual Appliances (OVA) files, <code class="literal">virt-v2v</code> also sets their IP addresses either during the migration or during the first reboot of the VMs after migration. s
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							You can also run predefined Ansible hooks before or after a migration using MTV. For more information, see <a class="link" href="#about-hooks-for-migration-plans_mtv" title="7.3. About hooks for MTV migration plans">About hooks for MTV migration plans</a>.
						</p><p>
							These hooks do not necessarily use <code class="literal">virt-v2v</code>.
						</p></div></div></section><section class="section" id="customizing-removing-installing-virt-v2v_mtv"><div class="titlepage"><div><div><h4 class="title">9.4.2.2. Customizing, removing, and installing files</h4></div></div></div><p>
						MTV uses <code class="literal">virt-v2v</code> to perform additional guest customizations during the conversion, such as the following actions:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Customization to preserve IP addresses
							</li><li class="listitem">
								Customization to preserve drive letters
							</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							For Red Hat Enterprise Linux (RHEL)-based guests, <code class="literal">virt-v2v</code> attempts to install the guest agent from the Red Hat registry. If the migration is run in a detached environment, the installation program fails, and you must use hooks or other automation to install the guest agent.
						</p></div></div><p>
						For more information, see the man reference pages:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="https://libguestfs.org/virt-v2v.1.html"><code class="literal">virt-v2v</code> - Convert a guest to use KVM</a>
							</li><li class="listitem">
								<a class="link" href="https://libguestfs.org/virt-customize.1.html"><code class="literal">virt-customize</code> - Customize a virtual machine</a>
							</li></ul></div></section><section class="section" id="permissions-virt-v2v_mtv"><div class="titlepage"><div><div><h4 class="title">9.4.2.3. Permissions and virt-v2v</h4></div></div></div><p>
						<code class="literal">virt-v2v</code> does not require permissions or access credentials for the guest operating system itself because <code class="literal">virt-v2v</code> is not run against a running VM, but only against the disks of a VM.
					</p></section></section><section class="section" id="raw-copy-mode_mtv"><div class="titlepage"><div><div><h3 class="title">9.4.3. Raw copy mode</h3></div></div></div><p class="_abstract _abstract">
					In regular cold and warm migrations, Migration Toolkit for Virtualization (MTV) uses a program called <code class="literal">virt-v2v</code> to prepare virtual machines (VMs) for migration to OpenShift Virtualization after the VMs have been copied from their source provider.
				</p><p>
					The main function of <code class="literal">virt-v2v</code> is to convert the disk image of a VM into a format compatible with OpenShift Virtualization. This program is described in detail in <a class="link" href="#virt-v2v-mtv_mtv" title="9.4.2. How MTV uses the virt-v2v tool">How MTV uses the virt-v2v tool</a>. What is important to note here is that although <code class="literal">virt-v2v</code> is compatible with major operating systems such as recent versions of Red Hat Enterprise Linux, Windows, and Windows Server, it is not compatible with macOS and some other operating systems.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						For a list of the operating systems that <code class="literal">virt-v2v</code> supports, see <a class="link" href="https://access.redhat.com/articles/1351473">Converting virtual machines from other hypervisors to KVM with virt-v2v in RHEL 7, RHEL 8, RHEL 9, and RHEL 10</a>.
					</p></div></div><p>
					As a workaround for migrating VMs that use an operating system that <code class="literal">virt-v2v</code> does not support, MTV includes a feature called <span class="emphasis"><em>raw copy mode</em></span>. Raw copy mode copies VMs without applying any tool to convert them for use with OpenShift Virtualization. The migrated VMs use emulated devices.
				</p><p>
					This enables more robust migrations, enabling a wider range of operating systems and configurations. Examples are VMs with uncommon file systems, VMs with uncommon encryption technologies or without access to keys.
				</p><p>
					However, VMs migrated using raw copy mode might not boot on OpenShift Virtualization or perform as well as VMs migrated in the regular way. VMs migrated using raw copy mode might not boot on OpenShift Virtualization or perform as well as VMs migrated in the regular way.
				</p><p>
					Therefore, using raw copy mode is a tradeoff between being a more versatile migration option compared to increasing the risk of problems following migration.
				</p><p>
					Because of this risk, users are asked to request that Red Hat support perform raw copy mode migrations.
				</p></section></section><section class="section" id="collected-logs-cr-info_mtv"><div class="titlepage"><div><div><h2 class="title">9.5. Collected logs and custom resource information</h2></div></div></div><p class="_abstract _abstract">
				You can download logs and custom resource (CR) YAML files for the following targets by using the Red Hat OpenShift web console or the command-line interface (CLI):
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Migration plan: Web console or CLI.
					</li><li class="listitem">
						Virtual machine: Web console or CLI.
					</li><li class="listitem">
						Namespace: CLI only.
					</li></ul></div><p>
				The <code class="literal">must-gather</code> tool collects the following logs and CR files in an archive file:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						CRs:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">DataVolume</code> CR: Represents a disk mounted on a migrated VM.
							</li><li class="listitem">
								<code class="literal">VirtualMachine</code> CR: Represents a migrated VM.
							</li><li class="listitem">
								<code class="literal">Plan</code> CR: Defines the VMs and storage and network mapping.
							</li><li class="listitem">
								<code class="literal">Job</code> CR: Optional: Represents a pre-migration hook, a post-migration hook, or both.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Logs:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">importer</code> pod: Disk-to-data-volume conversion log. The <code class="literal">importer</code> pod naming convention is <code class="literal">importer-&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code class="literal">importer-mig-plan-ed90dfc6-9a17-4a8btnfh</code>, where <code class="literal">ed90dfc6-9a17-4a8</code> is a truncated RHV VM ID and <code class="literal">btnfh</code> is the generated 5-character ID.
							</li><li class="listitem">
								<code class="literal">conversion</code> pod: VM conversion log. The <code class="literal">conversion</code> pod runs <code class="literal">virt-v2v</code>, which installs and configures device drivers on the PVCs of the VM. The <code class="literal">conversion</code> pod naming convention is <code class="literal">&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>.
							</li><li class="listitem">
								<code class="literal">virt-launcher</code> pod: VM launcher log. When a migrated VM is powered on, the <code class="literal">virt-launcher</code> pod runs <code class="literal">QEMU-KVM</code> with the PVCs attached as VM disks.
							</li><li class="listitem">
								<code class="literal">forklift-controller</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code class="literal">must-gather</code> command.
							</li><li class="listitem">
								<code class="literal">forklift-must-gather-api</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code class="literal">must-gather</code> command.
							</li><li class="listitem"><p class="simpara">
								<code class="literal">hook-job</code> pod: The log is filtered for hook jobs. The <code class="literal">hook-job</code> naming convention is <code class="literal">&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code class="literal">plan2j-vm-3696-posthook-4mx85</code> or <code class="literal">plan2j-vm-3696-prehook-mwqnl</code>.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Empty or excluded log files are not included in the <code class="literal">must-gather</code> archive file.
								</p></div></div></li></ul></div></li></ul></div><p>
				The following schematic drawing shows the <code class="literal">must-gather</code> archive structure for an example VMware migration plan:
			</p><pre class="screen">must-gather
└── namespaces
    ├── target-vm-ns
    │   ├── crs
    │   │   ├── datavolume
    │   │   │   ├── mig-plan-vm-7595-tkhdz.yaml
    │   │   │   ├── mig-plan-vm-7595-5qvqp.yaml
    │   │   │   └── mig-plan-vm-8325-xccfw.yaml
    │   │   └── virtualmachine
    │   │       ├── test-test-rhel8-2disks2nics.yaml
    │   │       └── test-x2019.yaml
    │   └── logs
    │       ├── importer-mig-plan-vm-7595-tkhdz
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-7595-5qvqp
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-8325-xccfw
    │       │   └── current.log
    │       ├── mig-plan-vm-7595-4glzd
    │       │   └── current.log
    │       └── mig-plan-vm-8325-4zw49
    │           └── current.log
    └── openshift-mtv
        ├── crs
        │   └── plan
        │       └── mig-plan-cold.yaml
        └── logs
            ├── forklift-controller-67656d574-w74md
            │   └── current.log
            └── forklift-must-gather-api-89fc7f4b6-hlwb6
                └── current.log</pre><section class="section" id="accessing-logs-ui_mtv"><div class="titlepage"><div><div><h3 class="title">9.5.1. Downloading logs and custom resource information from the web console</h3></div></div></div><p class="_abstract _abstract">
					You can download logs and information about custom resources (CRs) for a completed, failed, or canceled migration plan or for migrated virtual machines (VMs) from the Red Hat OpenShift web console.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							In the Red Hat OpenShift web console, click <span class="strong strong"><strong>Migration for Virtualization</strong></span> &gt; <span class="strong strong"><strong>Migration plans</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Get logs</strong></span> beside a migration plan name.
						</li><li class="listitem"><p class="simpara">
							In the <span class="strong strong"><strong>Get logs</strong></span> window, click <span class="strong strong"><strong>Get logs</strong></span>.
						</p><p class="simpara">
							The logs are collected. A <code class="literal">Log collection complete</code> message is displayed.
						</p></li><li class="listitem">
							Click <span class="strong strong"><strong>Download logs</strong></span> to download the archive file.
						</li><li class="listitem">
							To download logs for a migrated VM, click a migration plan name and then click <span class="strong strong"><strong>Get logs</strong></span> beside the VM.
						</li></ol></div></section><section class="section" id="accessing-logs-cli_mtv"><div class="titlepage"><div><div><h3 class="title">9.5.2. Accessing logs and custom resource information from the command line</h3></div></div></div><p class="_abstract _abstract">
					You can access logs and information about custom resources (CRs) from the command line by using the <code class="literal">must-gather</code> tool. You must attach a <code class="literal">must-gather</code> data file to all customer cases.
				</p><p>
					You can gather data for a specific namespace, a completed, failed, or canceled migration plan, or a migrated virtual machine (VM) by using the filtering options.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						If you specify a non-existent resource in the filtered <code class="literal">must-gather</code> command, no archive file is created.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You must be logged in to the OpenShift Virtualization cluster as a user with the <code class="literal">cluster-admin</code> role.
						</li><li class="listitem">
							You must have the <a class="link" href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/cli_tools/openshift-cli-oc#openshift-cli-oc">Red Hat OpenShift CLI (oc)</a> installed.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Navigate to the directory where you want to store the <code class="literal">must-gather</code> data.
						</li><li class="listitem"><p class="simpara">
							Run the <code class="literal">oc adm must-gather</code> command:
						</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2</pre><p class="simpara">
							The data is saved as <code class="literal">/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
						</p></li><li class="listitem"><p class="simpara">
							Optional: Run the <code class="literal">oc adm must-gather</code> command with the following options to gather filtered data:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									Namespace:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
									Migration plan:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</pre></li><li class="listitem"><p class="simpara">
									Virtual machine:
								</p><pre class="programlisting language-terminal">$ oc adm must-gather --image=registry.redhat.io/migration-toolkit-virtualization/mtv-must-gather-rhel8:2.10.2 \
  -- VM=&lt;vm_name&gt; NS=&lt;namespace&gt; /usr/bin/targeted</pre><p class="simpara">
									where:
								</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;vm_name&gt;</code></span></dt><dd>
												Specifies the VM <span class="emphasis"><em>name</em></span>, not the VM ID, as it appears in the <code class="literal">Plan</code> CR.
											</dd></dl></div></li></ul></div></li></ol></div></section></section></section><section class="chapter" id="assembly_mtv-performance-recommendations_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 10. MTV performance recommendations</h1></div></div></div><p class="_abstract _abstract">
			Review recommendations for network and storage performance, cold and warm migrations, and multiple migrations or single migrations.
		</p><p>
			The purpose of this section is to share recommendations for efficient and effective migration of virtual machines (VMs) using Migration Toolkit for Virtualization (MTV), based on findings observed through testing.
		</p><p>
			The data provided here was collected from testing in Red Hat labs and is provided for reference only.
		</p><p>
			Overall, these numbers should be considered to show the best-case scenarios.
		</p><p>
			The observed performance of migration can differ from these results and depends on several factors.
		</p><section class="section" id="ref_fast-storage-network-speeds_mtv"><div class="titlepage"><div><div><h2 class="title">10.1. Ensure fast storage and network speeds</h2></div></div></div><p class="_abstract _abstract">
				Ensure fast storage and network speeds, both for VMware and Red Hat OpenShift (OCP) environments.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To perform fast migrations, VMware must have fast read access to datastores. Networking between VMware ESXi hosts should be fast, ensure a 10 GiB network connection, and avoid network bottlenecks.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Extend the VMware network to the OCP Workers Interface network environment.
							</li><li class="listitem">
								It is important to ensure that the VMware network offers high throughput (10 Gigabit Ethernet) and rapid networking to guarantee that the reception rates align with the read rate of the ESXi datastore.
							</li><li class="listitem">
								Be aware that the migration process uses significant network bandwidth and that the migration network is utilized. If other services use that network, it might have an impact on those services and their migration rates.
							</li><li class="listitem">
								For example, 200 to 325 MiB/s was the average network transfer rate from the <code class="literal">vmnic</code> for each ESXi host associated with transferring data to the OCP interface.
							</li></ul></div></li></ul></div></section><section class="section" id="ref_fast-datastore-read-speeds_mtv"><div class="titlepage"><div><div><h2 class="title">10.2. Ensure fast datastore read speeds to ensure efficient and performant migrations</h2></div></div></div><p class="_abstract _abstract">
				Datastores read rates impact the total transfer times, so it is essential to ensure fast reads are possible from the ESXi datastore to the ESXi host.
			</p><p>
				Example in numbers: 200 to 300 MiB/s was the average read rate for both vSphere and ESXi endpoints for a single ESXi server. When multiple ESXi servers are used, higher datastore read rates are possible.
			</p></section><section class="section" id="ref_endpoint-types_mtv"><div class="titlepage"><div><div><h2 class="title">10.3. Endpoint types</h2></div></div></div><p class="_abstract _abstract">
				Migration Toolkit for Virtualization (MTV) allows for the following vSphere provider options:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						ESXi endpoint (inventory and disk transfers from ESXi).
					</li><li class="listitem">
						vCenter Server endpoint; no networks for the ESXi host (inventory and disk transfers from vCenter).
					</li><li class="listitem">
						vCenter endpoint and ESXi networks are available (inventory from vCenter, disk transfers from ESXi).
					</li></ul></div><p>
				When transferring many VMs that are registered to multiple ESXi hosts, using the vCenter endpoint and ESXi network is suggested.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					As of vSphere 7.0, ESXi hosts can label which network to use for Network Block Device (NBD) transport. This is accomplished by tagging the desired virtual network interface controller (NIC) with the appropriate <code class="literal">vSphereBackupNFC</code> label. When this is done, MTV is able to use the ESXi interface for network transfer to OpenShift provided that the worker and ESXi host interfaces are reachable. This is especially useful when migration users might not have access to the ESXi credentials yet want to be able to control which ESXi interface is used for migration.
				</p><p>
					For more details, see: <a class="link" href="https://issues.redhat.com/browse/MTV-1230">(MTV-1230)</a>
				</p></div></div><p>
				You can use the following ESXi command, which designates interface <code class="literal">vmk2</code> for NBD backup:
			</p><pre class="programlisting language-terminal">$ esxcli network ip interface tag add -t vSphereBackupNFC -i vmk2</pre></section><section class="section" id="mtv-esxi-performance_mtv"><div class="titlepage"><div><div><h2 class="title">10.4. ESXi performance</h2></div></div></div><p class="_abstract _abstract">
				ESXi performance can be measured for a single ESXI host or for multiple ESXi hosts.
			</p><p>
				Where possible, ensure that hosts used to perform migrations are set with BIOS profiles related to maximum performance. Hosts which use Host Power Management controlled within vSphere should check that <code class="literal">High Performance</code> is set.
			</p><p>
				Testing showed that when transferring more than 10 VMs with both BIOS and host power management set accordingly, migrations had an increase of 15 MiB in the average datastore read rate.
			</p><section class="section" id="mtv-single-esxi-host-performance_mtv"><div class="titlepage"><div><div><h3 class="title">10.4.1. Single ESXi host performance</h3></div></div></div><p>
					Test migration by using the same ESXi host.
				</p><p>
					In each iteration, the total VMs increase to display the impact of concurrent migration on the duration.
				</p><p>
					The results show that migration time is linear when increasing the total VMs (50 GiB disk, Utilization 70%).
				</p><p>
					The optimal number of VMs per ESXi is 10.
				</p><div class="table" id="idm45556781331568"><p class="title"><strong>Table 10.1. Single ESXi host tests</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 45%; " class="col_1"/><col style="width: 9%; " class="col_2"/><col style="width: 9%; " class="col_3"/><col style="width: 13%; " class="col_4"/><col style="width: 12%; " class="col_5"/><col style="width: 12%; " class="col_6"/></colgroup><thead><tr><th align="left" valign="top" id="idm45556781322288" scope="col">Test Case Description</th><th align="left" valign="top" id="idm45556781321200" scope="col">MTV</th><th align="left" valign="top" id="idm45556781320112" scope="col">VDDK</th><th align="left" valign="top" id="idm45556781319024" scope="col">max_vm inflight</th><th align="left" valign="top" id="idm45556781317936" scope="col">Migration Type</th><th align="left" valign="top" id="idm45556781316848" scope="col">Total Duration</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 10 VMs, Single ESXi, Private Network (non-management network)
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									0:21:39
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									cold migration, 20 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									0:41:16
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 30 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									1:00:59
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 40 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									1:23:02
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 50 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									1:46:24
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 80 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									2:42:49
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556781322288">
								<p>
									Cold migration, 100 VMs, Single ESXi, Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556781321200">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556781320112">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556781319024">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556781317936">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556781316848">
								<p>
									3:25:15
								</p>
								</td></tr></tbody></table></div></div></section><section class="section" id="mtv-multiple-esxi-host-performance_mtv"><div class="titlepage"><div><div><h3 class="title">10.4.2. Multiple ESXi hosts and a single data store</h3></div></div></div><p>
					In each iteration, the number of ESXi hosts was increased, to show that increasing the number of ESXi hosts improves the migration time (50 GiB disk, Utilization 70%).
				</p><div class="table" id="idm45556779733776"><p class="title"><strong>Table 10.2. Multiple ESXi hosts and single data store</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 45%; " class="col_1"/><col style="width: 9%; " class="col_2"/><col style="width: 9%; " class="col_3"/><col style="width: 13%; " class="col_4"/><col style="width: 12%; " class="col_5"/><col style="width: 12%; " class="col_6"/></colgroup><thead><tr><th align="left" valign="top" id="idm45556779724464" scope="col">Test Case Description</th><th align="left" valign="top" id="idm45556779723376" scope="col">MTV</th><th align="left" valign="top" id="idm45556779722288" scope="col">VDDK</th><th align="left" valign="top" id="idm45556779721200" scope="col">max_vm inflight</th><th align="left" valign="top" id="idm45556779720112" scope="col">Migration Type</th><th align="left" valign="top" id="idm45556779719024" scope="col">Total Duration</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45556779724464">
								<p>
									Cold migration, 100 VMs, Single ESXi, Private Network (non-management network)
								</p>
								</td><td align="left" valign="top" headers="idm45556779723376">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556779722288">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556779721200">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556779720112">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556779719024">
								<p>
									3:25:15
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779724464">
								<p>
									Cold migration, 100 VMs, 4 ESXs (25 VMs per ESX), Private Network
								</p>
								</td><td align="left" valign="top" headers="idm45556779723376">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556779722288">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556779721200">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556779720112">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556779719024">
								<p>
									1:22:27
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm45556779724464">
								<p>
									Cold migration, 100 VMs, 5 ESXs (20 VMs per ESX), Private Network, 1 Data Store
								</p>
								</td><td align="left" valign="top" headers="idm45556779723376">
								<p>
									2.6
								</p>
								</td><td align="left" valign="top" headers="idm45556779722288">
								<p>
									7.0.3
								</p>
								</td><td align="left" valign="top" headers="idm45556779721200">
								<p>
									100
								</p>
								</td><td align="left" valign="top" headers="idm45556779720112">
								<p>
									cold
								</p>
								</td><td align="left" valign="top" headers="idm45556779719024">
								<p>
									1:04:57
								</p>
								</td></tr></tbody></table></div></div></section></section><section class="section" id="mtv-different-migration-network-performances_mtv"><div class="titlepage"><div><div><h2 class="title">10.5. Performance using different migration networks</h2></div></div></div><p class="_abstract _abstract">
				In each test, the <code class="literal">Migration Network</code> was changed, by using the <span class="strong strong"><strong>Provider</strong></span>, to find the fastest network for migration.
			</p><p>
				The results indicate that there is no degradation by using management compared to non-management networks when all interfaces and network speeds are the same.
			</p><div class="table" id="idm45556778454736"><p class="title"><strong>Table 10.3. Different migration network tests</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 45%; " class="col_1"/><col style="width: 9%; " class="col_2"/><col style="width: 9%; " class="col_3"/><col style="width: 13%; " class="col_4"/><col style="width: 12%; " class="col_5"/><col style="width: 12%; " class="col_6"/></colgroup><thead><tr><th align="left" valign="top" id="idm45556778445440" scope="col">Test Case Description</th><th align="left" valign="top" id="idm45556778444352" scope="col">MTV</th><th align="left" valign="top" id="idm45556778443264" scope="col">VDDK</th><th align="left" valign="top" id="idm45556780487120" scope="col">max_vm inflight</th><th align="left" valign="top" id="idm45556780486144" scope="col">Migration Type</th><th align="left" valign="top" id="idm45556780485056" scope="col">Total Duration</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm45556778445440">
							<p>
								Cold migration, 10 VMs, Single ESXi, MGMT Network
							</p>
							</td><td align="left" valign="top" headers="idm45556778444352">
							<p>
								2.6
							</p>
							</td><td align="left" valign="top" headers="idm45556778443264">
							<p>
								7.0.3
							</p>
							</td><td align="left" valign="top" headers="idm45556780487120">
							<p>
								100
							</p>
							</td><td align="left" valign="top" headers="idm45556780486144">
							<p>
								cold
							</p>
							</td><td align="left" valign="top" headers="idm45556780485056">
							<p>
								0:21:30
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45556778445440">
							<p>
								Cold migration, 10 VMs, Single ESXi, Private Network (non-management network)
							</p>
							</td><td align="left" valign="top" headers="idm45556778444352">
							<p>
								2.6
							</p>
							</td><td align="left" valign="top" headers="idm45556778443264">
							<p>
								7.0.3
							</p>
							</td><td align="left" valign="top" headers="idm45556780487120">
							<p>
								20
							</p>
							</td><td align="left" valign="top" headers="idm45556780486144">
							<p>
								cold
							</p>
							</td><td align="left" valign="top" headers="idm45556780485056">
							<p>
								0:21:20
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm45556778445440">
							<p>
								Cold migration, 10 VMs, Single ESXi, Default Network
							</p>
							</td><td align="left" valign="top" headers="idm45556778444352">
							<p>
								2.6.2
							</p>
							</td><td align="left" valign="top" headers="idm45556778443264">
							<p>
								7.0.3
							</p>
							</td><td align="left" valign="top" headers="idm45556780487120">
							<p>
								20
							</p>
							</td><td align="left" valign="top" headers="idm45556780486144">
							<p>
								cold
							</p>
							</td><td align="left" valign="top" headers="idm45556780485056">
							<p>
								0:21:30
							</p>
							</td></tr></tbody></table></div></div></section><section class="section" id="ref_avoid-network-load_mtv"><div class="titlepage"><div><div><h2 class="title">10.6. Avoid additional network load on VMware networks</h2></div></div></div><p class="_abstract _abstract">
				You can reduce the network load on VMware networks by selecting the migration network when using the ESXi endpoint.
			</p><p>
				By incorporating a virtualization provider, MTV enables the selection of a specific network, which is accessible on the ESXi hosts, for the purpose of migrating virtual machines to OpenShift. Selecting this migration network from the ESXi host in the MTV UI ensures that the transfer is performed using the selected network as an ESXi endpoint.
			</p><p>
				It is imperative to ensure that the network selected has connectivity to the OCP interface, has adequate bandwidth for migrations, and that the network interface is not saturated.
			</p><p>
				In environments with fast networks, such as 10GbE networks, migration network impacts can be expected to match the rate of ESXi datastore reads.
			</p></section><section class="section" id="ref_control-concurrent-disk-migrations_mtv"><div class="titlepage"><div><div><h2 class="title">10.7. Control maximum concurrent disk migrations per ESXi host</h2></div></div></div><p class="_abstract _abstract">
				Set the <code class="literal">MAX_VM_INFLIGHT MTV</code> variable to control the maximum number of concurrent VM transfers allowed for the ESXi host.
			</p><p>
				Migration Toolkit for Virtualization (MTV) allows for concurrency to be controlled by using this variable; by default, it is set to 20.
			</p><p>
				When setting <code class="literal">MAX_VM_INFLIGHT</code>, consider the number of maximum concurrent VM transfers that are required for ESXi hosts. It is important to consider the type of migration to be transferred concurrently.
			</p><p>
				Warm migrations use snapshots to compare and migrate only the differences between previous snapshots of the disk. The migration of the differences between snapshots happens over specific intervals before a final cut-over of the running VM to OpenShift occurs.
			</p><p>
				In MTV, <code class="literal">MAX_VM_INFLIGHT</code> reserves one transfer slot per VM, regardless of current migration activity for a specific snapshot or the number of disks that belong to a single VM. The total set by <code class="literal">MAX_VM_INFLIGHT</code> is used to indicate how many concurrent VM transfers per ESXi host is allowed.
			</p><p>
				Example:
			</p><p>
				<code class="literal">MAX_VM_INFLIGHT = 20</code> and 2 ESXi hosts defined in the provider mean each host can transfer 20 VMs.
			</p></section><section class="section" id="ref_concurrent-migrations-faster-migrations_mtv"><div class="titlepage"><div><div><h2 class="title">10.8. Migrations are completed faster when migrating multiple VMs concurrently</h2></div></div></div><p class="_abstract _abstract">
				When multiple VMs from a specific ESXi host are to be migrated by using Migration Toolkit for Virtualization (MTV), starting concurrent migrations for multiple VMs leads to faster migration times. 
			</p><p>
				Testing demonstrated that migrating 10 VMs (each containing 35 GiB of data, with a total size of 50 GiB) from a single host is significantly faster than migrating the same number of VMs sequentially, one after another. 
			</p><p>
				It is possible to increase concurrent migration to more than 10 virtual machines from a single host, but it does not show a significant improvement. 
			</p><p>
				Examples:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						1 single disk VMs took 6 minutes, with migration rate of 100 MiB/s
					</li><li class="listitem">
						10 single disk VMs took 22 minutes, with migration rate of 272 MiB/s
					</li><li class="listitem">
						20 single disk VMs took 42 minutes, with migration rate of 284 MiB/s
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					From the aforementioned examples, it is evident that the migration of 10 virtual machines simultaneously is three times faster than the migration of identical virtual machines in a sequential manner.
				</p><p>
					The migration rate was almost the same when moving 10 or 20 virtual machines simultaneously.
				</p></div></div></section><section class="section" id="ref_multiple-hosts-faster-migrations_mtv"><div class="titlepage"><div><div><h2 class="title">10.9. Migrations complete faster using multiple hosts</h2></div></div></div><p class="_abstract _abstract">
				Using multiple hosts with registered VMs equally distributed among the ESXi hosts used for migrations leads to faster migration times.
			</p><p>
				Testing showed that when transferring more than 10 single disk VMs, each containing 35 GiB of data out of a total of 50G total, using an additional host can reduce migration time.
			</p><p>
				Examples:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						80 single disk VMs, containing 35 GiB of data each, using a single host took 2 hours and 43 minutes, with a migration rate of 294 MiB/s.
					</li><li class="listitem">
						80 single disk VMs, containing 35 GiB of data each, using 8 ESXi hosts took 41 minutes, with a migration rate of 1,173 MiB/s.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					From the aforementioned examples, it is evident that migrating 80 VMs from 8 ESXi hosts, 10 from each host, concurrently is four times faster than running the same VMs from a single ESXi host. 
				</p><p>
					Migrating a larger number of VMs from more than 8 ESXi hosts concurrently could potentially show increased performance. However, it was not tested and therefore not recommended.
				</p></div></div></section><section class="section" id="ref_multiple-migration-plans-vs-single_mtv"><div class="titlepage"><div><div><h2 class="title">10.10. Multiple migration plans compared to a single large migration plan</h2></div></div></div><p class="_abstract _abstract">
				The maximum number of disks that can be referenced by a single migration plan is 500. For more details, see <a class="link" href="https://issues.redhat.com/browse/MTV-1203">(MTV-1203)</a>. 
			</p><p>
				When attempting to migrate many VMs in a single migration plan, it can take some time for all migrations to start. By breaking up one migration plan into several migration plans, it is possible to start them at the same time.
			</p><p>
				Comparing migrations of:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						500 VMs using 8 ESXi hosts in 1 plan, <code class="literal">max_vm_inflight=100</code>, took 5 hours and 10 minutes.
					</li><li class="listitem">
						800 VMs using 8 ESXi hosts with 8 plans, <code class="literal">max_vm_inflight=100</code>, took 57 minutes.
					</li></ul></div><p>
				Testing showed that by breaking one single large plan into multiple moderately sized plans, for example, by using 100 VMs per plan, the total migration time can be reduced.
			</p></section><section class="section" id="ref_maximum-values-cold-migrations_mtv"><div class="titlepage"><div><div><h2 class="title">10.11. Maximum values tested for cold migrations</h2></div></div></div><p class="_abstract _abstract">
				The following maximum values were tested for cold migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Maximum number of ESXi hosts tested: 8
					</li><li class="listitem">
						Maximum number of VMs in a single migration plan: 500
					</li><li class="listitem">
						Maximum number of VMs migrated in a single test: 5000
					</li><li class="listitem">
						Maximum number of migration plans performed concurrently: 40
					</li><li class="listitem">
						Maximum single disk size migrated: 6 TB disk, which contained 3 TB of data
					</li><li class="listitem">
						Maximum number of disks on a single VM migrated: 50
					</li><li class="listitem">
						Highest observed single datastore read rate from a single ESXi server: 312 MiB/second
					</li><li class="listitem">
						Highest observed multi-datastore read rate using eight ESXi servers and two datastores: 1,242 MiB/second
					</li><li class="listitem">
						Highest observed virtual NIC transfer rate to an OpenShift worker: 327 MiB/second
					</li><li class="listitem">
						<span class="strong strong"><strong>Maximum migration transfer rate of a single disk: 162 MiB/second (rate observed when transferring nonconcurrent migration of 1.5 TB utilized data)</strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong>Maximum cold migration transfer rate of the multiple VMs (single disk) from a single ESXi host: 294 MiB/s (concurrent migration of 30 VMs, 35/50 GiB used, from Single ESXi)</strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong>Maximum cold migration transfer rate of the multiple VMs (single disk) from multiple ESXi hosts: 1173MB/s (concurrent migration of 80 VMs, 35/50 GiB used, from 8 ESXi servers, 10 VMs from each ESXi)</strong></span>
					</li></ul></div></section><section class="section" id="ref_warm-migration-recommendations_mtv"><div class="titlepage"><div><div><h2 class="title">10.12. Warm migration recommendations</h2></div></div></div><p class="_abstract _abstract">
				The following recommendations are specific to warm migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Migrate up to 400 disks in parallel
					</li></ul></div><p>
				Testing involved migrating 200 VMs in parallel, with 2 disks each using 8 ESXi hosts, for a total of 400 disks. No tests were run on migration plans migrating over 400 disks in parallel, so it is not recommended to migrate over this number of disks in parallel.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Migrate up to 200 disks in parallel for the fastest rate
					</li></ul></div><p>
				Testing was successfully performed on parallel disk migrations with 200, 300, and 400 disks. There was a decrease in the precopy migration rate, approximately 25%, between the tests migrating 200 disks and those migrating 300 and 400 disks.
			</p><p>
				Therefore, it is recommended to perform parallel disk migrations in groups of 200 or fewer, instead of 300 to 400 disks, unless a decline of 25% in precopy speed does not affect your cutover planning.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						When possible, set cutover time to be immediately after a migration plan starts
					</li></ul></div><p>
				To reduce the overall time of warm migrations, it is recommended to set the cutover to occur immediately after the migration plan is started. This causes MTV to run <span class="strong strong"><strong>only one</strong></span> precopy per VM. This recommendation is valid, no matter how many VMs are in the migration plan.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Increase precopy intervals between snapshots
					</li></ul></div><p>
				If you are creating many migration plans with a single VM and have enough time between the migration start and the cutover, increase the value of the <code class="literal">controller_precopy_interval</code> parameter to between 120 and 240 minutes, inclusive. The longer setting will reduce the total number of snapshots and disk transfers per VM before the cutover.
			</p></section><section class="section" id="ref_maximum-values-warm-migrations_mtv"><div class="titlepage"><div><div><h2 class="title">10.13. Maximum values tested for warm migrations</h2></div></div></div><p class="_abstract _abstract">
				The following maximum values were tested for warm migrations:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Maximum number of ESXi hosts tested: 8
					</li><li class="listitem">
						Maximum number of worker nodes: 12
					</li><li class="listitem">
						Maximum number of VMs in a single migration plan: 200
					</li><li class="listitem">
						Maximum number of total parallel disk transfers: 400, with 200 VMs, 6 ESXis, and a transfer rate of 667 MB/s
					</li><li class="listitem">
						Maximum single disk size migrated: 6 TB disk, which contained 3 TB of data
					</li><li class="listitem">
						Maximum number of disks on a single VM migrated: 3
					</li><li class="listitem">
						Maximum number of parallel disk transfers per ESXi host: 68
					</li><li class="listitem">
						<span class="strong strong"><strong>Maximum transfer rate observed of a single disk with no concurrent migrations: 76.5 MB/s</strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong>Maximum transfer rate observed of multiple disks from a single ESXi host: 253 MB/s (concurrent migration of 10 VMs, 1 disk each, 35/50 GiB used per disk)</strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong>Total transfer rate observed of multiple disks (210) from 8 ESXi hosts: 802 MB/s (concurrent migration of 70 VMs, 3 disks each, 35/50 GiB used per disk)</strong></span>
					</li></ul></div></section><section class="section" id="ref_migrating-vms-large-disks_mtv"><div class="titlepage"><div><div><h2 class="title">10.14. Recommendations for migrating VMs with large disks</h2></div></div></div><p class="_abstract _abstract">
				The following recommendations are suggested for VMs with data on disk totaling to 1 TB or greater for each individual disk:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Schedule appropriate maintenance windows for migrating large disk virtual machines (VMs). Such migrations are sensitive operations and might require careful planning of maintenance windows and downtime, especially during periods of lower storage and network activity.
					</li><li class="listitem">
						Check that no other migration activities or other heavy network or storage activities are run during those large virtual machine (VM) migrations. During those migrations, prioritize MTV activities. Plan to migrate those VMs to a time when there are fewer activities on those VMs and related datastore.
					</li><li class="listitem">
						For large VMs with a high churn rate, which means data is frequently changed in amounts of 100 GB or more between snapshots, consider reducing the warm migration <code class="literal">controller_precopy_interval</code> from the default, which is 60 minutes. It is important to ensure that this process is started at least 24 hours before the scheduled cutover to allow for multiple successful precopy snapshots to complete. When scheduling the cutover, ensure that the maintenance window allows for enough time for the last snapshot of changes to be copied over and that the cutover process begins at the beginning of that maintenance window.
					</li><li class="listitem">
						In cases of particularly large single-disk VMs, where some downtime is possible, select cold migrations rather than warm migrations, especially in the case of large VM snapshots.
					</li><li class="listitem">
						Consider splitting data on particularly large disks to multiple disks, which enables parallel disk migration with MTV when warm migration is used.
					</li><li class="listitem">
						If you have large database disks with continuous writes of large amounts of data, where downtime and VM snapshots are not possible, it might be necessary to consider database vendor-specific replication options of the database data to target these specific migrations outside MTV. Consult the vendor-specific options of your database if this case applies.
					</li></ul></div></section><section class="section" id="mtv-aio-buffer_mtv"><div class="titlepage"><div><div><h2 class="title">10.15. Increasing AIO sizes and buffer counts for NBD transport mode</h2></div></div></div><p class="_abstract _abstract">
				You can change Network Block Device (NBD) transport network file copy (NFC) parameters to increase migration performance when you use Asynchronous Input/Output (AIO) buffering with the Migration Toolkit for Virtualization (MTV).
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Using AIO buffering is only suitable for cold migration use cases.
				</p><p>
					Disable AIO settings before initializing warm migrations. For more details, see <a class="link" href="#mtv-disable-aio-buffer_mtv" title="10.15.4. Disabling AIO buffering">Disabling AIO Buffer Configuration</a>.
				</p></div></div><section class="section" id="mtv-aio-buffer-key-findings_mtv"><div class="titlepage"><div><div><h3 class="title">10.15.1. Key findings</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The best migration performance was achieved by migrating multiple (10) virtual machines (VMs) on a single ESXi host with the following values:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									<code class="literal">VixDiskLib.nfcAio.Session.BufSizeIn64KB=16</code>
								</li><li class="listitem">
									<code class="literal">vixDiskLib.nfcAio.Session.BufCount=4</code>
								</li></ul></div></li><li class="listitem"><p class="simpara">
							The following improvements were noted when using AIO buffer settings (asynchronous buffer counts):
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									Migration time was reduced by <span class="strong strong"><strong>31.1%</strong></span>, from 0:24:32 to 0:16:54.
								</li><li class="listitem">
									Read rate was increased from 347.83 MB/s to 504.93 MB/s.
								</li></ul></div></li><li class="listitem">
							There was no significant improvement observed when using AIO buffer settings with a single VM.
						</li><li class="listitem">
							There was no significant improvement observed when using AIO buffer settings with multiple VMs from multiple hosts.
						</li></ul></div></section><section class="section" id="mtv-aio-buffer-key-requirements_mtv"><div class="titlepage"><div><div><h3 class="title">10.15.2. Key requirements for support for AIO sizes and buffer counts</h3></div></div></div><p>
					Support is based upon tests performed using the following versions:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							vSphere 7.0.3
						</li><li class="listitem">
							VDDK 7.0.3
						</li></ul></div></section><section class="section" id="mtv-enable-aio-buffer_mtv"><div class="titlepage"><div><div><h3 class="title">10.15.3. Enabling and configuring AIO buffering</h3></div></div></div><p class="_abstract _abstract">
					You can enable and configure Asynchronous Input/Output (AIO) buffering for use with the Migration Toolkit for Virtualization (MTV).
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Ensure that the <code class="literal">forklift-controller</code> pod in the <code class="literal">openshift-mtv</code> namespace supports the AIO buffer values. Since the pod name prefix is dynamic, check the pod name by running the following command:
						</p><pre class="programlisting language-terminal">oc get pods -n openshift-mtv | grep forklift-controller | awk '{print $1}'</pre><p class="simpara">
							For example, the output if the pod name prefix is "forklift-controller-667f57c8f8-qllnx" would be:
						</p><pre class="programlisting language-terminal">forklift-controller-667f57c8f8-qllnx</pre></li><li class="listitem"><p class="simpara">
							Check the environment variables of the pod by running the following command:
						</p><pre class="programlisting language-terminal">oc get pod forklift-controller-667f57c8f8-qllnx -n openshift-mtv -o yaml</pre></li><li class="listitem"><p class="simpara">
							Check for the following lines in the output:
						</p><pre class="programlisting language-terminal">...
\- name: VIRT\_V2V\_EXTRA\_ARGS
\- name: VIRT\_V2V\_EXTRA\_CONF\_CONFIG\_MAP
...</pre></li><li class="listitem"><p class="simpara">
							In the <code class="literal">openshift-mtv namespace</code>, edit the <code class="literal">ForkliftController</code> custom resource (CR) by performing the following steps:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Access the <code class="literal">ForkliftController</code> CR for editing by running the following command:
								</p><pre class="programlisting language-terminal">oc edit forkliftcontroller -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
									Add the following lines to the <code class="literal">spec</code> section of the <code class="literal">ForkliftController</code> CR:
								</p><pre class="programlisting language-terminal">virt_v2v_extra_args: "--vddk-config /mnt/extra-v2v-conf/input.conf"
virt_v2v_extra_conf_config_map: "perf"</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Create the required config map <code class="literal">perf</code> by running the following command:
						</p><pre class="programlisting language-terminal">oc -n openshift-mtv create cm perf</pre></li><li class="listitem"><p class="simpara">
							Convert the desired buffer configuration values to Base64. For example, for 16/4, run the following command:
						</p><pre class="programlisting language-terminal">echo -e "VixDiskLib.nfcAio.Session.BufSizeIn64KB=16\nvixDiskLib.nfcAio.Session.BufCount=4" | base64</pre><p class="simpara">
							The output will be similar to the following:
						</p><pre class="programlisting language-terminal">Vml4RGlza0xpYi5uZmNBaW8uU2Vzc2lvbi5CdWZTaXplSW42NEtCPTE2CnZpeERpc2tMaWIubmZjQWlvLlNlc3Npb24uQnVmQ291bnQ9NAo=</pre></li><li class="listitem"><p class="simpara">
							In the config map <code class="literal">perf</code>, enter the Base64 string in the <code class="literal">binaryData</code> section, for example:
						</p><pre class="programlisting language-terminal">apiVersion: v1
kind: ConfigMap
binaryData:
  input.conf: Vml4RGlza0xpYi5uZmNBaW8uU2Vzc2lvbi5CdWZTaXplSW42NEtCPTE2CnZpeERpc2tMaWIubmZjQWlvLlNlc3Npb24uQnVmQ291bnQ9NAo=
metadata:
  name: perf
  namespace: openshift-mtv</pre></li><li class="listitem">
							Restart the <code class="literal">forklift-controller</code> pod to apply the new configuration.
						</li><li class="listitem">
							Ensure the <code class="literal">VIRT_V2V_EXTRA_ARGS</code> environment variable reflects the updated settings.
						</li><li class="listitem"><p class="simpara">
							Run a migration plan and check the logs of the migration pod. Confirm that the AIO buffer settings are passed as parameters, particularly the <code class="literal">--vddk-config</code> value.
						</p><p class="simpara">
							For example, if you run the following command:
						</p><pre class="programlisting language-terminal">exec: /usr/bin/virt-v2v … --vddk-config /mnt/extra-v2v-conf/input.conf</pre><p class="simpara">
							The logs include a section similar to the following, if <code class="literal">debug_level = 4</code>:
						</p><pre class="programlisting language-terminal">Buffer size calc for 16 value:
(16 * 64 * 1024 = 1048576)
nbdkit: vddk[1]: debug: [NFC VERBOSE] NfcAio_OpenSession:
Opening an AIO session.
nbdkit: vddk[1]: debug: [NFC INFO] NfcAioInitSession:
Disabling
read-ahead buffer since the AIO buffer size of 1048576 is &gt;=
the read-ahead buffer size of 65536. Explicitly setting flag
'`NFC_AIO_SESSION_NO_NET_READ_AHEAD`'
nbdkit: vddk[1]: debug: [NFC VERBOSE] NfcAioInitSession: AIO Buffer Size is 1048576
nbdkit: vddk[1]: debug: [NFC VERBOSE] NfcAioInitSession: AIO Buffer
Count is 4</pre></li><li class="listitem"><p class="simpara">
							Verify that the correct config map values are in the migration pod. Do this by logging into the migration pod and running the following command:
						</p><pre class="programlisting language-terminal">cat /mnt/extra-v2v-conf/input.conf</pre><p class="simpara">
							Example output is as follows:
						</p><pre class="programlisting language-terminal">VixDiskLib.nfcAio.Session.BufSizeIn64KB=16
vixDiskLib.nfcAio.Session.BufCount=4</pre></li><li class="listitem"><p class="simpara">
							Optional: Enable debug logs by running the following command. The command converts the configuration to Base64, including a high log level:
						</p><pre class="programlisting language-terminal">echo -e
"`VixDiskLib.nfcAio.Session.BufSizeIn64KB=16\nVixDiskLib.nfcAio.Session.BufCount=4\nVixDiskLib.nfc.LogLevel=4`"
| base64</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Adding a high log level reduces performance and is for debugging purposes only.
							</p></div></div></li></ol></div></section><section class="section" id="mtv-disable-aio-buffer_mtv"><div class="titlepage"><div><div><h3 class="title">10.15.4. Disabling AIO buffering</h3></div></div></div><p class="_abstract _abstract">
					You can disable AIO buffering for a cold migration using Migration Toolkit for Virtualization (MTV). You must disable AIO buffering for a warm migration using MTV.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The procedure that follows assumes the AIO buffering was enabled and configured according to the procedure in <a class="link" href="#mtv-enable-aio-buffer_mtv" title="10.15.3. Enabling and configuring AIO buffering">Enabling and configuring AIO buffering</a>.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							In the <code class="literal">openshift-mtv namespace</code>, edit the <code class="literal">ForkliftController</code> custom resource (CR) by performing the following steps:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Access the <code class="literal">ForkliftController</code> CR for editing by running the following command:
								</p><pre class="programlisting language-terminal">oc edit forkliftcontroller -n openshift-mtv</pre></li><li class="listitem"><p class="simpara">
									Remove the following lines from the <code class="literal">spec</code> section of the <code class="literal">ForkliftController</code> CR:
								</p><pre class="programlisting language-terminal">virt_v2v_extra_args: "`–vddk-config /mnt/extra-v2v-conf/input.conf`"
virt_v2v_extra_conf_config_map: "`perf`"</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Delete the config map named <code class="literal">perf</code>:
						</p><pre class="programlisting language-terminal">oc delete cm perf -n openshift-mtv</pre></li><li class="listitem">
							Optional: Restart the <code class="literal">forklift-controller</code> pod to ensure that the changes took effect.
						</li></ol></div></section></section><section class="section" id="mtv-performance-addendum_mtv"><div class="titlepage"><div><div><h2 class="title">10.16. MTV performance addendum</h2></div></div></div><p class="_abstract _abstract">
				The data that forms the basis of the preceding recommendations was collected from testing in Red Hat labs and is provided for reference only.
			</p><p>
				Overall, these numbers should be considered to show the best-case scenarios.
			</p><p>
				The observed performance of migration can differ from these results and depends on several factors.
			</p></section></section><section class="chapter" id="mtv-telemetry_mtv"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Telemetry</h1></div></div></div><p class="_abstract _abstract">
			Red Hat uses telemetry to collect anonymous usage data from Migration Toolkit for Virtualization (MTV) installations to help us improve the usability and efficiency of MTV.
		</p><p>
			MTV collects the following data:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Migration plan status: The number of migrations. Includes those that failed, succeeded, or were canceled.
				</li><li class="listitem">
					Provider: The number of migrations per provider. Includes Red Hat Virtualization, vSphere, OpenStack, OVA, and OpenShift Virtualization providers.
				</li><li class="listitem">
					Mode: The number of migrations by mode. Includes cold and warm migrations.
				</li><li class="listitem">
					Target: The number of migrations by target. Includes local and remote migrations.
				</li><li class="listitem">
					Plan ID: The ID number of the migration plan. The number is assigned by MTV.
				</li></ul></div><p>
			Metrics are calculated every 10 seconds and are reported per week, per month, and per year.
		</p></section><div><div xml:lang="en-US" class="legalnotice" id="idm45556782373520"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2026 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>